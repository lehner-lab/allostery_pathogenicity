% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={fig3},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{fig3}
\author{}
\date{\vspace{-2.5em}2025-05-13}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Stability Definition \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{pdz3\_final\_df\_ddg }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{\textquotesingle{}../data/cleaned\_ddg/pdz3\_ddg\_cleaned\_mochi\_refit.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 3154 Columns: 41
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (14): id_eve, id_old, trait_name, library, assay, pdz_name, alignment_po...
## dbl (26): X, V1, pos_am, ddg, std_ddg, ci95_kcal.mol, pdz, structural_alignm...
## lgl  (1): binding_interface_5A
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3154
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddgf }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(trait\_name }\SpecialCharTok{==} \StringTok{"Folding"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(}\AttributeTok{f\_ddg\_pred =}\NormalTok{ ddg,}
                \AttributeTok{f\_ddg\_pred\_sd =}\NormalTok{ std\_ddg)}
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddgf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1587
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddgb }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(trait\_name }\SpecialCharTok{==} \StringTok{"Binding"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(}\AttributeTok{b\_ddg\_pred =}\NormalTok{ ddg,}
                \AttributeTok{b\_ddg\_pred\_sd =}\NormalTok{ std\_ddg)}
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddgb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1567
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(pdz3\_final\_df\_ddgf, pdz3\_final\_df\_ddgb, }\AttributeTok{by =} \StringTok{"id\_eve"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{dim}\NormalTok{(pdz3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1587   81
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Step 1: Calculate z{-}scores and p{-}values for stabilizing mutations}
\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{z\_stab =}\NormalTok{ (f\_ddg\_pred }\SpecialCharTok{{-}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ f\_ddg\_pred\_sd)}

\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{p\_stab =} \FunctionTok{pnorm}\NormalTok{(z\_stab))}

\CommentTok{\# Step 2: Calculate z{-}scores and p{-}values for destabilizing mutations}
\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{z\_destab =}\NormalTok{ (f\_ddg\_pred }\SpecialCharTok{{-}} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ f\_ddg\_pred\_sd,}
         \AttributeTok{p\_destab =} \DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{pnorm}\NormalTok{(z\_destab))}

\CommentTok{\# Step 3: Classify mutations based on p{-}values}
\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{class =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    p\_stab }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\textasciitilde{}} \StringTok{"stabilizing"}\NormalTok{,}
\NormalTok{    p\_destab }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\textasciitilde{}} \StringTok{"destabilizing"}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"no change"}
\NormalTok{  ))}

\CommentTok{\# Print summary of classification counts}
\NormalTok{class\_summary }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{class)}
\FunctionTok{print}\NormalTok{(class\_summary)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## destabilizing     no change   stabilizing 
##           514          1042            31
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#destabilizing     no change   stabilizing }
\CommentTok{\#514          1042            31 }

\NormalTok{paper\_anno }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"../data/cleaned\_ddg/pdz3\_ddg\_cleaned.csv"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(paper\_anno)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   id_eve id_am pos_am id_old Pos mut_order   f_dg_pred f_ddg_pred f_ddg_pred_sd
## 1  A386C A343C    343   A33C  33         1 -0.39296590  0.9164153    0.08446857
## 2  A386D A343D    343   A33D  33         1 -1.07504355  0.2343376    0.07533930
## 3  A386E A343E    343   A33E  33         1 -1.49154622 -0.1821651    0.28006551
## 4  A386F A343F    343   A33F  33         1 -0.06578612  1.2435951    0.05578810
## 5  A386G A343G    343   A33G  33         1 -0.50514604  0.8042351    0.04267052
## 6  A386I A343I    343   A33I  33         1 -0.63955357  0.6698276    0.03671739
##    b_dg_pred   b_ddg_pred b_ddg_pred_sd f_ddg_pred_conf b_ddg_pred_conf
## 1 -0.7049648  0.001690949    0.04058391            TRUE            TRUE
## 2 -0.6161306  0.090525109    0.03136712            TRUE            TRUE
## 3 -0.7094793 -0.002823546    0.03873099           FALSE            TRUE
## 4 -0.6698994  0.036756306    0.04147284            TRUE            TRUE
## 5 -0.8211448 -0.114489064    0.02278570            TRUE            TRUE
## 6 -0.5572302  0.149425538    0.12483570            TRUE            TRUE
##   HAmin_ligand scHAmin_ligand RSASA   SS Pos_class    protein WT_AA Mut
## 1     10.10073       12.45975  0.87 <NA>   surface PSD95-PDZ3     A   C
## 2     10.10073       12.45975  0.87 <NA>   surface PSD95-PDZ3     A   D
## 3     10.10073       12.45975  0.87 <NA>   surface PSD95-PDZ3     A   E
## 4     10.10073       12.45975  0.87 <NA>   surface PSD95-PDZ3     A   F
## 5     10.10073       12.45975  0.87 <NA>   surface PSD95-PDZ3     A   G
## 6     10.10073       12.45975  0.87 <NA>   surface PSD95-PDZ3     A   I
##   b_ddg_wposmeanabs b_ddg_wposse allosteric orthosteric allosteric_mutation
## 1         0.1079272  0.009094901         NA          NA               FALSE
## 2         0.1079272  0.009094901         NA          NA               FALSE
## 3         0.1079272  0.009094901         NA          NA               FALSE
## 4         0.1079272  0.009094901         NA          NA               FALSE
## 5         0.1079272  0.009094901         NA          NA               FALSE
## 6         0.1079272  0.009094901         NA          NA               FALSE
##   wt_aa.x mt_aa pos_eve wt_aa.y      atom consurf color confidence_interval
## 1       A     C     386       A ALA:343:A  -0.451     7 -0.588, -0.348  8,7
## 2       A     D     386       A ALA:343:A  -0.451     7 -0.588, -0.348  8,7
## 3       A     E     386       A ALA:343:A  -0.451     7 -0.588, -0.348  8,7
## 4       A     F     386       A ALA:343:A  -0.451     7 -0.588, -0.348  8,7
## 5       A     G     386       A ALA:343:A  -0.451     7 -0.588, -0.348  8,7
## 6       A     I     386       A ALA:343:A  -0.451     7 -0.588, -0.348  8,7
##   msa_data                   RESIDUE.VARIETY     AM AM_logit   ESM1b popEVE
## 1  150/150 A 94%, S  2%, T  2%, P <1%, G <1% 0.9283 2.560864 -15.589 -4.577
## 2  150/150 A 94%, S  2%, T  2%, P <1%, G <1% 0.9881 4.419246 -16.408 -4.690
## 3  150/150 A 94%, S  2%, T  2%, P <1%, G <1% 0.9759 3.701148 -13.101 -4.522
## 4  150/150 A 94%, S  2%, T  2%, P <1%, G <1% 0.9752 3.671799 -16.444 -5.093
## 5  150/150 A 94%, S  2%, T  2%, P <1%, G <1% 0.7414 1.053258 -11.524 -4.008
## 6  150/150 A 94%, S  2%, T  2%, P <1%, G <1% 0.9837 4.100156 -15.306 -4.718
##     ESM1v   EVE
## 1 -10.991 6.604
## 2 -11.585 6.652
## 3 -10.914 6.104
## 4 -13.794 6.533
## 5  -7.404 6.073
## 6 -11.800 6.545
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(paper\_anno}\SpecialCharTok{$}\NormalTok{orthosteric)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## TRUE 
##  113
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ortho\_list }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(paper\_anno }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(pos\_am))}
\DocumentationTok{\#\#setdiff(unique(pdz3\_out \%\textgreater{}\% filter(scHAmin\_ligand \textless{} 4.3) \%\textgreater{}\% pull(Pos)), unique(merged\_df\_pdz3 \%\textgreater{}\% filter(orthosteric == TRUE) \%\textgreater{}\% pull (Pos\_ref.x)))}
\NormalTok{ortho\_list }\OtherTok{\textless{}{-}} \FunctionTok{append}\NormalTok{(ortho\_list, }\FunctionTok{c}\NormalTok{(}\DecValTok{322}\NormalTok{, }\DecValTok{323}\NormalTok{, }\DecValTok{324}\NormalTok{ ,}\DecValTok{325}\NormalTok{, }\DecValTok{326}\NormalTok{, }\DecValTok{327}\NormalTok{, }\DecValTok{328}\NormalTok{, }\DecValTok{331}\NormalTok{, }\DecValTok{339}\NormalTok{, }\DecValTok{372}\NormalTok{, }\DecValTok{376}\NormalTok{, }\DecValTok{379}\NormalTok{, }\DecValTok{380}\NormalTok{))}

\FunctionTok{head}\NormalTok{(pdz3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   id_eve X.x V1.x id_old.x pos_am.x trait_name.x f_ddg_pred f_ddg_pred_sd
## 1  A386C 595  596     A33C       33      Folding  0.6659222     0.1989811
## 2  A386D 596  597     A33D       33      Folding  0.1566707     0.1977913
## 3  A386E 597  598     A33E       33      Folding -0.2662460     0.4344191
## 4  A386F 598  599     A33F       33      Folding  1.0041094     0.2397002
## 5  A386G 599  600     A33G       33      Folding  0.5761733     0.2151606
## 6  A386I 600  601     A33I       33      Folding  0.4137276     0.1953078
##   ci95_kcal.mol.x     library.x assay.x pdz.x pdz_name.x alignment_position.x
## 1       0.7800060 761_abundance folding   761  DLG4_PDZ3                  V53
## 2       0.7753419 761_abundance folding   761  DLG4_PDZ3                  V53
## 3       1.7029230 761_abundance folding   761  DLG4_PDZ3                  V53
## 4       0.9396246 761_abundance folding   761  DLG4_PDZ3                  V53
## 5       0.8434296 761_abundance folding   761  DLG4_PDZ3                  V53
## 6       0.7656068 761_abundance folding   761  DLG4_PDZ3                  V53
##   WT_aa.x structural_alignment_pos.x    consv.x HAmin_ligand.x scHAmin_ligand.x
## 1       A                         53 0.02246867       10.57668          12.9716
## 2       A                         53 0.02246867       10.57668          12.9716
## 3       A                         53 0.02246867       10.57668          12.9716
## 4       A                         53 0.02246867       10.57668          12.9716
## 5       A                         53 0.02246867       10.57668          12.9716
## 6       A                         53 0.02246867       10.57668          12.9716
##      X1.x     X2.x     X3.x    X4.x    X5.x    X6.x     X7.x     X8.x    X9.x
## 1 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 2 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 3 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 4 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 5 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 6 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
##   Pos_ref.x closest_ligand_pos.x closest_ligand_aa.x binding_interface_5A.x
## 1       343                    9                   V                  FALSE
## 2       343                    9                   V                  FALSE
## 3       343                    9                   V                  FALSE
## 4       343                    9                   V                  FALSE
## 5       343                    9                   V                  FALSE
## 6       343                    9                   V                  FALSE
##   WT_aa.1.x secondary_structure.x   rsasa.x structure_location.x wt_aa.x
## 1         A                  loop 0.8103598              surface       A
## 2         A                  loop 0.8103598              surface       A
## 3         A                  loop 0.8103598              surface       A
## 4         A                  loop 0.8103598              surface       A
## 5         A                  loop 0.8103598              surface       A
## 6         A                  loop 0.8103598              surface       A
##   mt_aa.x pos_eve.x popEVE.x ESM1v.x  X.y V1.y id_old.y pos_am.y trait_name.y
## 1       C       386   -4.577 -10.991 2158 2160     A33C       33      Binding
## 2       D       386   -4.690 -11.585 2159 2161     A33D       33      Binding
## 3       E       386   -4.522 -10.914 2160 2162     A33E       33      Binding
## 4       F       386   -5.093 -13.794 2161 2163     A33F       33      Binding
## 5       G       386   -4.008  -7.404 2162 2164     A33G       33      Binding
## 6       I       386   -4.718 -11.800 2163 2165     A33I       33      Binding
##    b_ddg_pred b_ddg_pred_sd ci95_kcal.mol.y library.y assay.y pdz.y pdz_name.y
## 1  0.11921857    0.06126311       0.2401514   761_808 binding   761  DLG4_PDZ3
## 2 -0.02530033    0.82292100       3.2258503   761_808 binding   761  DLG4_PDZ3
## 3  0.04624840    0.06722154       0.2635084   761_808 binding   761  DLG4_PDZ3
## 4  0.27775264    0.16555277       0.6489668   761_808 binding   761  DLG4_PDZ3
## 5  0.06452813    0.07905913       0.3099118   761_808 binding   761  DLG4_PDZ3
## 6  0.07812631    0.49614970       1.9449068   761_808 binding   761  DLG4_PDZ3
##   alignment_position.y WT_aa.y structural_alignment_pos.y    consv.y
## 1                  V53       A                         53 0.02246867
## 2                  V53       A                         53 0.02246867
## 3                  V53       A                         53 0.02246867
## 4                  V53       A                         53 0.02246867
## 5                  V53       A                         53 0.02246867
## 6                  V53       A                         53 0.02246867
##   HAmin_ligand.y scHAmin_ligand.y    X1.y     X2.y     X3.y    X4.y    X5.y
## 1       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 2       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 3       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 4       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 5       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 6       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
##      X6.y     X7.y     X8.y    X9.y Pos_ref.y closest_ligand_pos.y
## 1 14.1115 18.51017 13.41275 12.9716       343                    9
## 2 14.1115 18.51017 13.41275 12.9716       343                    9
## 3 14.1115 18.51017 13.41275 12.9716       343                    9
## 4 14.1115 18.51017 13.41275 12.9716       343                    9
## 5 14.1115 18.51017 13.41275 12.9716       343                    9
## 6 14.1115 18.51017 13.41275 12.9716       343                    9
##   closest_ligand_aa.y binding_interface_5A.y WT_aa.1.y secondary_structure.y
## 1                   V                  FALSE         A                  loop
## 2                   V                  FALSE         A                  loop
## 3                   V                  FALSE         A                  loop
## 4                   V                  FALSE         A                  loop
## 5                   V                  FALSE         A                  loop
## 6                   V                  FALSE         A                  loop
##     rsasa.y structure_location.y wt_aa.y mt_aa.y pos_eve.y popEVE.y ESM1v.y
## 1 0.8103598              surface       A       C       386   -4.577 -10.991
## 2 0.8103598              surface       A       D       386   -4.690 -11.585
## 3 0.8103598              surface       A       E       386   -4.522 -10.914
## 4 0.8103598              surface       A       F       386   -5.093 -13.794
## 5 0.8103598              surface       A       G       386   -4.008  -7.404
## 6 0.8103598              surface       A       I       386   -4.718 -11.800
##       z_stab    p_stab   z_destab   p_destab         class
## 1  3.3466602 0.9995910  0.8338590 0.20218022     no change
## 2  0.7921010 0.7858491 -1.7358159 0.95870181     no change
## 3 -0.6128781 0.2699785 -1.7638403 0.96112056     no change
## 4  4.1890228 0.9999860  2.1030834 0.01772924 destabilizing
## 5  2.6778755 0.9962955  0.3540300 0.36165821     no change
## 6  2.1183358 0.9829267 -0.4417253 0.67065601     no change
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric }\OtherTok{\textless{}{-}} \ConstantTok{FALSE}
\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric[pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{Pos\_ref.x }\SpecialCharTok{\%in\%}\NormalTok{ ortho\_list] }\OtherTok{\textless{}{-}} \ConstantTok{TRUE}

\FunctionTok{table}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## FALSE  TRUE 
##  1341   246
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#FALSE  TRUE }
\CommentTok{\# 1341   246 }
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_all }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot}
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_all)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1587
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred), ]}
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddg\_2plot) }\CommentTok{\#1567}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1567
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(pdz3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   id_eve X.x V1.x id_old.x pos_am.x trait_name.x f_ddg_pred f_ddg_pred_sd
## 1  A386C 595  596     A33C       33      Folding  0.6659222     0.1989811
## 2  A386D 596  597     A33D       33      Folding  0.1566707     0.1977913
## 3  A386E 597  598     A33E       33      Folding -0.2662460     0.4344191
## 4  A386F 598  599     A33F       33      Folding  1.0041094     0.2397002
## 5  A386G 599  600     A33G       33      Folding  0.5761733     0.2151606
## 6  A386I 600  601     A33I       33      Folding  0.4137276     0.1953078
##   ci95_kcal.mol.x     library.x assay.x pdz.x pdz_name.x alignment_position.x
## 1       0.7800060 761_abundance folding   761  DLG4_PDZ3                  V53
## 2       0.7753419 761_abundance folding   761  DLG4_PDZ3                  V53
## 3       1.7029230 761_abundance folding   761  DLG4_PDZ3                  V53
## 4       0.9396246 761_abundance folding   761  DLG4_PDZ3                  V53
## 5       0.8434296 761_abundance folding   761  DLG4_PDZ3                  V53
## 6       0.7656068 761_abundance folding   761  DLG4_PDZ3                  V53
##   WT_aa.x structural_alignment_pos.x    consv.x HAmin_ligand.x scHAmin_ligand.x
## 1       A                         53 0.02246867       10.57668          12.9716
## 2       A                         53 0.02246867       10.57668          12.9716
## 3       A                         53 0.02246867       10.57668          12.9716
## 4       A                         53 0.02246867       10.57668          12.9716
## 5       A                         53 0.02246867       10.57668          12.9716
## 6       A                         53 0.02246867       10.57668          12.9716
##      X1.x     X2.x     X3.x    X4.x    X5.x    X6.x     X7.x     X8.x    X9.x
## 1 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 2 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 3 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 4 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 5 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 6 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
##   Pos_ref.x closest_ligand_pos.x closest_ligand_aa.x binding_interface_5A.x
## 1       343                    9                   V                  FALSE
## 2       343                    9                   V                  FALSE
## 3       343                    9                   V                  FALSE
## 4       343                    9                   V                  FALSE
## 5       343                    9                   V                  FALSE
## 6       343                    9                   V                  FALSE
##   WT_aa.1.x secondary_structure.x   rsasa.x structure_location.x wt_aa.x
## 1         A                  loop 0.8103598              surface       A
## 2         A                  loop 0.8103598              surface       A
## 3         A                  loop 0.8103598              surface       A
## 4         A                  loop 0.8103598              surface       A
## 5         A                  loop 0.8103598              surface       A
## 6         A                  loop 0.8103598              surface       A
##   mt_aa.x pos_eve.x popEVE.x ESM1v.x  X.y V1.y id_old.y pos_am.y trait_name.y
## 1       C       386   -4.577 -10.991 2158 2160     A33C       33      Binding
## 2       D       386   -4.690 -11.585 2159 2161     A33D       33      Binding
## 3       E       386   -4.522 -10.914 2160 2162     A33E       33      Binding
## 4       F       386   -5.093 -13.794 2161 2163     A33F       33      Binding
## 5       G       386   -4.008  -7.404 2162 2164     A33G       33      Binding
## 6       I       386   -4.718 -11.800 2163 2165     A33I       33      Binding
##    b_ddg_pred b_ddg_pred_sd ci95_kcal.mol.y library.y assay.y pdz.y pdz_name.y
## 1  0.11921857    0.06126311       0.2401514   761_808 binding   761  DLG4_PDZ3
## 2 -0.02530033    0.82292100       3.2258503   761_808 binding   761  DLG4_PDZ3
## 3  0.04624840    0.06722154       0.2635084   761_808 binding   761  DLG4_PDZ3
## 4  0.27775264    0.16555277       0.6489668   761_808 binding   761  DLG4_PDZ3
## 5  0.06452813    0.07905913       0.3099118   761_808 binding   761  DLG4_PDZ3
## 6  0.07812631    0.49614970       1.9449068   761_808 binding   761  DLG4_PDZ3
##   alignment_position.y WT_aa.y structural_alignment_pos.y    consv.y
## 1                  V53       A                         53 0.02246867
## 2                  V53       A                         53 0.02246867
## 3                  V53       A                         53 0.02246867
## 4                  V53       A                         53 0.02246867
## 5                  V53       A                         53 0.02246867
## 6                  V53       A                         53 0.02246867
##   HAmin_ligand.y scHAmin_ligand.y    X1.y     X2.y     X3.y    X4.y    X5.y
## 1       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 2       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 3       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 4       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 5       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 6       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
##      X6.y     X7.y     X8.y    X9.y Pos_ref.y closest_ligand_pos.y
## 1 14.1115 18.51017 13.41275 12.9716       343                    9
## 2 14.1115 18.51017 13.41275 12.9716       343                    9
## 3 14.1115 18.51017 13.41275 12.9716       343                    9
## 4 14.1115 18.51017 13.41275 12.9716       343                    9
## 5 14.1115 18.51017 13.41275 12.9716       343                    9
## 6 14.1115 18.51017 13.41275 12.9716       343                    9
##   closest_ligand_aa.y binding_interface_5A.y WT_aa.1.y secondary_structure.y
## 1                   V                  FALSE         A                  loop
## 2                   V                  FALSE         A                  loop
## 3                   V                  FALSE         A                  loop
## 4                   V                  FALSE         A                  loop
## 5                   V                  FALSE         A                  loop
## 6                   V                  FALSE         A                  loop
##     rsasa.y structure_location.y wt_aa.y mt_aa.y pos_eve.y popEVE.y ESM1v.y
## 1 0.8103598              surface       A       C       386   -4.577 -10.991
## 2 0.8103598              surface       A       D       386   -4.690 -11.585
## 3 0.8103598              surface       A       E       386   -4.522 -10.914
## 4 0.8103598              surface       A       F       386   -5.093 -13.794
## 5 0.8103598              surface       A       G       386   -4.008  -7.404
## 6 0.8103598              surface       A       I       386   -4.718 -11.800
##       z_stab    p_stab   z_destab   p_destab         class orthosteric
## 1  3.3466602 0.9995910  0.8338590 0.20218022     no change       FALSE
## 2  0.7921010 0.7858491 -1.7358159 0.95870181     no change       FALSE
## 3 -0.6128781 0.2699785 -1.7638403 0.96112056     no change       FALSE
## 4  4.1890228 0.9999860  2.1030834 0.01772924 destabilizing       FALSE
## 5  2.6778755 0.9962955  0.3540300 0.36165821     no change       FALSE
## 6  2.1183358 0.9829267 -0.4417253 0.67065601     no change       FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(id\_eve, f\_ddg\_pred, f\_ddg\_pred\_sd,}
\NormalTok{                                                                     ESM1v.x, b\_ddg\_pred, b\_ddg\_pred\_sd,}
\NormalTok{                                                                     orthosteric,class) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(}\AttributeTok{ESM1v =}\NormalTok{ ESM1v.x)}

\NormalTok{pdz3\_final\_df\_ddg\_2plot\_active }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{mean}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_active}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred) }\CommentTok{\#0.837005}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.837005
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric }\OtherTok{\textless{}{-}} \ConstantTok{FALSE}
\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric[pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred }\SpecialCharTok{\textgreater{}=} \FunctionTok{mean}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_active}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred)] }\OtherTok{\textless{}{-}} \ConstantTok{TRUE}
\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric[pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{FALSE}
\FunctionTok{table}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## FALSE  TRUE 
##  1202   365
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(pdz3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   id_eve f_ddg_pred f_ddg_pred_sd   ESM1v  b_ddg_pred b_ddg_pred_sd orthosteric
## 1  A386C  0.6659222     0.1989811 -10.991  0.11921857    0.06126311       FALSE
## 2  A386D  0.1566707     0.1977913 -11.585 -0.02530033    0.82292100       FALSE
## 3  A386E -0.2662460     0.4344191 -10.914  0.04624840    0.06722154       FALSE
## 4  A386F  1.0041094     0.2397002 -13.794  0.27775264    0.16555277       FALSE
## 5  A386G  0.5761733     0.2151606  -7.404  0.06452813    0.07905913       FALSE
## 6  A386I  0.4137276     0.1953078 -11.800  0.07812631    0.49614970       FALSE
##           class allosteric
## 1     no change      FALSE
## 2     no change      FALSE
## 3     no change      FALSE
## 4 destabilizing      FALSE
## 5     no change      FALSE
## 6     no change      FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Function to bootstrap adjusted R{-}squared}
\NormalTok{bootstrap\_adjusted\_r\_squared }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input\_data, model\_id, }\AttributeTok{n\_bootstrap =} \DecValTok{1000}\NormalTok{) \{}
  
  \CommentTok{\# Initialize a vector to store the adjusted R{-}squared values from each bootstrap}
\NormalTok{  adjusted\_r\_squared\_values }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(n\_bootstrap)}
  
  \CommentTok{\# Define the number of rows (n)}
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(input\_data)}
  
  \CommentTok{\# Number of predictors (p) {-} In your case, there are two predictors: f\_ddg\_pred and sos1\_ddg}
\NormalTok{  p }\OtherTok{\textless{}{-}} \DecValTok{2}
  
  \CommentTok{\# Total sum of squares (SST) for the original data}
\NormalTok{  ss\_total }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((input\_data}\SpecialCharTok{$}\NormalTok{ESM1v }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(input\_data}\SpecialCharTok{$}\NormalTok{ESM1v))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
  
  \CommentTok{\# Perform the bootstrapping}
  \ControlFlowTok{for}\NormalTok{ (k }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{n\_bootstrap) \{}
    \CommentTok{\# Sample indices with replacement}
\NormalTok{    indices }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n, }\AttributeTok{size =}\NormalTok{ n, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{)}
    
    \CommentTok{\# Create bootstrap samples for actual and predicted values using the sampled indices}
\NormalTok{    y\_bootstrap }\OtherTok{\textless{}{-}}\NormalTok{ input\_data}\SpecialCharTok{$}\NormalTok{ESM1v[indices]}
\NormalTok{    y\_hat\_bootstrap }\OtherTok{\textless{}{-}}\NormalTok{ input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]][indices]}
    
    \CommentTok{\# Residual sum of squares (SSR) for the bootstrap sample}
\NormalTok{    ss\_residual }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((y\_bootstrap }\SpecialCharTok{{-}}\NormalTok{ y\_hat\_bootstrap)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
    
    \CommentTok{\# Calculate regular R{-}squared for this bootstrap sample}
\NormalTok{    r\_squared }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ (ss\_residual }\SpecialCharTok{/}\NormalTok{ ss\_total)}
    
    \CommentTok{\# Calculate adjusted R{-}squared for this bootstrap sample}
\NormalTok{    adjusted\_r\_squared\_values[k] }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ r\_squared) }\SpecialCharTok{*}\NormalTok{ (n }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}}\NormalTok{ p }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{))}
\NormalTok{  \}}
  
  \CommentTok{\# Sort the adjusted R{-}squared values}
\NormalTok{  adjusted\_r\_squared\_sorted }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(adjusted\_r\_squared\_values)}
  
  \CommentTok{\# Get the 95\% confidence intervals}
\NormalTok{  lower\_ci }\OtherTok{\textless{}{-}}\NormalTok{ adjusted\_r\_squared\_sorted[}\FunctionTok{round}\NormalTok{(n\_bootstrap }\SpecialCharTok{*} \FloatTok{0.025}\NormalTok{)]}
\NormalTok{  upper\_ci }\OtherTok{\textless{}{-}}\NormalTok{ adjusted\_r\_squared\_sorted[}\FunctionTok{round}\NormalTok{(n\_bootstrap }\SpecialCharTok{*} \FloatTok{0.975}\NormalTok{)]}
  
  \CommentTok{\# Return the confidence intervals and the adjusted R{-}squared values}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{lower\_ci =}\NormalTok{ lower\_ci, }\AttributeTok{upper\_ci =}\NormalTok{ upper\_ci, }\AttributeTok{adjusted\_r\_squared\_values =}\NormalTok{ adjusted\_r\_squared\_values))}
\NormalTok{\}}

\NormalTok{fit\_model\_and\_diagnostics\_ddgf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input\_data, model\_id) \{}
  
  \CommentTok{\# Fit the linear regression model}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f\_ddg\_pred, }\AttributeTok{data =}\NormalTok{ input\_data)}
  
  \CommentTok{\# Calculate predictions and residuals}
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit, }\AttributeTok{newdata =}\NormalTok{ input\_data)}
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"residuals\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}}\NormalTok{ input\_data}\SpecialCharTok{$}\NormalTok{ESM1v }\SpecialCharTok{{-}}\NormalTok{ input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]]}
  
  \CommentTok{\# R{-}squared and Adjusted R{-}squared Calculation}
\NormalTok{  r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{r.squared}
\NormalTok{  adjusted\_r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{adj.r.squared}
  
  \CommentTok{\# Bootstrapping for adjusted R{-}squared, RMSE, and AIC}
\NormalTok{  bootstrap\_adj\_r2 }\OtherTok{\textless{}{-}} \FunctionTok{bootstrap\_adjusted\_r\_squared}\NormalTok{(input\_data, model\_id, }\AttributeTok{n\_bootstrap =} \DecValTok{1000}\NormalTok{)}
  
  \CommentTok{\# Print results}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Adjusted R{-}squared:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(adjusted\_r\_squared, }\DecValTok{4}\NormalTok{)))}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Adjusted R{-}squared 95\% CI:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{lower\_ci, }\DecValTok{4}\NormalTok{), }\StringTok{"{-}"}\NormalTok{, }\FunctionTok{round}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{upper\_ci, }\DecValTok{4}\NormalTok{)))}
  
  \CommentTok{\# Return fit object, AIC, RMSE, and adjusted R{-}squared confidence intervals}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}
    \AttributeTok{fit =}\NormalTok{ fit, }
    \AttributeTok{adj\_r2\_values =}\NormalTok{ bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{adjusted\_r\_squared\_values,  }
    \AttributeTok{adjusted\_r\_squared =}\NormalTok{ adjusted\_r\_squared,}
    \AttributeTok{adjusted\_r\_squared\_ci =} \FunctionTok{c}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{lower\_ci, bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{upper\_ci),}
    \AttributeTok{input\_data =}\NormalTok{ input\_data}
\NormalTok{  ))}
\NormalTok{\}}

\NormalTok{fit\_model\_and\_diagnostics\_ddga }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input\_data, model\_id) \{}
  
  \CommentTok{\# Fit the linear regression model}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ b\_ddg\_pred, }\AttributeTok{data =}\NormalTok{ input\_data)}
  
  \CommentTok{\# Calculate predictions and residuals}
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit, }\AttributeTok{newdata =}\NormalTok{ input\_data)}
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"residuals\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}}\NormalTok{ input\_data}\SpecialCharTok{$}\NormalTok{ESM1v }\SpecialCharTok{{-}}\NormalTok{ input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]]}
  
  \CommentTok{\# R{-}squared and Adjusted R{-}squared Calculation}
\NormalTok{  r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{r.squared}
\NormalTok{  adjusted\_r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{adj.r.squared}
  
  \CommentTok{\# Bootstrapping for adjusted R{-}squared, RMSE, and AIC}
\NormalTok{  bootstrap\_adj\_r2 }\OtherTok{\textless{}{-}} \FunctionTok{bootstrap\_adjusted\_r\_squared}\NormalTok{(input\_data, model\_id, }\AttributeTok{n\_bootstrap =} \DecValTok{1000}\NormalTok{)}
  
  \CommentTok{\# Print results}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Adjusted R{-}squared:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(adjusted\_r\_squared, }\DecValTok{4}\NormalTok{)))}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Adjusted R{-}squared 95\% CI:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{lower\_ci, }\DecValTok{4}\NormalTok{), }\StringTok{"{-}"}\NormalTok{, }\FunctionTok{round}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{upper\_ci, }\DecValTok{4}\NormalTok{)))}
  
  \CommentTok{\# Return fit object, AIC, RMSE, and adjusted R{-}squared confidence intervals}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}
    \AttributeTok{fit =}\NormalTok{ fit, }
    \AttributeTok{adj\_r2\_values =}\NormalTok{ bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{adjusted\_r\_squared\_values,  }
    \AttributeTok{adjusted\_r\_squared =}\NormalTok{ adjusted\_r\_squared,}
    \AttributeTok{adjusted\_r\_squared\_ci =} \FunctionTok{c}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{lower\_ci, bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{upper\_ci),}
    \AttributeTok{input\_data =}\NormalTok{ input\_data}
\NormalTok{  ))}
\NormalTok{\}}

\NormalTok{fit\_model\_and\_diagnostics\_both }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input\_data, model\_id) \{}
  
  \CommentTok{\# Fit the linear regression model}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f\_ddg\_pred }\SpecialCharTok{+}\NormalTok{ b\_ddg\_pred, }\AttributeTok{data =}\NormalTok{ input\_data)}
  
  \CommentTok{\# Calculate predictions and residuals}
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit, }\AttributeTok{newdata =}\NormalTok{ input\_data)}
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"residuals\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}}\NormalTok{ input\_data}\SpecialCharTok{$}\NormalTok{ESM1v }\SpecialCharTok{{-}}\NormalTok{ input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]]}
  
  \CommentTok{\# R{-}squared and Adjusted R{-}squared Calculation}
\NormalTok{  r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{r.squared}
\NormalTok{  adjusted\_r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{adj.r.squared}
  
  \CommentTok{\# Bootstrapping for adjusted R{-}squared, RMSE, and AIC}
\NormalTok{  bootstrap\_adj\_r2 }\OtherTok{\textless{}{-}} \FunctionTok{bootstrap\_adjusted\_r\_squared}\NormalTok{(input\_data, model\_id, }\AttributeTok{n\_bootstrap =} \DecValTok{1000}\NormalTok{)}
  
  \CommentTok{\# Print results}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Adjusted R{-}squared:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(adjusted\_r\_squared, }\DecValTok{4}\NormalTok{)))}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Adjusted R{-}squared 95\% CI:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{lower\_ci, }\DecValTok{4}\NormalTok{), }\StringTok{"{-}"}\NormalTok{, }\FunctionTok{round}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{upper\_ci, }\DecValTok{4}\NormalTok{)))}
  
  \CommentTok{\# Return fit object, AIC, RMSE, and adjusted R{-}squared confidence intervals}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}
    \AttributeTok{fit =}\NormalTok{ fit, }
    \AttributeTok{adj\_r2\_values =}\NormalTok{ bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{adjusted\_r\_squared\_values,  }
    \AttributeTok{adjusted\_r\_squared =}\NormalTok{ adjusted\_r\_squared,}
    \AttributeTok{adjusted\_r\_squared\_ci =} \FunctionTok{c}\NormalTok{(bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{lower\_ci, bootstrap\_adj\_r2}\SpecialCharTok{$}\NormalTok{upper\_ci),}
    \AttributeTok{input\_data =}\NormalTok{ input\_data}
\NormalTok{  ))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# MODEL 0: all mutations, ddGf + ddGa \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{11}\NormalTok{)}
\CommentTok{\# Usage example}
\NormalTok{m0\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m0"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.3273"
## [1] "Adjusted R-squared 95% CI: 0.2749 - 0.375"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m1\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.2147"
## [1] "Adjusted R-squared 95% CI: 0.1525 - 0.2681"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m2\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddga}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.2679"
## [1] "Adjusted R-squared 95% CI: 0.207 - 0.3224"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# MODEL 3: non{-}active mutations, ddGf + ddGa \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_non\_active }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{m3\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.3641"
## [1] "Adjusted R-squared 95% CI: 0.3123 - 0.4169"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m4\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m4"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.2568"
## [1] "Adjusted R-squared 95% CI: 0.1968 - 0.3145"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m5\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddga}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m5"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.3009"
## [1] "Adjusted R-squared 95% CI: 0.2397 - 0.3572"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# MODEL 6: active mutations, ddGf + ddGa \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_active }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{m6\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m6"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.1165"
## [1] "Adjusted R-squared 95% CI: -0.03 - 0.2523"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m7\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddga}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m7"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.1155"
## [1] "Adjusted R-squared 95% CI: -0.037 - 0.2582"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m8\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m8"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.1802"
## [1] "Adjusted R-squared 95% CI: 0.0403 - 0.308"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anova}\NormalTok{(m0\_results}\SpecialCharTok{$}\NormalTok{fit, m1\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: ESM1v ~ f_ddg_pred + b_ddg_pred
## Model 2: ESM1v ~ f_ddg_pred
##   Res.Df   RSS Df Sum of Sq      F    Pr(>F)    
## 1   1564 18199                                  
## 2   1565 21260 -1   -3061.2 263.07 < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 1: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred}
\CommentTok{\# Model 2: ESM1v \textasciitilde{} f\_ddg\_pred}
\CommentTok{\#   Res.Df   RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1   1564 18199                                  }
\CommentTok{\# 2   1565 21260 {-}1   {-}3061.2 263.07 \textless{} 2.2e{-}16 ***}
\FunctionTok{anova}\NormalTok{(m4\_results}\SpecialCharTok{$}\NormalTok{fit, m3\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: ESM1v ~ f_ddg_pred
## Model 2: ESM1v ~ f_ddg_pred + b_ddg_pred
##   Res.Df   RSS Df Sum of Sq      F    Pr(>F)    
## 1   1323 15721                                  
## 2   1322 13441  1    2279.3 224.18 < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 1: ESM1v \textasciitilde{} f\_ddg\_pred}
\CommentTok{\# Model 2: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred}
\CommentTok{\#   Res.Df   RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1   1323 15721                                  }
\CommentTok{\# 2   1322 13441  1    2279.3 224.18 \textless{} 2.2e{-}16 ***}
\FunctionTok{anova}\NormalTok{(m6\_results}\SpecialCharTok{$}\NormalTok{fit, m8\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: ESM1v ~ f_ddg_pred
## Model 2: ESM1v ~ f_ddg_pred + b_ddg_pred
##   Res.Df    RSS Df Sum of Sq      F    Pr(>F)    
## 1    240 1845.0                                  
## 2    239 1704.8  1    140.21 19.657 1.413e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 1: ESM1v \textasciitilde{} f\_ddg\_pred}
\CommentTok{\# Model 2: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1    240 1845.0                                  }
\CommentTok{\# 2    239 1704.8  1    140.21 19.657 1.413e{-}05 ***}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Step 1: Build raw data (same as before)}
\NormalTok{plot\_data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{category =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"whole protein"}\NormalTok{, }\StringTok{"non{-}orthosteric"}\NormalTok{, }\StringTok{"orthosteric"}\NormalTok{), }\AttributeTok{each =} \DecValTok{3000}\NormalTok{),}
  \AttributeTok{type =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"abundance"}\NormalTok{, }\StringTok{"activity"}\NormalTok{, }\StringTok{"both"}\NormalTok{), }\AttributeTok{times =} \DecValTok{3}\NormalTok{, }\AttributeTok{each =} \DecValTok{1000}\NormalTok{),}
  \AttributeTok{adj\_r2\_values =} \FunctionTok{c}\NormalTok{(}
\NormalTok{    m1\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, m2\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, m0\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values,}
\NormalTok{    m4\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, m5\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, m3\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values,}
\NormalTok{    m6\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, m7\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, m8\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values}
\NormalTok{  )}
\NormalTok{)}

\CommentTok{\# Step 2: Build CI summary table}
\NormalTok{ci\_summary }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{category =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"whole protein"}\NormalTok{, }\StringTok{"non{-}orthosteric"}\NormalTok{, }\StringTok{"orthosteric"}\NormalTok{), }\AttributeTok{each =} \DecValTok{3}\NormalTok{),}
  \AttributeTok{type =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"abundance"}\NormalTok{, }\StringTok{"activity"}\NormalTok{, }\StringTok{"both"}\NormalTok{), }\AttributeTok{times =} \DecValTok{3}\NormalTok{),}
  \AttributeTok{mean\_adj\_r2 =} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{mean}\NormalTok{(m1\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values), }\FunctionTok{mean}\NormalTok{(m2\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values), m0\_results}\SpecialCharTok{$}\NormalTok{adjusted\_r\_squared,}
    \FunctionTok{mean}\NormalTok{(m4\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values), }\FunctionTok{mean}\NormalTok{(m5\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values), }\FunctionTok{mean}\NormalTok{(m3\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values),}
    \FunctionTok{mean}\NormalTok{(m6\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values), }\FunctionTok{mean}\NormalTok{(m7\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values), }\FunctionTok{mean}\NormalTok{(m8\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values)}
\NormalTok{  ),}
  \AttributeTok{ci\_lower =} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{quantile}\NormalTok{(m1\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m2\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{), m0\_results}\SpecialCharTok{$}\NormalTok{adjusted\_r\_squared\_ci[}\DecValTok{1}\NormalTok{],}
    \FunctionTok{quantile}\NormalTok{(m4\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m5\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m3\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{),}
    \FunctionTok{quantile}\NormalTok{(m6\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m7\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m8\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.025}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ci\_upper =} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{quantile}\NormalTok{(m1\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m2\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{), m0\_results}\SpecialCharTok{$}\NormalTok{adjusted\_r\_squared\_ci[}\DecValTok{2}\NormalTok{],}
    \FunctionTok{quantile}\NormalTok{(m4\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m5\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m3\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{),}
    \FunctionTok{quantile}\NormalTok{(m6\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m7\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{), }\FunctionTok{quantile}\NormalTok{(m8\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values, }\FloatTok{0.975}\NormalTok{)}
\NormalTok{  )}
\NormalTok{)}

\CommentTok{\# Factor levels for consistency}
\NormalTok{plot\_data}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(plot\_data}\SpecialCharTok{$}\NormalTok{category, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"whole protein"}\NormalTok{, }\StringTok{"non{-}orthosteric"}\NormalTok{, }\StringTok{"orthosteric"}\NormalTok{))}
\NormalTok{plot\_data}\SpecialCharTok{$}\NormalTok{type }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(plot\_data}\SpecialCharTok{$}\NormalTok{type, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"abundance"}\NormalTok{, }\StringTok{"activity"}\NormalTok{, }\StringTok{"both"}\NormalTok{))}
\NormalTok{ci\_summary}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ci\_summary}\SpecialCharTok{$}\NormalTok{category, }\AttributeTok{levels =} \FunctionTok{levels}\NormalTok{(plot\_data}\SpecialCharTok{$}\NormalTok{category))}
\NormalTok{ci\_summary}\SpecialCharTok{$}\NormalTok{type }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ci\_summary}\SpecialCharTok{$}\NormalTok{type, }\AttributeTok{levels =} \FunctionTok{levels}\NormalTok{(plot\_data}\SpecialCharTok{$}\NormalTok{type))}

\CommentTok{\# Step 3: Plot using CI summary for bars}
\NormalTok{fig3E }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ci\_summary, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ type, }\AttributeTok{y =}\NormalTok{ mean\_adj\_r2, }\AttributeTok{fill =}\NormalTok{ type)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.85}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ ci\_lower, }\AttributeTok{ymax =}\NormalTok{ ci\_upper), }\AttributeTok{width =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f"}\NormalTok{, mean\_adj\_r2)), }\AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{1.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{5}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{category) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
    \AttributeTok{axis.line =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.6}\NormalTok{),}
    \AttributeTok{strip.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{16}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{16}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{12}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
    \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{16}\NormalTok{, }\AttributeTok{face =} \StringTok{"italic"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3"}\NormalTok{, }
    \AttributeTok{subtitle =} \StringTok{"Linear regression against ESM1v"}\NormalTok{, }
    \AttributeTok{x =} \StringTok{""}\NormalTok{, }
    \AttributeTok{y =} \StringTok{"Adjusted R"}
\NormalTok{  ) }\SpecialCharTok{+}
  \CommentTok{\# Significance comparisons using full plot\_data}
  \FunctionTok{geom\_signif}\NormalTok{(}\AttributeTok{data =} \FunctionTok{subset}\NormalTok{(plot\_data, category }\SpecialCharTok{==} \StringTok{"whole protein"}\NormalTok{),}
              \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ type, }\AttributeTok{y =}\NormalTok{ adj\_r2\_values),}
              \AttributeTok{comparisons =} \FunctionTok{list}\NormalTok{( }\FunctionTok{c}\NormalTok{(}\StringTok{"abundance"}\NormalTok{, }\StringTok{"both"}\NormalTok{)),}
              \AttributeTok{annotations =} \StringTok{"p \textless{} 2.2e{-}16"}\NormalTok{,}
              \AttributeTok{y\_position =} \FunctionTok{c}\NormalTok{( }\FloatTok{0.65}\NormalTok{),}
              \AttributeTok{tip\_length =} \FloatTok{0.02}\NormalTok{,}
              \AttributeTok{step\_increase =} \FloatTok{0.05}\NormalTok{,}
              \AttributeTok{test =} \StringTok{"wilcox.test"}\NormalTok{,}
              \AttributeTok{textsize =} \DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_signif}\NormalTok{(}\AttributeTok{data =} \FunctionTok{subset}\NormalTok{(plot\_data, category }\SpecialCharTok{==} \StringTok{"non{-}orthosteric"}\NormalTok{),}
              \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ type, }\AttributeTok{y =}\NormalTok{ adj\_r2\_values),}
              \AttributeTok{comparisons =} \FunctionTok{list}\NormalTok{( }\FunctionTok{c}\NormalTok{(}\StringTok{"abundance"}\NormalTok{, }\StringTok{"both"}\NormalTok{)),}
              \AttributeTok{annotations =} \StringTok{"p \textless{} 2.2e{-}16"}\NormalTok{,}
              \AttributeTok{y\_position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.65}\NormalTok{),}
              \AttributeTok{tip\_length =} \FloatTok{0.02}\NormalTok{,}
              \AttributeTok{step\_increase =} \FloatTok{0.05}\NormalTok{,}
              \AttributeTok{test =} \StringTok{"wilcox.test"}\NormalTok{,}
              \AttributeTok{textsize =} \DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_signif}\NormalTok{(}\AttributeTok{data =} \FunctionTok{subset}\NormalTok{(plot\_data, category }\SpecialCharTok{==} \StringTok{"orthosteric"}\NormalTok{),}
              \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ type, }\AttributeTok{y =}\NormalTok{ adj\_r2\_values),}
              \AttributeTok{comparisons =} \FunctionTok{list}\NormalTok{( }\FunctionTok{c}\NormalTok{(}\StringTok{"abundance"}\NormalTok{, }\StringTok{"both"}\NormalTok{)),}
              \AttributeTok{annotations =} \StringTok{"p = 1.413e{-}05"}\NormalTok{,}
              \AttributeTok{y\_position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.65}\NormalTok{),}
              \AttributeTok{step\_increase =} \FloatTok{0.05}\NormalTok{,}
              \AttributeTok{test =} \StringTok{"wilcox.test"}\NormalTok{,}
              \AttributeTok{textsize =} \DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in geom_signif(data = subset(plot_data, category == "whole protein"), :
## You have set data and mapping, are you sure that manual = FALSE is correct?
\end{verbatim}

\begin{verbatim}
## Warning in geom_signif(data = subset(plot_data, category == "non-orthosteric"),
## : You have set data and mapping, are you sure that manual = FALSE is correct?
\end{verbatim}

\begin{verbatim}
## Warning in geom_signif(data = subset(plot_data, category == "orthosteric"), :
## You have set data and mapping, are you sure that manual = FALSE is correct?
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_pdz\_barplot.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ fig3E, }\AttributeTok{width =} \DecValTok{8}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 6 rows containing non-finite outside the scale range
## (`stat_signif()`).
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fig3E}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 6 rows containing non-finite outside the scale range
## (`stat_signif()`).
\end{verbatim}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-5-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{doubledeepms\_\_minimum\_interchain\_distances\_from\_PDB\_perres }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    input\_file,}
  \AttributeTok{chain\_query =} \StringTok{"A"}\NormalTok{,}
  \AttributeTok{chain\_target =} \StringTok{"B"}
\NormalTok{  )\{}
  
  \CommentTok{\#load PDB structure}
\CommentTok{\#   sink(file = "/dev/null")}
\NormalTok{  pdb }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{read.pdb}\NormalTok{(input\_file, }\AttributeTok{rm.alt =} \ConstantTok{TRUE}\NormalTok{)}
\CommentTok{\#   sink()}

  \DocumentationTok{\#\#\# Atom selections}
  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

    \CommentTok{\#Protein atoms}
\NormalTok{  sele\_protein }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{atom.select}\NormalTok{(pdb, }\StringTok{"protein"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}
    \CommentTok{\#Hydrogen atoms}
\NormalTok{  sele\_H }\OtherTok{\textless{}{-}}\NormalTok{bio3d}\SpecialCharTok{::}\FunctionTok{atom.select}\NormalTok{(pdb, }\StringTok{"h"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}
    \CommentTok{\#Water atoms}
\NormalTok{  sele\_water }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{atom.select}\NormalTok{(pdb, }\StringTok{"water"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}
    \CommentTok{\#Side chain atoms}
\NormalTok{  sele\_sc }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{atom.select}\NormalTok{(pdb, }\StringTok{"sidechain"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}
    \CommentTok{\#C{-}alpha atoms}
\NormalTok{  sele\_ca }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{atom.select}\NormalTok{(pdb, }\StringTok{"calpha"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}
    \CommentTok{\#Glycine c{-}alpha atoms}
\NormalTok{  sele\_glyca }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{atom.select}\NormalTok{(pdb, }\AttributeTok{resid =} \StringTok{"GLY"}\NormalTok{, }\AttributeTok{string =} \StringTok{"calpha"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}

  \DocumentationTok{\#\#\# Combine atom selections}
  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

  \CommentTok{\#Heavy atoms}
\NormalTok{    sele\_HA }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{combine.select}\NormalTok{(sele\_protein, sele\_H, sele\_water, }\AttributeTok{operator =} \StringTok{"{-}"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}

  \CommentTok{\#Side chain heavy atoms + c{-}alpha for glycine}
\NormalTok{    sele\_prot\_sc }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{combine.select}\NormalTok{(sele\_protein, sele\_sc, }\AttributeTok{operator =} \StringTok{"AND"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{    sele\_prot\_sc\_glyca }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{combine.select}\NormalTok{(sele\_prot\_sc, sele\_glyca, }\AttributeTok{operator =} \StringTok{"OR"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{    sele\_scHA }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{combine.select}\NormalTok{(sele\_prot\_sc\_glyca, sele\_H, sele\_water, }\AttributeTok{operator =} \StringTok{"{-}"}\NormalTok{, }\AttributeTok{verbose=}\ConstantTok{FALSE}\NormalTok{)}

    \CommentTok{\#List}
\NormalTok{    sele\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
        \StringTok{"HA"} \OtherTok{=}\NormalTok{ sele\_HA,}
        \StringTok{"scHA"} \OtherTok{=}\NormalTok{ sele\_scHA)}

  \DocumentationTok{\#\#\# Calculate minimum target chain distances}
  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{    result\_dt }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{(metric }\ControlFlowTok{in} \FunctionTok{names}\NormalTok{(sele\_list))\{}
      \CommentTok{\#Distance matrix}
\NormalTok{        pdb\_sub }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{trim.pdb}\NormalTok{(pdb, sele\_list[[metric]])}
\NormalTok{      dist\_mat }\OtherTok{\textless{}{-}}\NormalTok{ bio3d}\SpecialCharTok{::}\FunctionTok{dm.xyz}\NormalTok{(pdb\_sub}\SpecialCharTok{$}\NormalTok{xyz, }\AttributeTok{grpby=}\FunctionTok{apply}\NormalTok{(pdb\_sub}\SpecialCharTok{$}\NormalTok{atom[,}\FunctionTok{c}\NormalTok{(}\StringTok{"resno"}\NormalTok{, }\StringTok{"chain"}\NormalTok{)], }\DecValTok{1}\NormalTok{, paste, }\AttributeTok{collapse =} \StringTok{"\_"}\NormalTok{), }\AttributeTok{scut=}\DecValTok{0}\NormalTok{, }\AttributeTok{mask.lower =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{      resno\_sub }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(pdb\_sub}\SpecialCharTok{$}\NormalTok{atom[,}\FunctionTok{c}\NormalTok{(}\StringTok{"resno"}\NormalTok{, }\StringTok{"chain"}\NormalTok{)])}
      \CommentTok{\#Ligand distance matrix}
\NormalTok{      ligand\_dist }\OtherTok{\textless{}{-}}\NormalTok{ dist\_mat[resno\_sub[,}\StringTok{"chain"}\NormalTok{]}\SpecialCharTok{==}\NormalTok{chain\_query,resno\_sub[,}\StringTok{"chain"}\NormalTok{]}\SpecialCharTok{==}\NormalTok{chain\_target]}
\NormalTok{      ligand\_dist\_df }\OtherTok{\textless{}{-}}\NormalTok{ ligand\_dist}
      \FunctionTok{colnames}\NormalTok{(ligand\_dist\_df) }\OtherTok{\textless{}{-}}\NormalTok{ resno\_sub[resno\_sub[,}\StringTok{"chain"}\NormalTok{]}\SpecialCharTok{==}\NormalTok{chain\_target,}\StringTok{"resno"}\NormalTok{]}
      \FunctionTok{rownames}\NormalTok{(ligand\_dist\_df) }\OtherTok{\textless{}{-}}\NormalTok{ resno\_sub[resno\_sub[,}\StringTok{"chain"}\NormalTok{]}\SpecialCharTok{==}\NormalTok{chain\_query,}\StringTok{"resno"}\NormalTok{]}
      \CommentTok{\#chain target names}
      \CommentTok{\#Absolute residue number}
\NormalTok{      ligand\_dist\_dt }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\AttributeTok{Pos =}\NormalTok{ resno\_sub[resno\_sub[,}\StringTok{"chain"}\NormalTok{]}\SpecialCharTok{==}\NormalTok{chain\_query,}\StringTok{"resno"}\NormalTok{])}
      \CommentTok{\#Minimum ligand distance}
\NormalTok{      ligand\_dist\_dt[, min\_dist }\SpecialCharTok{:=} \FunctionTok{apply}\NormalTok{(ligand\_dist, }\DecValTok{1}\NormalTok{, min)]}
      \FunctionTok{names}\NormalTok{(ligand\_dist\_dt)[}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(metric, }\StringTok{"min\_ligand"}\NormalTok{)}
      \ControlFlowTok{if}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(result\_dt)}\SpecialCharTok{==}\DecValTok{0}\NormalTok{)\{}
\NormalTok{        result\_dt }\OtherTok{\textless{}{-}}\NormalTok{ ligand\_dist\_dt}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        result\_dt }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(result\_dt, ligand\_dist\_dt, }\AttributeTok{by =} \StringTok{"Pos"}\NormalTok{, }\AttributeTok{all =}\NormalTok{ T)}
\NormalTok{      \}}
\NormalTok{     result\_dt\_with\_ligand\_matrix }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(result\_dt, ligand\_dist\_df)}
\NormalTok{  \}}

  \CommentTok{\#Return}
    \FunctionTok{return}\NormalTok{(result\_dt\_with\_ligand\_matrix)}

\NormalTok{\}}

\NormalTok{pdz3\_out }\OtherTok{\textless{}{-}} \FunctionTok{doubledeepms\_\_minimum\_interchain\_distances\_from\_PDB\_perres}\NormalTok{(}
  \AttributeTok{input\_file =} \StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/residual\_pdb/domains/1be9.pdb"}\NormalTok{,}
  \AttributeTok{chain\_query =} \StringTok{"A"}\NormalTok{,}
  \AttributeTok{chain\_target =} \StringTok{"B"}
\NormalTok{)}

\NormalTok{pdz3\_out}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Key: <Pos>
##        Pos HAmin_ligand scHAmin_ligand        5        6        7        8
##      <int>        <num>          <num>    <num>    <num>    <num>    <num>
##   1:   301     27.81682       29.29812 36.60292 29.29812 34.28569 31.58151
##   2:   302     24.77413       24.77413 32.59924 25.50251 29.70773 26.95297
##   3:   303     23.61197       23.88436 30.97802 23.88436 29.30675 27.23208
##   4:   304     25.56612       27.36444 34.43185 27.36444 33.26058 31.46158
##   5:   305     24.06314       26.75911 32.99787 26.75911 31.21189 29.67537
##  ---                                                                      
## 111:   411     16.60658       18.35828 25.27723 18.35828 24.70556 23.51490
## 112:   412     11.83225       11.83225 18.16193 11.83225 17.95221 17.84223
## 113:   413     14.18169       16.69390 23.98139 16.69390 24.61715 23.71109
## 114:   414     11.22331       11.22331 18.87227 11.22331 19.65124 18.73224
## 115:   415     14.62439       16.80815 23.80095 16.80815 25.75406 24.65175
##             9
##         <num>
##   1: 29.91678
##   2: 24.77413
##   3: 25.79389
##   4: 29.93395
##   5: 26.89401
##  ---         
## 111: 22.07162
## 112: 16.53124
## 113: 23.90523
## 114: 19.91609
## 115: 26.47222
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_out }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Fit a loess model using the filtered data}
\NormalTok{loess\_fit }\OtherTok{\textless{}{-}} \FunctionTok{loess}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f\_ddg\_pred, }\AttributeTok{data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_out, }\AttributeTok{span =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{family =} \StringTok{"symmetric"}\NormalTok{)}

\CommentTok{\# Predict fitted values for ALL data points using the loess model }
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{fitted }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(loess\_fit, }\AttributeTok{newdata =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_all)}

\CommentTok{\# Calculate residuals for ALL points}
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{residuals }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{ESM1v.x }\SpecialCharTok{{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{fitted}

\FunctionTok{head}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_all)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   id_eve X.x V1.x id_old.x pos_am.x trait_name.x f_ddg_pred f_ddg_pred_sd
## 1  A386C 595  596     A33C       33      Folding  0.6659222     0.1989811
## 2  A386D 596  597     A33D       33      Folding  0.1566707     0.1977913
## 3  A386E 597  598     A33E       33      Folding -0.2662460     0.4344191
## 4  A386F 598  599     A33F       33      Folding  1.0041094     0.2397002
## 5  A386G 599  600     A33G       33      Folding  0.5761733     0.2151606
## 6  A386I 600  601     A33I       33      Folding  0.4137276     0.1953078
##   ci95_kcal.mol.x     library.x assay.x pdz.x pdz_name.x alignment_position.x
## 1       0.7800060 761_abundance folding   761  DLG4_PDZ3                  V53
## 2       0.7753419 761_abundance folding   761  DLG4_PDZ3                  V53
## 3       1.7029230 761_abundance folding   761  DLG4_PDZ3                  V53
## 4       0.9396246 761_abundance folding   761  DLG4_PDZ3                  V53
## 5       0.8434296 761_abundance folding   761  DLG4_PDZ3                  V53
## 6       0.7656068 761_abundance folding   761  DLG4_PDZ3                  V53
##   WT_aa.x structural_alignment_pos.x    consv.x HAmin_ligand.x scHAmin_ligand.x
## 1       A                         53 0.02246867       10.57668          12.9716
## 2       A                         53 0.02246867       10.57668          12.9716
## 3       A                         53 0.02246867       10.57668          12.9716
## 4       A                         53 0.02246867       10.57668          12.9716
## 5       A                         53 0.02246867       10.57668          12.9716
## 6       A                         53 0.02246867       10.57668          12.9716
##      X1.x     X2.x     X3.x    X4.x    X5.x    X6.x     X7.x     X8.x    X9.x
## 1 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 2 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 3 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 4 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 5 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
## 6 32.8174 28.13485 28.25736 23.3578 22.6831 14.1115 18.51017 13.41275 12.9716
##   Pos_ref.x closest_ligand_pos.x closest_ligand_aa.x binding_interface_5A.x
## 1       343                    9                   V                  FALSE
## 2       343                    9                   V                  FALSE
## 3       343                    9                   V                  FALSE
## 4       343                    9                   V                  FALSE
## 5       343                    9                   V                  FALSE
## 6       343                    9                   V                  FALSE
##   WT_aa.1.x secondary_structure.x   rsasa.x structure_location.x wt_aa.x
## 1         A                  loop 0.8103598              surface       A
## 2         A                  loop 0.8103598              surface       A
## 3         A                  loop 0.8103598              surface       A
## 4         A                  loop 0.8103598              surface       A
## 5         A                  loop 0.8103598              surface       A
## 6         A                  loop 0.8103598              surface       A
##   mt_aa.x pos_eve.x popEVE.x ESM1v.x  X.y V1.y id_old.y pos_am.y trait_name.y
## 1       C       386   -4.577 -10.991 2158 2160     A33C       33      Binding
## 2       D       386   -4.690 -11.585 2159 2161     A33D       33      Binding
## 3       E       386   -4.522 -10.914 2160 2162     A33E       33      Binding
## 4       F       386   -5.093 -13.794 2161 2163     A33F       33      Binding
## 5       G       386   -4.008  -7.404 2162 2164     A33G       33      Binding
## 6       I       386   -4.718 -11.800 2163 2165     A33I       33      Binding
##    b_ddg_pred b_ddg_pred_sd ci95_kcal.mol.y library.y assay.y pdz.y pdz_name.y
## 1  0.11921857    0.06126311       0.2401514   761_808 binding   761  DLG4_PDZ3
## 2 -0.02530033    0.82292100       3.2258503   761_808 binding   761  DLG4_PDZ3
## 3  0.04624840    0.06722154       0.2635084   761_808 binding   761  DLG4_PDZ3
## 4  0.27775264    0.16555277       0.6489668   761_808 binding   761  DLG4_PDZ3
## 5  0.06452813    0.07905913       0.3099118   761_808 binding   761  DLG4_PDZ3
## 6  0.07812631    0.49614970       1.9449068   761_808 binding   761  DLG4_PDZ3
##   alignment_position.y WT_aa.y structural_alignment_pos.y    consv.y
## 1                  V53       A                         53 0.02246867
## 2                  V53       A                         53 0.02246867
## 3                  V53       A                         53 0.02246867
## 4                  V53       A                         53 0.02246867
## 5                  V53       A                         53 0.02246867
## 6                  V53       A                         53 0.02246867
##   HAmin_ligand.y scHAmin_ligand.y    X1.y     X2.y     X3.y    X4.y    X5.y
## 1       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 2       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 3       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 4       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 5       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
## 6       10.57668          12.9716 32.8174 28.13485 28.25736 23.3578 22.6831
##      X6.y     X7.y     X8.y    X9.y Pos_ref.y closest_ligand_pos.y
## 1 14.1115 18.51017 13.41275 12.9716       343                    9
## 2 14.1115 18.51017 13.41275 12.9716       343                    9
## 3 14.1115 18.51017 13.41275 12.9716       343                    9
## 4 14.1115 18.51017 13.41275 12.9716       343                    9
## 5 14.1115 18.51017 13.41275 12.9716       343                    9
## 6 14.1115 18.51017 13.41275 12.9716       343                    9
##   closest_ligand_aa.y binding_interface_5A.y WT_aa.1.y secondary_structure.y
## 1                   V                  FALSE         A                  loop
## 2                   V                  FALSE         A                  loop
## 3                   V                  FALSE         A                  loop
## 4                   V                  FALSE         A                  loop
## 5                   V                  FALSE         A                  loop
## 6                   V                  FALSE         A                  loop
##     rsasa.y structure_location.y wt_aa.y mt_aa.y pos_eve.y popEVE.y ESM1v.y
## 1 0.8103598              surface       A       C       386   -4.577 -10.991
## 2 0.8103598              surface       A       D       386   -4.690 -11.585
## 3 0.8103598              surface       A       E       386   -4.522 -10.914
## 4 0.8103598              surface       A       F       386   -5.093 -13.794
## 5 0.8103598              surface       A       G       386   -4.008  -7.404
## 6 0.8103598              surface       A       I       386   -4.718 -11.800
##       z_stab    p_stab   z_destab   p_destab         class orthosteric
## 1  3.3466602 0.9995910  0.8338590 0.20218022     no change       FALSE
## 2  0.7921010 0.7858491 -1.7358159 0.95870181     no change       FALSE
## 3 -0.6128781 0.2699785 -1.7638403 0.96112056     no change       FALSE
## 4  4.1890228 0.9999860  2.1030834 0.01772924 destabilizing       FALSE
## 5  2.6778755 0.9962955  0.3540300 0.36165821     no change       FALSE
## 6  2.1183358 0.9829267 -0.4417253 0.67065601     no change       FALSE
##       fitted  residuals
## 1 -10.329862 -0.6611377
## 2  -8.317484 -3.2675161
## 3  -8.064120 -2.8498800
## 4 -11.402020 -2.3919800
## 5  -9.986755  2.5827550
## 6  -9.214440 -2.5855602
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{median\_residuals }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_all }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(Pos\_ref.x) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{median\_residuals =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}

\FunctionTok{min}\NormalTok{(median\_residuals}\SpecialCharTok{$}\NormalTok{median\_residuals) }\CommentTok{\#{-}7.508073}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -7.508073
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{max}\NormalTok{(median\_residuals}\SpecialCharTok{$}\NormalTok{median\_residuals) }\CommentTok{\#7.583395}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.583395
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#color byattribute a:bfactor \#10 \& sel target csab palette {-}8,red:0,white:8,blue}

\FunctionTok{library}\NormalTok{(bio3d)}
\NormalTok{pdb }\OtherTok{\textless{}{-}} \FunctionTok{read.pdb}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/residual\_pdb/domains/1be9.pdb"}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ median\_residuals}
\FunctionTok{head}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   Pos_ref.x median_residuals
##       <dbl>            <dbl>
## 1       311           -1.24 
## 2       312            0.247
## 3       313            0.659
## 4       314            1.81 
## 5       315            4.73 
## 6       316            2.61
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a new B{-}factor vector initialized with the current B{-}factors from the PDB}
\NormalTok{new\_b\_factors }\OtherTok{\textless{}{-}}\NormalTok{ pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{b}

\CommentTok{\# Loop through each position in the correlation data and update the B{-}factors}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data)) \{}
\NormalTok{  position }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{Pos\_ref.x[i]}
\NormalTok{  correlation\_value }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{median\_residuals[i]}

  \CommentTok{\# Find indices in the PDB that match the current position}
\NormalTok{  indices }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{resno }\SpecialCharTok{==}\NormalTok{ position)}

  \CommentTok{\# Print the indices and current B{-}factors before updating}
  \CommentTok{\#cat("Updating residue number:", position, "\textbackslash{}n")}
  \CommentTok{\#cat("Indices in PDB:", indices, "\textbackslash{}n")}
  \CommentTok{\#cat("Current B{-}factors:", new\_b\_factors[indices], "\textbackslash{}n")}

  \CommentTok{\# Update B{-}factors for all atoms in the current residue}
\NormalTok{  new\_b\_factors[indices] }\OtherTok{\textless{}{-}}\NormalTok{ correlation\_value}

  \CommentTok{\# Print the new B{-}factors after updating}
  \CommentTok{\#cat("Updated B{-}factors:", new\_b\_factors[indices], "\textbackslash{}n")}
  \CommentTok{\#cat("\textbackslash{}n")  \# Add an extra line for readability}
\NormalTok{\}}
\CommentTok{\# Replace non{-}matching B{-}factors with outlier value so we can filter it out in ChimeraX}
\NormalTok{non\_matching\_indices }\OtherTok{\textless{}{-}} \FunctionTok{setdiff}\NormalTok{(}\FunctionTok{seq\_along}\NormalTok{(new\_b\_factors), }\FunctionTok{which}\NormalTok{(pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{resno }\SpecialCharTok{\%in\%}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{Pos\_ref.x))}
\NormalTok{non\_matching\_indices}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1]    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15
##  [16]   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30
##  [31]   31   32   33   34   35   36   37   38   39   40   41   42   43   44   45
##  [46]   46   47   48   49   50   51   52   53   54   55   56   57   58   59   60
##  [61]   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75
##  [76]   76   77   78  695  696  697  698  699  700  701  702  703  704  705  706
##  [91]  707  708  709  710  711  712  713  714  715  716  717  718  719  720  721
## [106]  722  723  724  725  726  727  728  729  730  731  732  733  734  735  736
## [121]  737  738  739  740  741  742  743  744  745  746  747  748  749  750  751
## [136]  752  753  754  755  756  757  758  759  760  761  762  763  764  765  766
## [151]  767  768  769  770  771  772  773  774  775  776  777  778  779  780  781
## [166]  782  783  784  785  786  787  788  789  790  791  792  793  794  795  796
## [181]  797  798  799  800  801  802  803  804  805  806  807  808  809  810  811
## [196]  812  813  814  815  816  817  818  819  820  821  822  823  824  825  826
## [211]  827  828  829  830  831  832  833  834  835  836  837  838  839  840  841
## [226]  842  843  844  845  846  847  848  849  850  851  852  853  854  855  856
## [241]  857  858  859  860  861  862  863  864  865  866  867  868  869  870  871
## [256]  872  873  874  875  876  877  878  879  880  881  882  883  884  885  886
## [271]  887  888  889  890  891  892  893  894  895  896  897  898  899  900  901
## [286]  902  903  904  905  906  907  908  909  910  911  912  913  914  915  916
## [301]  917  918  919  920  921  922  923  924  925  926  927  928  929  930  931
## [316]  932  933  934  935  936  937  938  939  940  941  942  943  944  945  946
## [331]  947  948  949  950  951  952  953  954  955  956  957  958  959  960  961
## [346]  962  963  964  965  966  967  968  969  970  971  972  973  974  975  976
## [361]  977  978  979  980  981  982  983  984  985  986  987  988  989  990  991
## [376]  992  993  994  995  996  997  998  999 1000 1001 1002 1003 1004 1005 1006
## [391] 1007 1008 1009 1010 1011 1012 1013 1014 1015 1016 1017 1018 1019 1020 1021
## [406] 1022 1023 1024 1025 1026 1027 1028 1029 1030 1031 1032 1033 1034 1035 1036
## [421] 1037 1038 1039 1040 1041 1042 1043 1044 1045
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_b\_factors[non\_matching\_indices] }\OtherTok{\textless{}{-}} \DecValTok{999}

\CommentTok{\# Assign the new B{-}factors back to the pdb structure}
\CommentTok{\# Write the modified PDB structure to a new file}
\NormalTok{pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{b }\OtherTok{\textless{}{-}}\NormalTok{ new\_b\_factors}
\FunctionTok{write.pdb}\NormalTok{(pdb, }\AttributeTok{file =} \StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/residual\_pdb/domains/1be9\_median\_residual\_loess.pdb"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggExtra)}
\FunctionTok{head}\NormalTok{(pdz3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   id_eve f_ddg_pred f_ddg_pred_sd   ESM1v  b_ddg_pred b_ddg_pred_sd orthosteric
## 1  A386C  0.6659222     0.1989811 -10.991  0.11921857    0.06126311       FALSE
## 2  A386D  0.1566707     0.1977913 -11.585 -0.02530033    0.82292100       FALSE
## 3  A386E -0.2662460     0.4344191 -10.914  0.04624840    0.06722154       FALSE
## 4  A386F  1.0041094     0.2397002 -13.794  0.27775264    0.16555277       FALSE
## 5  A386G  0.5761733     0.2151606  -7.404  0.06452813    0.07905913       FALSE
## 6  A386I  0.4137276     0.1953078 -11.800  0.07812631    0.49614970       FALSE
##           class allosteric
## 1     no change      FALSE
## 2     no change      FALSE
## 3     no change      FALSE
## 4 destabilizing      FALSE
## 5     no change      FALSE
## 6     no change      FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_out }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Fit a loess model using the filtered data}
\NormalTok{loess\_fit }\OtherTok{\textless{}{-}} \FunctionTok{loess}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f\_ddg\_pred, }\AttributeTok{data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_out, }\AttributeTok{span =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{family =} \StringTok{"symmetric"}\NormalTok{)}

\CommentTok{\# Predict fitted values for ALL data points using the loess model }
\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{fitted }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(loess\_fit, }\AttributeTok{newdata =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot)}

\CommentTok{\# Calculate residuals for ALL points}
\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{ESM1v }\SpecialCharTok{{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{fitted}

\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{fitted))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\CommentTok{\#{-}11.29141  14.24574}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -11.29141  14.24574
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{ESM1v) }\CommentTok{\#{-}20.381   6.127}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -20.381   6.127
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred) }\CommentTok{\#{-}1.754627  3.682299}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -1.754627  3.682299
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit\_line\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{f\_ddg\_pred =} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(}\DecValTok{0}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                            \FunctionTok{max}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_out}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                            \AttributeTok{length.out =} \DecValTok{200}\NormalTok{)}
\NormalTok{)}

\NormalTok{fit\_line\_df}\SpecialCharTok{$}\NormalTok{ESM1v }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(loess\_fit, }\AttributeTok{newdata =}\NormalTok{ fit\_line\_df)}

\FunctionTok{cor.test}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}0.4588265 }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in cor.test.default(pdz3_final_df_ddg_2plot$f_ddg_pred,
## pdz3_final_df_ddg_2plot$ESM1v, : Cannot compute exact p-value with ties
\end{verbatim}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  pdz3_final_df_ddg_2plot$f_ddg_pred and pdz3_final_df_ddg_2plot$ESM1v
## S = 935533202, p-value < 2.2e-16
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.4588265
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1567
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pdz3\_final\_df\_ddg\_2plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3: All 1,567 Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.46"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v pathogenicity"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{20.4}\NormalTok{, }\FloatTok{6.2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{1.8}\NormalTok{, }\FloatTok{3.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                        \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{11.3}\NormalTok{, }\DecValTok{15}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{p1}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-9-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_int }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_int)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 242
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_int}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, pdz3\_final\_df\_ddg\_2plot\_int}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}0.31}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in cor.test.default(pdz3_final_df_ddg_2plot_int$f_ddg_pred,
## pdz3_final_df_ddg_2plot_int$ESM1v, : Cannot compute exact p-value with ties
\end{verbatim}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  pdz3_final_df_ddg_2plot_int$f_ddg_pred and pdz3_final_df_ddg_2plot_int$ESM1v
## S = 3089860, p-value = 1.018e-06
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.3081314
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_int, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_line(data = fit\_line\_df, aes(x = f\_ddg\_pred, y = ESM1v),}
  \CommentTok{\#          inherit.aes = FALSE, color = "black", linewidth = 0.8) +}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"242 Orthosteric Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.31"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{""}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{20.4}\NormalTok{, }\FloatTok{6.2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{1.8}\NormalTok{, }\FloatTok{3.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                         \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{11.3}\NormalTok{, }\DecValTok{15}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{p2}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-9-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_allo }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(allosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_allo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 365
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_allo}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, pdz3\_final\_df\_ddg\_2plot\_allo}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}0.26}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in cor.test.default(pdz3_final_df_ddg_2plot_allo$f_ddg_pred,
## pdz3_final_df_ddg_2plot_allo$ESM1v, : Cannot compute exact p-value with ties
\end{verbatim}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  pdz3_final_df_ddg_2plot_allo$f_ddg_pred and pdz3_final_df_ddg_2plot_allo$ESM1v
## S = 10187427, p-value = 6.449e-07
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.2570149
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_allo, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_line(data = fit\_line\_df, aes(x = f\_ddg\_pred, y = ESM1v),}
  \CommentTok{\#          inherit.aes = FALSE, color = "black", linewidth = 0.8) +}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"365 Allosteric Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.26"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{""}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{20.4}\NormalTok{, }\FloatTok{6.2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{1.8}\NormalTok{, }\FloatTok{3.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{11.3}\NormalTok{, }\DecValTok{15}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{p3}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-9-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_other }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(allosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_other)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 960
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_other}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, pdz3\_final\_df\_ddg\_2plot\_other}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}0.36}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in cor.test.default(pdz3_final_df_ddg_2plot_other$f_ddg_pred,
## pdz3_final_df_ddg_2plot_other$ESM1v, : Cannot compute exact p-value with ties
\end{verbatim}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  pdz3_final_df_ddg_2plot_other$f_ddg_pred and pdz3_final_df_ddg_2plot_other$ESM1v
## S = 200844875, p-value < 2.2e-16
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##       rho 
## -0.362068
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_other, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_line(data = fit\_line\_df, aes(x = f\_ddg\_pred, y = ESM1v),}
  \CommentTok{\#          inherit.aes = FALSE, color = "black", linewidth = 0.8) +}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"960 Other Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.36"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{""}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{20.4}\NormalTok{, }\FloatTok{6.2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{1.8}\NormalTok{, }\FloatTok{3.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                         \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{11.3}\NormalTok{, }\DecValTok{15}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{p4}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-9-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fig3C }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1,p2,p3, p4, }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_pdz\_scatter.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ fig3C, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{3}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\NormalTok{fig3C}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-9-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pos\_eve =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(id\_eve, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}


\NormalTok{pdz3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{site\_class =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"orthosteric"}\NormalTok{,}
\NormalTok{    allosteric }\SpecialCharTok{==} \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"allosteric"}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"other"}
\NormalTok{  ))}

\NormalTok{label\_df }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(site\_class) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{median\_val =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  )}

\NormalTok{pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{site\_class }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{site\_class, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"orthosteric"}\NormalTok{, }\StringTok{"allosteric"}\NormalTok{, }\StringTok{"other"}\NormalTok{))}

\NormalTok{fig3C }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pdz3\_final\_df\_ddg\_2plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =}\NormalTok{ residuals, }\AttributeTok{fill =}\NormalTok{ site\_class)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{trim =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{scale =} \StringTok{"width"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{color =} \ConstantTok{NA}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun =}\NormalTok{ median, }\AttributeTok{geom =} \StringTok{"crossbar"}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.4}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fatten =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun =}\NormalTok{ median, }\AttributeTok{geom =} \StringTok{"point"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{23}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{fill =} \StringTok{"black"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_text}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ label\_df,}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(pdz3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals) }\SpecialCharTok{*} \FloatTok{1.1}\NormalTok{,}
        \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"n = "}\NormalTok{, n)),}
    \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{size =} \DecValTok{4}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ label\_df,}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =} \DecValTok{10}\NormalTok{,}
        \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"n = "}\NormalTok{, n)),}
    \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{size =} \DecValTok{4}
\NormalTok{  ) }\SpecialCharTok{+}
    \FunctionTok{geom\_text}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ label\_df,}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =}\NormalTok{ median\_val }\SpecialCharTok{+} \FloatTok{1.9}\NormalTok{, }\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.2f"}\NormalTok{, median\_val)),}
  \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{size =} \DecValTok{6}
\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_signif}\NormalTok{(}
    \AttributeTok{comparisons =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\StringTok{"orthosteric"}\NormalTok{, }\StringTok{"allosteric"}\NormalTok{),}
      \FunctionTok{c}\NormalTok{(}\StringTok{"orthosteric"}\NormalTok{, }\StringTok{"other"}\NormalTok{),}
      \FunctionTok{c}\NormalTok{(}\StringTok{"allosteric"}\NormalTok{, }\StringTok{"other"}\NormalTok{)}
\NormalTok{    ),}
    \AttributeTok{map\_signif\_level =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{test =} \StringTok{"wilcox.test"}\NormalTok{,}
    \AttributeTok{step\_increase =} \FloatTok{0.1}\NormalTok{,}
    \AttributeTok{tip\_length =} \FloatTok{0.01}
\NormalTok{  ) }\SpecialCharTok{+}
  
  \CommentTok{\# Labels and theme}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{""}\NormalTok{,}
    \AttributeTok{x =} \StringTok{""}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v {-} ddGf residual"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"orthosteric"} \OtherTok{=} \StringTok{"orange"}\NormalTok{,}
    \StringTok{"allosteric"} \OtherTok{=} \StringTok{"cyan3"}\NormalTok{,}
    \StringTok{"other"} \OtherTok{=} \StringTok{"darkgreen"}
\NormalTok{  )) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_pdz\_violin.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ fig3C, }\AttributeTok{width =} \DecValTok{3}\NormalTok{, }\AttributeTok{height =} \DecValTok{3}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_ydensity()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
## Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_signif()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 3 rows containing missing values or values outside the scale range
## (`geom_text()`).
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fig3C}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_ydensity()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
## Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_signif()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 3 rows containing missing values or values outside the scale range
## (`geom_text()`).
\end{verbatim}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-10-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{legend }\OtherTok{\textless{}{-}}  \FunctionTok{ggplot}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_other, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"1,243 Other Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.40"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{20.4}\NormalTok{, }\FloatTok{6.2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{1.8}\NormalTok{, }\FloatTok{3.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                        \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{11.3}\NormalTok{, }\DecValTok{15}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"top"}\NormalTok{)}
\NormalTok{legend}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-11-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_pdz\_legend.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ legend, }\AttributeTok{width =} \DecValTok{5}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bootstrap\_r\_squared }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input\_data, fit, }\AttributeTok{n\_bootstrap =} \DecValTok{1000}\NormalTok{) \{}
\NormalTok{  marginal\_r\_squared\_values }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(n\_bootstrap)}
\NormalTok{  conditional\_r\_squared\_values }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(n\_bootstrap)}
  
  \ControlFlowTok{for}\NormalTok{ (k }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{n\_bootstrap) \{}
\NormalTok{    indices }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(input\_data), }\AttributeTok{size =} \FunctionTok{nrow}\NormalTok{(input\_data), }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    bootstrap\_data }\OtherTok{\textless{}{-}}\NormalTok{ input\_data[indices, ]}
    
\NormalTok{    bootstrap\_fit }\OtherTok{\textless{}{-}} \FunctionTok{tryCatch}\NormalTok{(\{}
      \FunctionTok{update}\NormalTok{(fit, }\AttributeTok{data =}\NormalTok{ bootstrap\_data)}
\NormalTok{    \}, }\AttributeTok{error =} \ControlFlowTok{function}\NormalTok{(e) \{}
      \ConstantTok{NULL}
\NormalTok{    \})}
    
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(bootstrap\_fit)) \{}
\NormalTok{      r2\_values }\OtherTok{\textless{}{-}} \FunctionTok{r2}\NormalTok{(bootstrap\_fit)}
\NormalTok{      marginal\_r\_squared\_values[k] }\OtherTok{\textless{}{-}}\NormalTok{ r2\_values}\SpecialCharTok{$}\NormalTok{R2\_marginal}
\NormalTok{      conditional\_r\_squared\_values[k] }\OtherTok{\textless{}{-}}\NormalTok{ r2\_values}\SpecialCharTok{$}\NormalTok{R2\_conditional}
\NormalTok{    \}}
\NormalTok{  \}}
  
\NormalTok{  marginal\_r\_squared\_sorted }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(marginal\_r\_squared\_values, }\AttributeTok{na.last =} \ConstantTok{NA}\NormalTok{)}
\NormalTok{  conditional\_r\_squared\_sorted }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(conditional\_r\_squared\_values, }\AttributeTok{na.last =} \ConstantTok{NA}\NormalTok{)}
  
  \FunctionTok{list}\NormalTok{(}
    \AttributeTok{marginal\_r\_squared\_ci =} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{lower =}\NormalTok{ marginal\_r\_squared\_sorted[}\FunctionTok{round}\NormalTok{(n\_bootstrap }\SpecialCharTok{*} \FloatTok{0.025}\NormalTok{)],}
      \AttributeTok{upper =}\NormalTok{ marginal\_r\_squared\_sorted[}\FunctionTok{round}\NormalTok{(n\_bootstrap }\SpecialCharTok{*} \FloatTok{0.975}\NormalTok{)]}
\NormalTok{    ),}
    \AttributeTok{conditional\_r\_squared\_ci =} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{lower =}\NormalTok{ conditional\_r\_squared\_sorted[}\FunctionTok{round}\NormalTok{(n\_bootstrap }\SpecialCharTok{*} \FloatTok{0.025}\NormalTok{)],}
      \AttributeTok{upper =}\NormalTok{ conditional\_r\_squared\_sorted[}\FunctionTok{round}\NormalTok{(n\_bootstrap }\SpecialCharTok{*} \FloatTok{0.975}\NormalTok{)]}
\NormalTok{    ),}
    \AttributeTok{marginal\_r\_squared\_values =}\NormalTok{ marginal\_r\_squared\_values,}
    \AttributeTok{conditional\_r\_squared\_values =}\NormalTok{ conditional\_r\_squared\_values}
\NormalTok{  )}
\NormalTok{\}}

\NormalTok{fit\_model\_and\_diagnostics\_both\_lmm }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input\_data, model\_id) \{}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f\_ddg\_pred }\SpecialCharTok{+}\NormalTok{ b\_ddg\_pred }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ pos\_eve), }\AttributeTok{data =}\NormalTok{ input\_data)}
  \CommentTok{\#control = lmerControl(check.conv.singular = "ignore"))}
  
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit, }\AttributeTok{newdata =}\NormalTok{ input\_data, }\AttributeTok{re.form =} \ConstantTok{NULL}\NormalTok{)}
  
\NormalTok{  marginal\_r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{r2}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{R2\_marginal}
\NormalTok{  conditional\_r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{r2}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{R2\_conditional}
  
\NormalTok{  bootstrap\_r2 }\OtherTok{\textless{}{-}} \FunctionTok{bootstrap\_r\_squared}\NormalTok{(input\_data, fit, }\AttributeTok{n\_bootstrap =} \DecValTok{1000}\NormalTok{)}
  
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Marginal R{-}squared:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(marginal\_r\_squared, }\DecValTok{4}\NormalTok{)))}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Conditional R{-}squared:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(conditional\_r\_squared, }\DecValTok{4}\NormalTok{)))}
  
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}
    \AttributeTok{fit =}\NormalTok{ fit,}
    \AttributeTok{marginal\_r\_squared =}\NormalTok{ bootstrap\_r2}\SpecialCharTok{$}\NormalTok{marginal\_r\_squared\_values,}
    \AttributeTok{conditional\_r\_squared =}\NormalTok{ bootstrap\_r2}\SpecialCharTok{$}\NormalTok{conditional\_r\_squared\_values,}
    \AttributeTok{marginal\_r\_squared\_ci =} \FunctionTok{c}\NormalTok{(bootstrap\_r2}\SpecialCharTok{$}\NormalTok{marginal\_r\_squared\_ci[}\StringTok{"lower"}\NormalTok{], }
\NormalTok{                              bootstrap\_r2}\SpecialCharTok{$}\NormalTok{marginal\_r\_squared\_ci[}\StringTok{"upper"}\NormalTok{]),}
    \AttributeTok{conditional\_squared\_ci =} \FunctionTok{c}\NormalTok{(bootstrap\_r2}\SpecialCharTok{$}\NormalTok{conditional\_r\_squared\_ci[}\StringTok{"lower"}\NormalTok{], }
\NormalTok{                               bootstrap\_r2}\SpecialCharTok{$}\NormalTok{conditional\_r\_squared\_ci[}\StringTok{"upper"}\NormalTok{]),}
    \AttributeTok{input\_data =}\NormalTok{ input\_data}
\NormalTok{  ))}
\NormalTok{\}}


\NormalTok{fit\_model\_and\_diagnostics\_ddgf\_lmm }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input\_data, model\_id) \{}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{  f\_ddg\_pred  }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ pos\_eve), }\AttributeTok{data =}\NormalTok{ input\_data)}
  
\NormalTok{  input\_data[[}\FunctionTok{paste0}\NormalTok{(}\StringTok{"predicted\_"}\NormalTok{, model\_id)]] }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit, }\AttributeTok{newdata =}\NormalTok{ input\_data, }\AttributeTok{re.form =} \ConstantTok{NULL}\NormalTok{)}
  
\NormalTok{  marginal\_r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{r2}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{R2\_marginal}
\NormalTok{  conditional\_r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{r2}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{R2\_conditional}
  
\NormalTok{  bootstrap\_r2 }\OtherTok{\textless{}{-}} \FunctionTok{bootstrap\_r\_squared}\NormalTok{(input\_data, fit, }\AttributeTok{n\_bootstrap =} \DecValTok{1000}\NormalTok{)}
  
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Marginal R{-}squared:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(marginal\_r\_squared, }\DecValTok{4}\NormalTok{)))}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Conditional R{-}squared:"}\NormalTok{, }\FunctionTok{round}\NormalTok{(conditional\_r\_squared, }\DecValTok{4}\NormalTok{)))}
  
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}
    \AttributeTok{fit =}\NormalTok{ fit,}
    \AttributeTok{marginal\_r\_squared =}\NormalTok{ bootstrap\_r2}\SpecialCharTok{$}\NormalTok{marginal\_r\_squared\_values,}
    \AttributeTok{conditional\_r\_squared =}\NormalTok{ bootstrap\_r2}\SpecialCharTok{$}\NormalTok{conditional\_r\_squared\_values,}
    \AttributeTok{marginal\_r\_squared\_ci =} \FunctionTok{c}\NormalTok{(bootstrap\_r2}\SpecialCharTok{$}\NormalTok{marginal\_r\_squared\_ci[}\StringTok{"lower"}\NormalTok{], }
\NormalTok{                              bootstrap\_r2}\SpecialCharTok{$}\NormalTok{marginal\_r\_squared\_ci[}\StringTok{"upper"}\NormalTok{]),}
    \AttributeTok{conditional\_squared\_ci =} \FunctionTok{c}\NormalTok{(bootstrap\_r2}\SpecialCharTok{$}\NormalTok{conditional\_r\_squared\_ci[}\StringTok{"lower"}\NormalTok{], }
\NormalTok{                               bootstrap\_r2}\SpecialCharTok{$}\NormalTok{conditional\_r\_squared\_ci[}\StringTok{"upper"}\NormalTok{]),}
    \AttributeTok{input\_data =}\NormalTok{ input\_data}
\NormalTok{  ))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(modeest)}
\FunctionTok{library}\NormalTok{(Metrics)}
\FunctionTok{library}\NormalTok{(broom)}
\FunctionTok{library}\NormalTok{(lme4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: Matrix
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'Matrix'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:tidyr':
## 
##     expand, pack, unpack
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(performance)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'performance'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:Metrics':
## 
##     mae, mse, rmse
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m0\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m0"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.3104"
## [1] "Conditional R-squared: 0.676"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1] "Marginal R{-}squared: 0.3104"}
\CommentTok{\# [1] "Conditional R{-}squared: 0.676"}
\NormalTok{m1\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.2031"
## [1] "Conditional R-squared: 0.6399"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1] "Marginal R{-}squared: 0.2031"}
\CommentTok{\# [1] "Conditional R{-}squared: 0.6399"}
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_non\_active }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_non\_active }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pos\_eve =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(id\_eve, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}

\NormalTok{m3\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.3545"
## [1] "Conditional R-squared: 0.6627"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1] "Marginal R{-}squared: 0.3545"}
\CommentTok{\# [1] "Conditional R{-}squared: 0.6627"}
\NormalTok{m4\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m4"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.2441"
## [1] "Conditional R-squared: 0.6211"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1] "Marginal R{-}squared: 0.2441"}
\CommentTok{\# [1] "Conditional R{-}squared: 0.6211"}
\NormalTok{pdz3\_final\_df\_ddg\_2plot\_active }\OtherTok{\textless{}{-}}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_active }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pos\_eve =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(id\_eve, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}

\NormalTok{m6\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m6"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.266"
## [1] "Conditional R-squared: 0.3795"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1] "Marginal R{-}squared: 0.266"}
\CommentTok{\# [1] "Conditional R{-}squared: 0.3795"}
\NormalTok{m7\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ pdz3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m7"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.1598"
## [1] "Conditional R-squared: 0.2618"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#[1] "Marginal R{-}squared: 0.1598"}
\CommentTok{\#[1] "Conditional R{-}squared: 0.2618"}
\FunctionTok{anova}\NormalTok{(m1\_results}\SpecialCharTok{$}\NormalTok{fit, m0\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## refitting model(s) with ML (instead of REML)
\end{verbatim}

\begin{verbatim}
## Data: input_data
## Models:
## m1_results$fit: ESM1v ~ f_ddg_pred + (1 | pos_eve)
## m0_results$fit: ESM1v ~ f_ddg_pred + b_ddg_pred + (1 | pos_eve)
##                npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(>Chisq)    
## m1_results$fit    4 7575.2 7596.6 -3783.6    7567.2                         
## m0_results$fit    5 7409.7 7436.5 -3699.9    7399.7 167.48  1  < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# m1\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\# m0\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\#                npar    AIC    BIC  logLik {-}2*log(L)  Chisq Df Pr(\textgreater{}Chisq)    }
\CommentTok{\# m1\_results$fit    4 7575.2 7596.6 {-}3783.6    7567.2                         }
\CommentTok{\# m0\_results$fit    5 7409.7 7436.5 {-}3699.9    7399.7 167.48  1  \textless{} 2.2e{-}16 ***}

\FunctionTok{anova}\NormalTok{(m4\_results}\SpecialCharTok{$}\NormalTok{fit, m3\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## refitting model(s) with ML (instead of REML)
\end{verbatim}

\begin{verbatim}
## Data: input_data
## Models:
## m4_results$fit: ESM1v ~ f_ddg_pred + (1 | pos_eve)
## m3_results$fit: ESM1v ~ f_ddg_pred + b_ddg_pred + (1 | pos_eve)
##                npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(>Chisq)    
## m4_results$fit    4 6354.3 6375.1 -3173.2    6346.3                         
## m3_results$fit    5 6215.8 6241.7 -3102.9    6205.8 140.57  1  < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# m4\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\# m3\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\#                npar    AIC    BIC  logLik {-}2*log(L)  Chisq Df Pr(\textgreater{}Chisq)    }
\CommentTok{\# m4\_results$fit    4 6354.3 6375.1 {-}3173.2    6346.3                         }
\CommentTok{\# m3\_results$fit    5 6215.8 6241.7 {-}3102.9    6205.8 140.57  1  \textless{} 2.2e{-}16 ***}

\FunctionTok{anova}\NormalTok{(m7\_results}\SpecialCharTok{$}\NormalTok{fit, m6\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## refitting model(s) with ML (instead of REML)
\end{verbatim}

\begin{verbatim}
## Data: input_data
## Models:
## m7_results$fit: ESM1v ~ f_ddg_pred + (1 | pos_eve)
## m6_results$fit: ESM1v ~ f_ddg_pred + b_ddg_pred + (1 | pos_eve)
##                npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(>Chisq)    
## m7_results$fit    4 1175.3 1189.2 -583.64    1167.3                         
## m6_results$fit    5 1155.6 1173.0 -572.78    1145.6 21.705  1  3.179e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# m7\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\# m6\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\#                npar    AIC    BIC  logLik {-}2*log(L)  Chisq Df Pr(\textgreater{}Chisq)    }
\CommentTok{\# m7\_results$fit    4 1175.3 1189.2 {-}583.64    1167.3                         }
\CommentTok{\# m6\_results$fit    5 1155.6 1173.0 {-}572.78    1145.6 21.705  1  3.179e{-}06 ***}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_all, pdz3\_out, }\AttributeTok{by.x=}\StringTok{"Pos\_ref.x"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"Pos"}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(merged\_df) }\CommentTok{\#1587}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1587
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_pos }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(b\_ddg\_pred }\SpecialCharTok{\textgreater{}=} \DecValTok{0}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(merged\_df\_pos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1335
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df\_pos }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Pos\_ref.x) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{reframe}\NormalTok{(}
    \AttributeTok{median\_ddgb =} \FunctionTok{median}\NormalTok{(b\_ddg\_pred, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{median\_residual =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{scHAmin\_ligand =} \FunctionTok{first}\NormalTok{(scHAmin\_ligand),}
    \AttributeTok{orthosteric =} \FunctionTok{first}\NormalTok{(orthosteric),}
    \AttributeTok{Pos =} \FunctionTok{first}\NormalTok{(Pos\_ref.x))}

\FunctionTok{nrow}\NormalTok{(merged\_df\_residue) }\CommentTok{\#84}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 84
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fit exponential decay: y = a * exp({-}b * x) + c}
\NormalTok{exp\_model\_pdz3\_ddgb }\OtherTok{\textless{}{-}} \FunctionTok{nls}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_ddgb) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ a }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{*}\NormalTok{ scHAmin\_ligand),}
                 \AttributeTok{data =}\NormalTok{ merged\_df\_residue,}
                 \AttributeTok{start =} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \FloatTok{0.1}\NormalTok{))}
\NormalTok{exp\_model\_pdz3\_ddgb}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Nonlinear regression model
##   model: abs(median_ddgb) ~ a * exp(-b * scHAmin_ligand)
##    data: merged_df_residue
##       a       b 
## 1.40410 0.07758 
##  residual sum-of-squares: 12.64
## 
## Number of iterations to convergence: 5 
## Achieved convergence tolerance: 7.005e-06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nonlinear regression model}
\CommentTok{\#   model: abs(median\_ddgb) \textasciitilde{} a * exp({-}b * scHAmin\_ligand)}
\CommentTok{\#    data: merged\_df\_residue}
\CommentTok{\#       a       b }
\CommentTok{\# 1.40410 0.07758 }
\CommentTok{\#  residual sum{-}of{-}squares: 12.64}
\CommentTok{\# }
\CommentTok{\# Number of iterations to convergence: 5 }
\CommentTok{\# Achieved convergence tolerance: 7.005e{-}06}

\NormalTok{a }\OtherTok{\textless{}{-}} \FloatTok{1.40410}
\NormalTok{b }\OtherTok{\textless{}{-}}  \FloatTok{0.07758} 
\NormalTok{half\_d }\OtherTok{\textless{}{-}} \FunctionTok{log}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ b  }\CommentTok{\#  8.934612}
\NormalTok{half\_d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8.934612
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y\_cutoff }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(merged\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(b\_ddg\_pred), }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{)}

\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type }\OtherTok{\textless{}{-}} \StringTok{"Non{-}orthosteric site"}
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type[}\FunctionTok{abs}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{median\_ddgb) }\SpecialCharTok{\textless{}=}\NormalTok{ y\_cutoff] }\OtherTok{\textless{}{-}} \StringTok{"Null"}
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type[merged\_df\_residue}\SpecialCharTok{$}\NormalTok{orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Binding site"}


\NormalTok{x\_vals }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
              \FunctionTok{max}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), }\AttributeTok{length.out =} \DecValTok{200}\NormalTok{)}

\CommentTok{\# {-}{-}{-} Bootstrapping for confidence intervals {-}{-}{-}}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{11}\NormalTok{)}
\NormalTok{boot\_params }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\DecValTok{1000}\NormalTok{, \{}
\NormalTok{  samp }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df\_residue[}\FunctionTok{sample}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(merged\_df\_residue), }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{), ]}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(}\FunctionTok{nlsLM}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_ddgb) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ a }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{*}\NormalTok{ scHAmin\_ligand),}
                   \AttributeTok{data =}\NormalTok{ samp, }\AttributeTok{start =} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \FloatTok{0.1}\NormalTok{)), }\AttributeTok{silent =} \ConstantTok{TRUE}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{inherits}\NormalTok{(fit, }\StringTok{"try{-}error"}\NormalTok{)) }\FunctionTok{c}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{) }\ControlFlowTok{else} \FunctionTok{coef}\NormalTok{(fit)}
\NormalTok{\})}
\NormalTok{boot\_params }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(boot\_params)[}\FunctionTok{complete.cases}\NormalTok{(}\FunctionTok{t}\NormalTok{(boot\_params)), ]}

\NormalTok{boot\_preds }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(boot\_params, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(p) p[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{p[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{*}\NormalTok{ x\_vals))}

\NormalTok{fit\_df\_residue }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals,}
  \AttributeTok{median\_ddgb =} \FunctionTok{predict}\NormalTok{(exp\_model\_pdz3\_ddgb, }\AttributeTok{newdata =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals)),}
  \AttributeTok{lower =} \FunctionTok{apply}\NormalTok{(boot\_preds, }\DecValTok{1}\NormalTok{, quantile, }\AttributeTok{probs =} \FloatTok{0.025}\NormalTok{),}
  \AttributeTok{upper =} \FunctionTok{apply}\NormalTok{(boot\_preds, }\DecValTok{1}\NormalTok{, quantile, }\AttributeTok{probs =} \FloatTok{0.975}\NormalTok{)}
\NormalTok{)}

\CommentTok{\# Plot}
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(merged\_df\_residue, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =} \FunctionTok{abs}\NormalTok{(median\_ddgb))) }\SpecialCharTok{+}
  \CommentTok{\# Base layer: all points}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ site\_type, }\AttributeTok{alpha =} \FloatTok{0.4}\NormalTok{), }\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
   \CommentTok{\# Fit line with confidence ribbon}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_df\_residue,}
            \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{ymin =}\NormalTok{ lower, }\AttributeTok{ymax =}\NormalTok{ upper),}
            \AttributeTok{fill =} \StringTok{"grey70"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_df\_residue, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =} \FunctionTok{abs}\NormalTok{(median\_ddgb)),}
          \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{data =}\NormalTok{ merged\_df\_residue }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(site\_type }\SpecialCharTok{!=} \StringTok{"Null"}\NormalTok{), }\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{Pos))}\SpecialCharTok{+}
  
  \CommentTok{\# Manual color palette for site type}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"Null"} \OtherTok{=} \StringTok{"darkgreen"}\NormalTok{,}
    \StringTok{"Non{-}orthosteric site"} \OtherTok{=} \StringTok{"darkgreen"}\NormalTok{,}
    \StringTok{"Binding site"} \OtherTok{=} \StringTok{"orange"}
\NormalTok{  )) }\SpecialCharTok{+}
  \CommentTok{\# Reference lines}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"slategrey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =}\NormalTok{ y\_cutoff, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"slategrey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3: allosteric decay"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"1335 mutations with ddGb \textgreater{}=0"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Minimal distance to ligand"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Median ddGb"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{""}
\NormalTok{  )  }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,  }\AttributeTok{x =} \ConstantTok{Inf}\NormalTok{, }\AttributeTok{y =} \ConstantTok{Inf}\NormalTok{,}
             \AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{,}
           \AttributeTok{label =} \StringTok{"y = a * exp (b * x)}\SpecialCharTok{\textbackslash{}n}\StringTok{a = 1.40410  }\SpecialCharTok{\textbackslash{}n}\StringTok{b = {-}0.07758"}\NormalTok{,}
           \AttributeTok{size =} \DecValTok{4}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## i Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
\end{verbatim}

\begin{verbatim}
## Warning: Duplicated aesthetics after name standardisation: hjust
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggMarginal}\NormalTok{(}
\NormalTok{  p1,}
  \AttributeTok{type =} \StringTok{"density"}\NormalTok{,}
  \AttributeTok{margins =} \StringTok{"both"}\NormalTok{,}
  \AttributeTok{groupColour =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{groupFill =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{size =} \DecValTok{10}\NormalTok{,}
  \AttributeTok{colour =} \StringTok{"grey"}\NormalTok{,}
  \AttributeTok{fill =} \StringTok{"lightgrey"}
\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_pdz\_ddgb\_exp.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ p1, }\AttributeTok{width =} \DecValTok{4}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 4 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-14-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm\_model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{log}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_ddgb)) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ scHAmin\_ligand, }\AttributeTok{data =}\NormalTok{ merged\_df\_residue)}
\FunctionTok{summary}\NormalTok{(lm\_model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = log(abs(median_ddgb)) ~ scHAmin_ligand, data = merged_df_residue)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.89470 -0.50236  0.09722  0.49863  1.26543 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(>|t|)    
## (Intercept)     0.35171    0.19914   1.766   0.0811 .  
## scHAmin_ligand -0.10112    0.01821  -5.554 3.37e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.6744 on 82 degrees of freedom
## Multiple R-squared:  0.2733, Adjusted R-squared:  0.2645 
## F-statistic: 30.84 on 1 and 82 DF,  p-value: 3.37e-07
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Call:}
\CommentTok{\# lm(formula = log(abs(median\_ddgb)) \textasciitilde{} scHAmin\_ligand, data = merged\_df\_residue)}
\CommentTok{\# }
\CommentTok{\# Residuals:}
\CommentTok{\#      Min       1Q   Median       3Q      Max }
\CommentTok{\# {-}1.89470 {-}0.50236  0.09722  0.49863  1.26543 }
\CommentTok{\# }
\CommentTok{\# Coefficients:}
\CommentTok{\#                Estimate Std. Error t value Pr(\textgreater{}|t|)    }
\CommentTok{\# (Intercept)     0.35171    0.19914   1.766   0.0811 .  }
\CommentTok{\# scHAmin\_ligand {-}0.10112    0.01821  {-}5.554 3.37e{-}07 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1}
\CommentTok{\# }
\CommentTok{\# Residual standard error: 0.6744 on 82 degrees of freedom}
\CommentTok{\# Multiple R{-}squared:  0.2733,  Adjusted R{-}squared:  0.2645 }
\CommentTok{\# F{-}statistic: 30.84 on 1 and 82 DF,  p{-}value: 3.37e{-}07}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(pdz3\_final\_df\_ddg\_2plot\_all, pdz3\_out, }\AttributeTok{by.x=}\StringTok{"Pos\_ref.x"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"Pos"}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(merged\_df) }\CommentTok{\#1587}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1587
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_neg }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(residuals }\SpecialCharTok{\textless{}=} \DecValTok{0}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(merged\_df\_neg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 898
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df\_neg }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Pos\_ref.x) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{reframe}\NormalTok{(}
    \AttributeTok{median\_ddgb =} \FunctionTok{median}\NormalTok{(b\_ddg\_pred, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{median\_residual =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{scHAmin\_ligand =} \FunctionTok{first}\NormalTok{(scHAmin\_ligand),}
    \AttributeTok{orthosteric =} \FunctionTok{first}\NormalTok{(orthosteric),}
    \AttributeTok{Pos =} \FunctionTok{first}\NormalTok{(Pos\_ref.x))}

\FunctionTok{nrow}\NormalTok{(merged\_df\_residue) }\CommentTok{\#82}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 82
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fit exponential decay: y = a * exp({-}b * x) + c}
\NormalTok{exp\_model\_pdz3\_res }\OtherTok{\textless{}{-}} \FunctionTok{nls}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_residual) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ a }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{*}\NormalTok{ scHAmin\_ligand),}
                 \AttributeTok{data =}\NormalTok{ merged\_df\_residue,}
                 \AttributeTok{start =} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \FloatTok{0.1}\NormalTok{))}
\NormalTok{exp\_model\_pdz3\_res}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Nonlinear regression model
##   model: abs(median_residual) ~ a * exp(-b * scHAmin_ligand)
##    data: merged_df_residue
##      a      b 
## 7.3547 0.1291 
##  residual sum-of-squares: 121
## 
## Number of iterations to convergence: 6 
## Achieved convergence tolerance: 8.824e-07
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nonlinear regression model}
\CommentTok{\#   model: abs(median\_residual) \textasciitilde{} a * exp({-}b * scHAmin\_ligand)}
\CommentTok{\#    data: merged\_df\_residue}
\CommentTok{\#      a      b }
\CommentTok{\# 7.3547 0.1291 }
\CommentTok{\#  residual sum{-}of{-}squares: 121}
\CommentTok{\# }
\CommentTok{\# Number of iterations to convergence: 6 }
\CommentTok{\# Achieved convergence tolerance: 8.824e{-}07}

\NormalTok{a }\OtherTok{\textless{}{-}} \FloatTok{7.3547}
\NormalTok{b }\OtherTok{\textless{}{-}}  \FloatTok{0.1291}
\NormalTok{half\_d }\OtherTok{\textless{}{-}} \FunctionTok{log}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ b  }\CommentTok{\#  5.369072}
\NormalTok{half\_d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.369072
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y\_cutoff }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(merged\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(residuals), }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type }\OtherTok{\textless{}{-}} \StringTok{"Non{-}orthosteric site"}
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type[}\FunctionTok{abs}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{median\_residual) }\SpecialCharTok{\textless{}=} \FunctionTok{abs}\NormalTok{(y\_cutoff)] }\OtherTok{\textless{}{-}} \StringTok{"Null"}
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type[merged\_df\_residue}\SpecialCharTok{$}\NormalTok{orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Binding site"}
\FunctionTok{table}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         Binding site Non-orthosteric site                 Null 
##                   13                    8                   61
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_vals }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
              \FunctionTok{max}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), }\AttributeTok{length.out =} \DecValTok{200}\NormalTok{)}

\CommentTok{\# {-}{-}{-} Bootstrapping for confidence intervals {-}{-}{-}}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{11}\NormalTok{)}
\NormalTok{boot\_params }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\DecValTok{1000}\NormalTok{, \{}
\NormalTok{  samp }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df\_residue[}\FunctionTok{sample}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(merged\_df\_residue), }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{), ]}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(}\FunctionTok{nlsLM}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_residual) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ a }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{*}\NormalTok{ scHAmin\_ligand),}
                   \AttributeTok{data =}\NormalTok{ samp, }\AttributeTok{start =} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \FloatTok{0.1}\NormalTok{)), }\AttributeTok{silent =} \ConstantTok{TRUE}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{inherits}\NormalTok{(fit, }\StringTok{"try{-}error"}\NormalTok{)) }\FunctionTok{c}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{) }\ControlFlowTok{else} \FunctionTok{coef}\NormalTok{(fit)}
\NormalTok{\})}
\NormalTok{boot\_params }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(boot\_params)[}\FunctionTok{complete.cases}\NormalTok{(}\FunctionTok{t}\NormalTok{(boot\_params)), ]}

\NormalTok{boot\_preds }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(boot\_params, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(p) p[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{p[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{*}\NormalTok{ x\_vals))}

\NormalTok{fit\_df\_residue }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals,}
  \AttributeTok{median\_ddgb =} \FunctionTok{predict}\NormalTok{(exp\_model\_pdz3\_res, }\AttributeTok{newdata =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals)),}
  \AttributeTok{lower =} \FunctionTok{apply}\NormalTok{(boot\_preds, }\DecValTok{1}\NormalTok{, quantile, }\AttributeTok{probs =} \FloatTok{0.025}\NormalTok{),}
  \AttributeTok{upper =} \FunctionTok{apply}\NormalTok{(boot\_preds, }\DecValTok{1}\NormalTok{, quantile, }\AttributeTok{probs =} \FloatTok{0.975}\NormalTok{)}
\NormalTok{)}
\CommentTok{\# Plot}
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(merged\_df\_residue, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =} \FunctionTok{abs}\NormalTok{(median\_residual))) }\SpecialCharTok{+}
  \CommentTok{\# Base layer: all points}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ site\_type, }\AttributeTok{alpha =} \FloatTok{0.4}\NormalTok{), }\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_df\_residue,}
            \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{ymin =}\NormalTok{ lower, }\AttributeTok{ymax =}\NormalTok{ upper),}
            \AttributeTok{fill =} \StringTok{"grey70"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_df\_residue, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =} \FunctionTok{abs}\NormalTok{(median\_ddgb)),}
          \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{data =}\NormalTok{ merged\_df\_residue }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(site\_type }\SpecialCharTok{!=} \StringTok{"Null"}\NormalTok{), }\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{Pos))}\SpecialCharTok{+}
  
  \CommentTok{\# Manual color palette for site type}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"Null"} \OtherTok{=} \StringTok{"darkgreen"}\NormalTok{,}
    \StringTok{"Non{-}orthosteric site"} \OtherTok{=} \StringTok{"darkgreen"}\NormalTok{,}
    \StringTok{"Binding site"} \OtherTok{=} \StringTok{"orange"}
\NormalTok{  )) }\SpecialCharTok{+}
  \CommentTok{\# Reference lines}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"slategrey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FunctionTok{abs}\NormalTok{(y\_cutoff), }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"slategrey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3: allosteric decay"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"898 mutations with residuals \textless{}= 0"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Minimal distance to ligand"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"|Median ESM1v{-}ddGf residual|"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{""}
\NormalTok{  )  }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,  }\AttributeTok{x =} \ConstantTok{Inf}\NormalTok{, }\AttributeTok{y =} \ConstantTok{Inf}\NormalTok{,}
             \AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{,}
           \AttributeTok{label =} \StringTok{"y = a * exp (b * x)}\SpecialCharTok{\textbackslash{}n}\StringTok{a = 7.3547  }\SpecialCharTok{\textbackslash{}n}\StringTok{b = {-}0.1291"}\NormalTok{,}
           \AttributeTok{size =} \DecValTok{4}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Duplicated aesthetics after name standardisation: hjust
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggMarginal}\NormalTok{(}
\NormalTok{  p2,}
  \AttributeTok{type =} \StringTok{"density"}\NormalTok{,}
  \AttributeTok{margins =} \StringTok{"both"}\NormalTok{,}
  \AttributeTok{groupColour =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{groupFill =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{size =} \DecValTok{10}\NormalTok{,}
  \AttributeTok{colour =} \StringTok{"grey"}\NormalTok{,}
  \AttributeTok{fill =} \StringTok{"lightgrey"}
\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_pdz\_residual\_decay.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ p2, }\AttributeTok{width =} \DecValTok{4}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\NormalTok{p2}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-16-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm\_model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{log}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_residual)) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ scHAmin\_ligand, }\AttributeTok{data =}\NormalTok{ merged\_df\_residue)}
\FunctionTok{summary}\NormalTok{(lm\_model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = log(abs(median_residual)) ~ scHAmin_ligand, data = merged_df_residue)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.6808 -0.4011  0.2040  0.5331  1.4222 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(>|t|)    
## (Intercept)     1.87648    0.27421   6.843 1.42e-09 ***
## scHAmin_ligand -0.14203    0.02518  -5.642 2.46e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.9201 on 80 degrees of freedom
## Multiple R-squared:  0.2846, Adjusted R-squared:  0.2757 
## F-statistic: 31.83 on 1 and 80 DF,  p-value: 2.461e-07
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Call:}
\CommentTok{\# lm(formula = log(abs(median\_residual)) \textasciitilde{} scHAmin\_ligand, data = merged\_df\_residue)}
\CommentTok{\# }
\CommentTok{\# Residuals:}
\CommentTok{\#     Min      1Q  Median      3Q     Max }
\CommentTok{\# {-}3.6808 {-}0.4011  0.2040  0.5331  1.4222 }
\CommentTok{\# }
\CommentTok{\# Coefficients:}
\CommentTok{\#                Estimate Std. Error t value Pr(\textgreater{}|t|)    }
\CommentTok{\# (Intercept)     1.87648    0.27421   6.843 1.42e{-}09 ***}
\CommentTok{\# scHAmin\_ligand {-}0.14203    0.02518  {-}5.642 2.46e{-}07 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1}
\CommentTok{\# }
\CommentTok{\# Residual standard error: 0.9201 on 80 degrees of freedom}
\CommentTok{\# Multiple R{-}squared:  0.2846,  Adjusted R{-}squared:  0.2757 }
\CommentTok{\# F{-}statistic: 31.83 on 1 and 80 DF,  p{-}value: 2.461e{-}07}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(merged\_df) }\CommentTok{\#1587}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1587
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(merged\_df}\SpecialCharTok{$}\NormalTok{residuals, merged\_df}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred) }\CommentTok{\#{-}0.2958665}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's product-moment correlation
## 
## data:  merged_df$residuals and merged_df$b_ddg_pred
## t = -12.249, df = 1564, p-value < 2.2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  -0.3404126 -0.2499953
## sample estimates:
##        cor 
## -0.2958665
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(merged\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Pos_ref.x id_eve X.x V1.x id_old.x pos_am.x trait_name.x  f_ddg_pred
## 1       311  P354A   1    2      P1A        1      Folding -0.11463383
## 2       311  P354C   2    3      P1C        1      Folding  0.05651265
## 3       311  P354D   3    4      P1D        1      Folding  0.26523510
## 4       311  P354E   4    5      P1E        1      Folding -0.48300818
## 5       311  P354F   5    6      P1F        1      Folding  0.26560825
## 6       311  P354G   6    7      P1G        1      Folding  0.25143468
##   f_ddg_pred_sd ci95_kcal.mol.x     library.x assay.x pdz.x pdz_name.x
## 1    0.17292605       0.6778701 761_abundance folding   761  DLG4_PDZ3
## 2    0.07504865       0.2941907 761_abundance folding   761  DLG4_PDZ3
## 3    0.17022757       0.6672921 761_abundance folding   761  DLG4_PDZ3
## 4    0.23419525       0.9180454 761_abundance folding   761  DLG4_PDZ3
## 5    0.30217642       1.1845316 761_abundance folding   761  DLG4_PDZ3
## 6    0.04204546       0.1648182 761_abundance folding   761  DLG4_PDZ3
##   alignment_position.x WT_aa.x structural_alignment_pos.x   consv.x
## 1                  V11       P                         11 0.0607867
## 2                  V11       P                         11 0.0607867
## 3                  V11       P                         11 0.0607867
## 4                  V11       P                         11 0.0607867
## 5                  V11       P                         11 0.0607867
## 6                  V11       P                         11 0.0607867
##   HAmin_ligand.x scHAmin_ligand.x     X1.x     X2.x     X3.x     X4.x     X5.x
## 1       18.38841         18.38841 30.40709 21.31351 27.95525 21.34054 24.21002
## 2       18.38841         18.38841 30.40709 21.31351 27.95525 21.34054 24.21002
## 3       18.38841         18.38841 30.40709 21.31351 27.95525 21.34054 24.21002
## 4       18.38841         18.38841 30.40709 21.31351 27.95525 21.34054 24.21002
## 5       18.38841         18.38841 30.40709 21.31351 27.95525 21.34054 24.21002
## 6       18.38841         18.38841 30.40709 21.31351 27.95525 21.34054 24.21002
##       X6.x     X7.x     X8.x     X9.x closest_ligand_pos.x closest_ligand_aa.x
## 1 22.35791 22.23024 23.87194 18.38841                    9                   V
## 2 22.35791 22.23024 23.87194 18.38841                    9                   V
## 3 22.35791 22.23024 23.87194 18.38841                    9                   V
## 4 22.35791 22.23024 23.87194 18.38841                    9                   V
## 5 22.35791 22.23024 23.87194 18.38841                    9                   V
## 6 22.35791 22.23024 23.87194 18.38841                    9                   V
##   binding_interface_5A.x WT_aa.1.x secondary_structure.x   rsasa.x
## 1                  FALSE         P                  loop 0.9242239
## 2                  FALSE         P                  loop 0.9242239
## 3                  FALSE         P                  loop 0.9242239
## 4                  FALSE         P                  loop 0.9242239
## 5                  FALSE         P                  loop 0.9242239
## 6                  FALSE         P                  loop 0.9242239
##   structure_location.x wt_aa.x mt_aa.x pos_eve.x popEVE.x ESM1v.x  X.y V1.y
## 1              surface       P       A       354   -3.710  -5.226 1588 1590
## 2              surface       P       C       354   -4.395  -9.925 1589 1591
## 3              surface       P       D       354   -4.804 -12.238 1590 1592
## 4              surface       P       E       354   -4.425 -10.872 1591 1593
## 5              surface       P       F       354   -4.521 -10.748 1592 1594
## 6              surface       P       G       354   -4.307  -9.615 1593 1595
##   id_old.y pos_am.y trait_name.y b_ddg_pred b_ddg_pred_sd ci95_kcal.mol.y
## 1      P1A        1      Binding  0.1978893     0.0608342      0.23847008
## 2      P1C        1      Binding  0.4602309     0.3331480      1.30594030
## 3      P1D        1      Binding  0.2162344     0.1601899      0.62794460
## 4      P1E        1      Binding  0.1494236     0.1641081      0.64330380
## 5      P1F        1      Binding  0.3684195     0.1401020      0.54920000
## 6      P1G        1      Binding  0.3154340     0.0236291      0.09262606
##   library.y assay.y pdz.y pdz_name.y alignment_position.y WT_aa.y
## 1   761_808 binding   761  DLG4_PDZ3                  V11       P
## 2   761_808 binding   761  DLG4_PDZ3                  V11       P
## 3   761_808 binding   761  DLG4_PDZ3                  V11       P
## 4   761_808 binding   761  DLG4_PDZ3                  V11       P
## 5   761_808 binding   761  DLG4_PDZ3                  V11       P
## 6   761_808 binding   761  DLG4_PDZ3                  V11       P
##   structural_alignment_pos.y   consv.y HAmin_ligand.y scHAmin_ligand.y     X1.y
## 1                         11 0.0607867       18.38841         18.38841 30.40709
## 2                         11 0.0607867       18.38841         18.38841 30.40709
## 3                         11 0.0607867       18.38841         18.38841 30.40709
## 4                         11 0.0607867       18.38841         18.38841 30.40709
## 5                         11 0.0607867       18.38841         18.38841 30.40709
## 6                         11 0.0607867       18.38841         18.38841 30.40709
##       X2.y     X3.y     X4.y     X5.y     X6.y     X7.y     X8.y     X9.y
## 1 21.31351 27.95525 21.34054 24.21002 22.35791 22.23024 23.87194 18.38841
## 2 21.31351 27.95525 21.34054 24.21002 22.35791 22.23024 23.87194 18.38841
## 3 21.31351 27.95525 21.34054 24.21002 22.35791 22.23024 23.87194 18.38841
## 4 21.31351 27.95525 21.34054 24.21002 22.35791 22.23024 23.87194 18.38841
## 5 21.31351 27.95525 21.34054 24.21002 22.35791 22.23024 23.87194 18.38841
## 6 21.31351 27.95525 21.34054 24.21002 22.35791 22.23024 23.87194 18.38841
##   Pos_ref.y closest_ligand_pos.y closest_ligand_aa.y binding_interface_5A.y
## 1       311                    9                   V                  FALSE
## 2       311                    9                   V                  FALSE
## 3       311                    9                   V                  FALSE
## 4       311                    9                   V                  FALSE
## 5       311                    9                   V                  FALSE
## 6       311                    9                   V                  FALSE
##   WT_aa.1.y secondary_structure.y   rsasa.y structure_location.y wt_aa.y
## 1         P                  loop 0.9242239              surface       P
## 2         P                  loop 0.9242239              surface       P
## 3         P                  loop 0.9242239              surface       P
## 4         P                  loop 0.9242239              surface       P
## 5         P                  loop 0.9242239              surface       P
## 6         P                  loop 0.9242239              surface       P
##   mt_aa.y pos_eve.y popEVE.y ESM1v.y     z_stab     p_stab   z_destab  p_destab
## 1       A       354   -3.710  -5.226 -0.6629067 0.25369517 -3.5543160 0.9998105
## 2       C       354   -4.395  -9.925  0.7530135 0.77427911 -5.9093315 1.0000000
## 3       D       354   -4.804 -12.238  1.5581207 0.94039768 -1.3791238 0.9160717
## 4       E       354   -4.425 -10.872 -2.0624166 0.01958404 -4.1973874 0.9999865
## 5       F       354   -4.521 -10.748  0.8789840 0.81029503 -0.7756785 0.7810306
## 6       G       354   -4.307  -9.615  5.9800680 1.00000000 -5.9118238 1.0000000
##         class orthosteric    fitted residuals HAmin_ligand scHAmin_ligand
## 1   no change       FALSE -8.064056  2.838056     18.37533       18.60036
## 2   no change       FALSE -8.167056 -1.757944     18.37533       18.60036
## 3   no change       FALSE -8.647162 -3.590838     18.37533       18.60036
## 4 stabilizing       FALSE -8.181711 -2.690289     18.37533       18.60036
## 5   no change       FALSE -8.648514 -2.099486     18.37533       18.60036
## 6   no change       FALSE -8.597645 -1.017355     18.37533       18.60036
##          5        6        7        8        9
## 1 24.60584 22.42312 22.65934 24.04283 18.60036
## 2 24.60584 22.42312 22.65934 24.04283 18.60036
## 3 24.60584 22.42312 22.65934 24.04283 18.60036
## 4 24.60584 22.42312 22.65934 24.04283 18.60036
## 5 24.60584 22.42312 22.65934 24.04283 18.60036
## 6 24.60584 22.42312 22.65934 24.04283 18.60036
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Pos\_ref.x) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{reframe}\NormalTok{(}
    \AttributeTok{median\_ddgb =} \FunctionTok{median}\NormalTok{(b\_ddg\_pred, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{median\_residual =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{scHAmin\_ligand =} \FunctionTok{first}\NormalTok{(scHAmin\_ligand),}
    \AttributeTok{orthosteric =} \FunctionTok{first}\NormalTok{(orthosteric),}
    \AttributeTok{Pos =} \FunctionTok{first}\NormalTok{(Pos\_ref.x))}

\FunctionTok{nrow}\NormalTok{(merged\_df\_residue) }\CommentTok{\#84}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 84
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{median\_residual, merged\_df\_residue}\SpecialCharTok{$}\NormalTok{median\_ddgb, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  merged_df_residue$median_residual and merged_df_residue$median_ddgb
## S = 129482, p-value = 0.004137
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.3109446
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#   Spearman\textquotesingle{}s rank correlation rho}
\CommentTok{\# }
\CommentTok{\# data:  merged\_df\_residue$median\_residual and merged\_df\_residue$median\_ddgb}
\CommentTok{\# S = 129482, p{-}value = 0.004137}
\CommentTok{\# alternative hypothesis: true rho is not equal to 0}
\CommentTok{\# sample estimates:}
\CommentTok{\#        rho }
\CommentTok{\# {-}0.3109446}

\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type }\OtherTok{\textless{}{-}} \StringTok{"Non{-}orthosteric site"}
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type[merged\_df\_residue}\SpecialCharTok{$}\NormalTok{orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Binding site"}

\NormalTok{figS3E }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(merged\_df\_residue, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ median\_ddgb, }\AttributeTok{y =}\NormalTok{  median\_residual, }\AttributeTok{color =}\NormalTok{ site\_type)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3: 84 residues (all 1587 mutations)"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.31"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Median ddGb"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Median ESM1v{-}ddGf residual"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"Non{-}orthosteric site"} \OtherTok{=} \StringTok{"darkgreen"}\NormalTok{,}
    \StringTok{"Binding site"} \OtherTok{=} \StringTok{"orange"}
\NormalTok{  )) }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey"}\NormalTok{) }
  \CommentTok{\#xlim({-}3,2) + ylim({-}5,5)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_pdz\_corr.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ figS3E, }\AttributeTok{width =} \DecValTok{4}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\NormalTok{figS3E}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-18-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_neg\_ddgb }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(b\_ddg\_pred }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(merged\_df\_neg\_ddgb) }\CommentTok{\#232}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 232
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df\_neg\_ddgb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Pos\_ref.x) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{reframe}\NormalTok{(}
    \AttributeTok{median\_ddgb =} \FunctionTok{median}\NormalTok{(b\_ddg\_pred, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{median\_residual =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{scHAmin\_ligand =} \FunctionTok{first}\NormalTok{(scHAmin\_ligand),}
    \AttributeTok{orthosteric =} \FunctionTok{first}\NormalTok{(orthosteric),}
    \AttributeTok{Pos =} \FunctionTok{first}\NormalTok{(Pos\_ref.x))}

\FunctionTok{nrow}\NormalTok{(merged\_df\_residue) }\CommentTok{\#}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 60
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue\_nonfunc }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df\_residue }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Fit exponential decay: y = a * exp({-}b * x) + c}
\NormalTok{exp\_model\_pdz3\_ddgb }\OtherTok{\textless{}{-}} \FunctionTok{nls}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_ddgb) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ a }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{*}\NormalTok{ scHAmin\_ligand),}
                 \AttributeTok{data =}\NormalTok{ merged\_df\_residue,}
                 \AttributeTok{start =} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \FloatTok{0.1}\NormalTok{))}
\NormalTok{exp\_model\_pdz3\_ddgb}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Nonlinear regression model
##   model: abs(median_ddgb) ~ a * exp(-b * scHAmin_ligand)
##    data: merged_df_residue
##      a      b 
## 0.9770 0.1554 
##  residual sum-of-squares: 3.51
## 
## Number of iterations to convergence: 8 
## Achieved convergence tolerance: 2.666e-06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nonlinear regression model}
\CommentTok{\#   model: abs(median\_ddgb) \textasciitilde{} a * exp({-}b * scHAmin\_ligand)}
\CommentTok{\#    data: merged\_df\_residue}
\CommentTok{\#      a      b }
\CommentTok{\# 0.9770 0.1554 }
\CommentTok{\#  residual sum{-}of{-}squares: 3.51}
\CommentTok{\# }
\CommentTok{\# Number of iterations to convergence: 8 }
\CommentTok{\# Achieved convergence tolerance: 2.666e{-}06}

\NormalTok{a }\OtherTok{\textless{}{-}} \FloatTok{0.9770}
\NormalTok{b }\OtherTok{\textless{}{-}}  \FloatTok{0.1554} 
\NormalTok{half\_d }\OtherTok{\textless{}{-}} \FunctionTok{log}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ b  }
\NormalTok{half\_d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.460407
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type }\OtherTok{\textless{}{-}} \StringTok{"Non{-}orthosteric site"}
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type[merged\_df\_residue}\SpecialCharTok{$}\NormalTok{orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Binding site"}

\NormalTok{x\_vals }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
              \FunctionTok{max}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), }\AttributeTok{length.out =} \DecValTok{200}\NormalTok{)}

\NormalTok{predicted\_y }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(exp\_model\_pdz3\_ddgb, }\AttributeTok{newdata =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals))}

\NormalTok{fit\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals, }\AttributeTok{b\_ddg\_pred =}\NormalTok{ predicted\_y)}

\FunctionTok{nrow}\NormalTok{(merged\_df\_residue)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 60
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3}\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(merged\_df\_residue, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =} \FunctionTok{abs}\NormalTok{(median\_ddgb))) }\SpecialCharTok{+}
  \CommentTok{\# Base layer: all points}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ site\_type, }\AttributeTok{alpha =} \FloatTok{0.4}\NormalTok{), }\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  
  \CommentTok{\# Loess fit line}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =}\NormalTok{ b\_ddg\_pred),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{data =}\NormalTok{ merged\_df\_residue }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(site\_type }\SpecialCharTok{!=} \StringTok{"Non{-}orthosteric site"}\NormalTok{),}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{Pos))}\SpecialCharTok{+}
  
  \CommentTok{\# Manual color palette for site type}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"Null"} \OtherTok{=} \StringTok{"grey"}\NormalTok{,}
    \StringTok{"Non{-}orthosteric site"} \OtherTok{=} \StringTok{"darkgreen"}\NormalTok{,}
    \StringTok{"Binding site"} \OtherTok{=} \StringTok{"orange"}
\NormalTok{  )) }\SpecialCharTok{+}
  \CommentTok{\# Reference lines}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"slategrey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3: allosteric decay"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"232 mutations with ddGb \textless{} 0"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Minimal distance to ligand"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Median ddGb"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{""}
\NormalTok{  )  }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,  }\AttributeTok{x =} \ConstantTok{Inf}\NormalTok{, }\AttributeTok{y =} \ConstantTok{Inf}\NormalTok{,}
             \AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{,}
           \AttributeTok{label =} \StringTok{"y = a * exp (b * x)}\SpecialCharTok{\textbackslash{}n}\StringTok{a =  0.9770}\SpecialCharTok{\textbackslash{}n}\StringTok{b = {-}0.1554 "}\NormalTok{,}
           \AttributeTok{size =} \DecValTok{4}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Duplicated aesthetics after name standardisation: hjust
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggMarginal}\NormalTok{(}
\NormalTok{  p3,}
  \AttributeTok{type =} \StringTok{"density"}\NormalTok{,}
  \AttributeTok{margins =} \StringTok{"both"}\NormalTok{,}
  \AttributeTok{groupColour =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{groupFill =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{size =} \DecValTok{10}\NormalTok{,}
  \AttributeTok{colour =} \StringTok{"grey"}\NormalTok{,}
  \AttributeTok{fill =} \StringTok{"lightgrey"}
\NormalTok{)}
\NormalTok{p3}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-19-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_neg\_residual }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(residuals }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(merged\_df\_neg\_residual) }\CommentTok{\#688}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 688
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df\_neg\_residual }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Pos\_ref.x) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{reframe}\NormalTok{(}
    \AttributeTok{median\_ddgb =} \FunctionTok{median}\NormalTok{(b\_ddg\_pred, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{median\_residual =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{scHAmin\_ligand =} \FunctionTok{first}\NormalTok{(scHAmin\_ligand),}
    \AttributeTok{orthosteric =} \FunctionTok{first}\NormalTok{(orthosteric),}
    \AttributeTok{Pos =} \FunctionTok{first}\NormalTok{(Pos\_ref.x))}

\FunctionTok{nrow}\NormalTok{(merged\_df\_residue) }\CommentTok{\#81}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 81
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fit exponential decay: y = a * exp({-}b * x) + c}
\NormalTok{exp\_model\_pdz3\_residual }\OtherTok{\textless{}{-}} \FunctionTok{nls}\NormalTok{(}\FunctionTok{abs}\NormalTok{(median\_residual) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ a }\SpecialCharTok{*} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{*}\NormalTok{ scHAmin\_ligand),}
                 \AttributeTok{data =}\NormalTok{ merged\_df\_residue,}
                 \AttributeTok{start =} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \FloatTok{0.1}\NormalTok{))}

\NormalTok{exp\_model\_pdz3\_residual }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Nonlinear regression model
##   model: abs(median_residual) ~ a * exp(-b * scHAmin_ligand)
##    data: merged_df_residue
##        a        b 
##  1.43905 -0.02959 
##  residual sum-of-squares: 118.8
## 
## Number of iterations to convergence: 12 
## Achieved convergence tolerance: 3.042e-06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nonlinear regression model}
\CommentTok{\#   model: abs(median\_residual) \textasciitilde{} a * exp({-}b * scHAmin\_ligand)}
\CommentTok{\#    data: merged\_df\_residue}
\CommentTok{\#        a        b }
\CommentTok{\#  1.43905 {-}0.02959 }
\CommentTok{\#  residual sum{-}of{-}squares: 118.8}
\CommentTok{\# }
\CommentTok{\# Number of iterations to convergence: 12 }
\CommentTok{\# Achieved convergence tolerance: 3.042e{-}06}

\NormalTok{a }\OtherTok{\textless{}{-}} \FloatTok{1.43905}
\NormalTok{b }\OtherTok{\textless{}{-}}  \FloatTok{0.02959} 
\NormalTok{half\_d }\OtherTok{\textless{}{-}} \FunctionTok{log}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ b  }\CommentTok{\#   }
\NormalTok{half\_d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 23.42505
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type }\OtherTok{\textless{}{-}} \StringTok{"Non{-}orthosteric site"}
\NormalTok{merged\_df\_residue}\SpecialCharTok{$}\NormalTok{site\_type[merged\_df\_residue}\SpecialCharTok{$}\NormalTok{orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Binding site"}

\NormalTok{x\_vals }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
              \FunctionTok{max}\NormalTok{(merged\_df\_residue}\SpecialCharTok{$}\NormalTok{scHAmin\_ligand, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), }\AttributeTok{length.out =} \DecValTok{200}\NormalTok{)}

\NormalTok{predicted\_y }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(exp\_model\_pdz3\_residual, }\AttributeTok{newdata =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals))}

\NormalTok{fit\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{scHAmin\_ligand =}\NormalTok{ x\_vals, }\AttributeTok{residual =}\NormalTok{ predicted\_y)}

\CommentTok{\# Plot}
\NormalTok{p4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(merged\_df\_residue, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =} \FunctionTok{abs}\NormalTok{(median\_residual))) }\SpecialCharTok{+}
  \CommentTok{\# Base layer: all points}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ site\_type, }\AttributeTok{alpha =} \FloatTok{0.4}\NormalTok{), }\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  
  \CommentTok{\# Loess fit line}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_df , }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ scHAmin\_ligand, }\AttributeTok{y =}\NormalTok{ residual),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}

  
  \CommentTok{\# Manual color palette for site type}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"Non{-}orthosteric site"} \OtherTok{=} \StringTok{"darkgreen"}\NormalTok{,}
    \StringTok{"Binding site"} \OtherTok{=} \StringTok{"orange"}
\NormalTok{  )) }\SpecialCharTok{+}
  \CommentTok{\# Reference lines}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FloatTok{4.315068}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"slategrey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =}\NormalTok{ y\_cutoff, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"slategrey"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{data =}\NormalTok{ merged\_df\_residue }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(site\_type }\SpecialCharTok{==} \StringTok{"Binding site"}\NormalTok{), }\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{Pos))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"PSD{-}95{-}PDZ3: allosteric decay"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"688 mutations with residual \textgreater{} 0"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Minimal distance to ligand"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"|Median ESM1v{-}ddGf residual|"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{""}
\NormalTok{  )  }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,  }\AttributeTok{x =} \ConstantTok{Inf}\NormalTok{, }\AttributeTok{y =} \ConstantTok{Inf}\NormalTok{,}
             \AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{,}
           \AttributeTok{label =} \StringTok{"y = a * exp (b * x)}\SpecialCharTok{\textbackslash{}n}\StringTok{a =  1.43905}\SpecialCharTok{\textbackslash{}n}\StringTok{b = {-}0.02959"}\NormalTok{,}
           \AttributeTok{size =} \DecValTok{4}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Duplicated aesthetics after name standardisation: hjust
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p4 }\OtherTok{\textless{}{-}} \FunctionTok{ggMarginal}\NormalTok{(}
\NormalTok{  p4,}
  \AttributeTok{type =} \StringTok{"density"}\NormalTok{,}
  \AttributeTok{margins =} \StringTok{"both"}\NormalTok{,}
  \AttributeTok{groupColour =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{groupFill =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{size =} \DecValTok{10}\NormalTok{,}
  \AttributeTok{colour =} \StringTok{"grey"}\NormalTok{,}
  \AttributeTok{fill =} \StringTok{"lightgrey"}
\NormalTok{)}

\NormalTok{p4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 3 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-20-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{figS3F }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p3,p4, }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{)}
\NormalTok{figS3F}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 6 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-20-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddgf }\OtherTok{\textless{}{-}} \FunctionTok{read\_tsv}\NormalTok{(}\StringTok{\textquotesingle{}/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/paper\_supplements/domains\_andre/GRB2{-}SH3/Abundance/mochi\_project/task\_1/weights/weights\_Folding.txt\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 1057 Columns: 22
## -- Column specification --------------------------------------------------------
## Delimiter: "\t"
## chr  (3): id, id_ref, trait_name
## dbl (19): Pos, Pos_ref, fold_1, fold_2, fold_3, fold_4, fold_5, fold_6, fold...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddgf }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddgf }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(id\_ref, Pos\_ref, }\StringTok{\textasciigrave{}}\AttributeTok{mean\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{std\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{)}
\FunctionTok{dim}\NormalTok{(sh3\_final\_df\_ddgf) }\CommentTok{\#1057    4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1057    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddgb }\OtherTok{\textless{}{-}} \FunctionTok{read\_tsv}\NormalTok{(}\StringTok{\textquotesingle{}/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/paper\_supplements/domains\_andre/GRB2{-}SH3/Abundance/mochi\_project/task\_1/weights/weights\_Binding.txt\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 757 Columns: 22
## -- Column specification --------------------------------------------------------
## Delimiter: "\t"
## chr  (3): id, id_ref, trait_name
## dbl (19): Pos, Pos_ref, fold_1, fold_2, fold_3, fold_4, fold_5, fold_6, fold...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddgb }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddgb }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(id\_ref, Pos\_ref, }\StringTok{\textasciigrave{}}\AttributeTok{mean\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{std\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{)}
\FunctionTok{dim}\NormalTok{(sh3\_final\_df\_ddgb) }\CommentTok{\#757   4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 757   4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_data }\OtherTok{\textless{}{-}} \FunctionTok{process\_protein\_data}\NormalTok{(}
  \AttributeTok{consurf\_file =} \StringTok{\textquotesingle{}/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/scores/3\_consurf/grb2\_consurf/new\_cleaned\_file.txt\textquotesingle{}}\NormalTok{,}
  \AttributeTok{am\_file =} \StringTok{\textquotesingle{}/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/scores/0\_am/alphamissense\_grb2.tsv\textquotesingle{}}\NormalTok{,}
  \AttributeTok{esm1b\_file =} \StringTok{\textquotesingle{}/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/scores/1\_esm1b/GRB2\_P62993\_esm1b.csv\textquotesingle{}}\NormalTok{,}
  \AttributeTok{popeve\_file =} \StringTok{\textquotesingle{}/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/scores/2\_popeve/GRB2\_NP\_002077.1.csv\textquotesingle{}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 217 Columns: 8
## -- Column specification --------------------------------------------------------
## Delimiter: "\t"
## chr (6): SEQ, ATOM, COLOR, CONFIDENCE INTERVAL, MSA DATA, RESIDUE VARIETY
## dbl (2): POS, SCORE
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Rows: 4123 Columns: 4
## -- Column specification --------------------------------------------------------
## Delimiter: "\t"
## chr (3): X1, X2, X4
## dbl (1): X3
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Rows: 4340 Columns: 3
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (1): variant
## dbl (2): score, pos
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Rows: 4123 Columns: 15
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr  (1): mutant
## dbl (14): column_coverage, popEVE, pop-adjusted_EVE, pop-adjusted_ESM1v, pop...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Rows: 4123 Columns: 15
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr  (1): mutant
## dbl (14): column_coverage, popEVE, pop-adjusted_EVE, pop-adjusted_ESM1v, pop...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{process\_and\_merge\_protein\_data }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(protein\_data, merged\_df) \{}

  \CommentTok{\# Merge with popEVE and ESM1v data}
\NormalTok{  merged\_df\_ddg }\OtherTok{\textless{}{-}}\NormalTok{ merged\_df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{merge}\NormalTok{(protein\_data}\SpecialCharTok{$}\NormalTok{popeve, }\AttributeTok{by.x =} \StringTok{"id\_ref"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"id"}\NormalTok{,}\AttributeTok{all.x =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{merge}\NormalTok{(protein\_data}\SpecialCharTok{$}\NormalTok{esm1v, }\AttributeTok{by.x =} \StringTok{"id\_ref"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{FALSE}\NormalTok{)}

  \FunctionTok{return}\NormalTok{(merged\_df\_ddg)}
\NormalTok{\}}

\NormalTok{sh3\_final\_df\_ddgf }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddgf }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wt\_aa =} \FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{\textquotesingle{}\^{}[A{-}Za{-}z]+\textquotesingle{}}\NormalTok{),}
         \AttributeTok{mt\_aa =} \FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{\textquotesingle{}[A{-}Za{-}z]+$\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{old\_id =}\NormalTok{ id\_ref) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{old\_Pos =}\NormalTok{ Pos\_ref) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{f\_ddg\_pred =} \StringTok{\textasciigrave{}}\AttributeTok{mean\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{f\_ddg\_pred\_sd =} \StringTok{\textasciigrave{}}\AttributeTok{std\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Pos\_ref =} \FunctionTok{as.numeric}\NormalTok{(old\_Pos) }\SpecialCharTok{+} \DecValTok{158}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id\_ref =} \FunctionTok{paste0}\NormalTok{(wt\_aa, Pos\_ref, mt\_aa))}

\NormalTok{sh3\_final\_df\_ddgf }\OtherTok{\textless{}{-}}\FunctionTok{process\_and\_merge\_protein\_data}\NormalTok{(sh3\_data, sh3\_final\_df\_ddgf)}
\FunctionTok{dim}\NormalTok{(sh3\_final\_df\_ddgf) }\CommentTok{\# 1056   10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1056   10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddgb }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddgb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wt\_aa =} \FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{\textquotesingle{}\^{}[A{-}Za{-}z]+\textquotesingle{}}\NormalTok{),}
         \AttributeTok{mt\_aa =} \FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{\textquotesingle{}[A{-}Za{-}z]+$\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{old\_id =}\NormalTok{ id\_ref) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{old\_Pos =}\NormalTok{ Pos\_ref) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{rename}\NormalTok{(}\AttributeTok{b\_ddg\_pred =} \StringTok{\textasciigrave{}}\AttributeTok{mean\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{b\_ddg\_pred\_sd =} \StringTok{\textasciigrave{}}\AttributeTok{std\_kcal/mol}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Pos\_ref =} \FunctionTok{as.numeric}\NormalTok{(old\_Pos) }\SpecialCharTok{+} \DecValTok{158}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id\_ref =} \FunctionTok{paste0}\NormalTok{(wt\_aa, Pos\_ref, mt\_aa))}

\NormalTok{sh3\_final\_df\_ddgb }\OtherTok{\textless{}{-}}\FunctionTok{process\_and\_merge\_protein\_data}\NormalTok{(sh3\_data, sh3\_final\_df\_ddgb)}
\FunctionTok{dim}\NormalTok{(sh3\_final\_df\_ddgb) }\CommentTok{\# 756  10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 756  10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Stability Definition \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(sh3\_final\_df\_ddgf, sh3\_final\_df\_ddgb, }\AttributeTok{by =} \StringTok{"id\_ref"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{dim}\NormalTok{(sh3\_final\_df\_ddg\_2plot) }\CommentTok{\#1056   19}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1056   19
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Step 1: Calculate z{-}scores and p{-}values for stabilizing mutations}
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{z\_stab =}\NormalTok{ (f\_ddg\_pred }\SpecialCharTok{{-}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ f\_ddg\_pred\_sd)}

\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{p\_stab =} \FunctionTok{pnorm}\NormalTok{(z\_stab))}

\CommentTok{\# Step 2: Calculate z{-}scores and p{-}values for destabilizing mutations}
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{z\_destab =}\NormalTok{ (f\_ddg\_pred }\SpecialCharTok{{-}} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ f\_ddg\_pred\_sd,}
         \AttributeTok{p\_destab =} \DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{pnorm}\NormalTok{(z\_destab))}

\CommentTok{\# Step 3: Classify mutations based on p{-}values}
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{class =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    p\_stab }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\textasciitilde{}} \StringTok{"stabilizing"}\NormalTok{,}
\NormalTok{    p\_destab }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\textasciitilde{}} \StringTok{"destabilizing"}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"no change"}
\NormalTok{  ))}

\CommentTok{\# Print summary of classification counts}
\NormalTok{class\_summary }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{class)}
\FunctionTok{print}\NormalTok{(class\_summary)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## destabilizing     no change   stabilizing 
##           585           411            60
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#destabilizing     no change   stabilizing }
\CommentTok{\#          585           411            60 }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{paper\_anno }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/cleaned\_ddg/sh3\_ddg\_cleaned.csv"}\NormalTok{)}
\FunctionTok{table}\NormalTok{(paper\_anno}\SpecialCharTok{$}\NormalTok{orthosteric)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## TRUE 
##  152
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(paper\_anno)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      id Pos_real Pos_ref old_id id_ref Pos mut_order f_dg_pred f_ddg_pred
## 1 A163C      163       5    A5C    A5C   5         1 1.2871009   2.118572
## 2 A163D      163       5    A5D    A5D   5         1 0.9224186   1.753889
## 3 A163E      163       5    A5E    A5E   5         1 1.3930653   2.224536
## 4 A163F      163       5    A5F    A5F   5         1 1.8272556   2.658726
## 5 A163G      163       5    A5G    A5G   5         1 0.4485680   1.280039
## 6 A163H      163       5    A5H    A5H   5         1 1.4787602   2.310231
##   f_ddg_pred_sd  b_dg_pred b_ddg_pred b_ddg_pred_sd f_ddg_pred_conf
## 1    0.02432856         NA         NA            NA            TRUE
## 2    0.02558423 -0.2844405  0.7605213    0.03313322            TRUE
## 3    0.02310688 -2.4969005 -1.4519387    0.62053013            TRUE
## 4    0.08655548         NA         NA            NA            TRUE
## 5    0.01206305 -1.2700695 -0.2251077    0.01497124            TRUE
## 6    0.04339128         NA         NA            NA            TRUE
##   b_ddg_pred_conf HAmin_ligand scHAmin_ligand RSASA    SS Pos_class  protein
## 1           FALSE     9.511215       10.33203  0.06 sheet      core GRB2-SH3
## 2            TRUE     9.511215       10.33203  0.06 sheet      core GRB2-SH3
## 3           FALSE     9.511215       10.33203  0.06 sheet      core GRB2-SH3
## 4           FALSE     9.511215       10.33203  0.06 sheet      core GRB2-SH3
## 5            TRUE     9.511215       10.33203  0.06 sheet      core GRB2-SH3
## 6           FALSE     9.511215       10.33203  0.06 sheet      core GRB2-SH3
##   WT_AA Mut b_ddg_wposmeanabs b_ddg_wposse allosteric orthosteric
## 1     A   C         0.3868335  0.009327359         NA          NA
## 2     A   D         0.3868335  0.009327359         NA          NA
## 3     A   E         0.3868335  0.009327359         NA          NA
## 4     A   F         0.3868335  0.009327359         NA          NA
## 5     A   G         0.3868335  0.009327359         NA          NA
## 6     A   H         0.3868335  0.009327359         NA          NA
##   allosteric_mutation wt_aa.x mt_aa wt_aa.y      atom consurf color
## 1                  NA       A     C       A ALA:163:A  -1.131     9
## 2                TRUE       A     D       A ALA:163:A  -1.131     9
## 3                  NA       A     E       A ALA:163:A  -1.131     9
## 4                  NA       A     F       A ALA:163:A  -1.131     9
## 5               FALSE       A     G       A ALA:163:A  -1.131     9
## 6                  NA       A     H       A ALA:163:A  -1.131     9
##   confidence_interval msa_data     RESIDUE.VARIETY     AM  AM_logit   ESM1b
## 1 -1.307, -1.003  9,8   47/150 A 93%, S  4%, E  2% 0.9660 3.3468033 -12.660
## 2 -1.307, -1.003  9,8   47/150 A 93%, S  4%, E  2% 0.9998 8.5169932 -17.821
## 3 -1.307, -1.003  9,8   47/150 A 93%, S  4%, E  2% 0.9997 8.1114280 -16.761
## 4 -1.307, -1.003  9,8   47/150 A 93%, S  4%, E  2% 0.9991 7.0122154 -18.435
## 5 -1.307, -1.003  9,8   47/150 A 93%, S  4%, E  2% 0.5857 0.3462174  -7.498
## 6 -1.307, -1.003  9,8   47/150 A 93%, S  4%, E  2% 0.9998 8.5169932 -20.762
##   popEVE   ESM1v   EVE
## 1 -4.803  -8.415 6.970
## 2 -5.620 -12.132 8.900
## 3 -5.563 -11.812 8.842
## 4 -5.646 -12.985 8.218
## 5 -4.392  -5.703 6.908
## 6 -6.062 -14.734 9.419
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ortho\_list }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(paper\_anno }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(Pos\_real))}

\NormalTok{ortho\_list}\OtherTok{\textless{}{-}} \FunctionTok{append}\NormalTok{(ortho\_list, }\FunctionTok{c}\NormalTok{(}\DecValTok{170}\NormalTok{ ,}\DecValTok{192}\NormalTok{ ,}\DecValTok{195}\NormalTok{ ,}\DecValTok{204}\NormalTok{ ,}\DecValTok{209}\NormalTok{))}

\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric }\OtherTok{\textless{}{-}} \ConstantTok{FALSE}
\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric[sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{Pos\_ref.x }\SpecialCharTok{\%in\%}\NormalTok{ ortho\_list] }\OtherTok{\textless{}{-}} \ConstantTok{TRUE}

\FunctionTok{table}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## FALSE  TRUE 
##   809   247
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#FALSE  TRUE }
\CommentTok{\#  809   247 }

\NormalTok{sh3\_final\_df\_ddg\_2plot\_all }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot}
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_all) }\CommentTok{\#1056}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1056
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred), ]}
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot) }\CommentTok{\#756}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 756
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(sh3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    id_ref old_id.x old_Pos.x f_ddg_pred f_ddg_pred_sd wt_aa.x mt_aa.x Pos_ref.x
## 2   A163D      A5D         5   1.839457    0.08964487       A       D       163
## 3   A163E      A5E         5   2.279397    0.05693226       A       E       163
## 5   A163G      A5G         5   1.345365    0.02795549       A       G       163
## 7   A163I      A5I         5   2.784022    0.18132980       A       I       163
## 11  A163N      A5N         5   2.413522    0.08280685       A       N       163
## 12  A163P      A5P         5   2.028785    0.05923400       A       P       163
##    popEVE.x ESM1v.x old_id.y old_Pos.y b_ddg_pred b_ddg_pred_sd wt_aa.y mt_aa.y
## 2    -5.620 -12.132      A5D         5  0.7594426    0.13786146       A       D
## 3    -5.563 -11.812      A5E         5 -1.4261234    0.16315904       A       E
## 5    -4.392  -5.703      A5G         5 -0.2783955    0.02497829       A       G
## 7    -5.717 -11.222      A5I         5 -0.8344887    0.55209774       A       I
## 11   -5.778 -13.038      A5N         5  0.5357424    0.51385355       A       N
## 12   -5.446 -10.389      A5P         5  0.5694963    0.14353457       A       P
##    Pos_ref.y popEVE.y ESM1v.y   z_stab p_stab z_destab p_destab         class
## 2        163   -5.620 -12.132 20.51938      1 14.94182        0 destabilizing
## 3        163   -5.563 -11.812 40.03701      1 31.25464        0 destabilizing
## 5        163   -4.392  -5.703 48.12525      1 30.23968        0 destabilizing
## 7        163   -5.717 -11.222 15.35336      1 12.59595        0 destabilizing
## 11       163   -5.778 -13.038 29.14641      1 23.10826        0 destabilizing
## 12       163   -5.446 -10.389 34.25034      1 25.80924        0 destabilizing
##    orthosteric
## 2        FALSE
## 3        FALSE
## 5        FALSE
## 7        FALSE
## 11       FALSE
## 12       FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(id\_ref, f\_ddg\_pred, f\_ddg\_pred\_sd,}
\NormalTok{                                                                     ESM1v.x, b\_ddg\_pred, b\_ddg\_pred\_sd,}
\NormalTok{                                                                     orthosteric,class) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(}\AttributeTok{ESM1v =}\NormalTok{ ESM1v.x)}

\NormalTok{sh3\_final\_df\_ddg\_2plot\_active }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{mean}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_active}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred) }\CommentTok{\#0.7443709}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7443709
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric }\OtherTok{\textless{}{-}} \ConstantTok{FALSE}
\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric[sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred }\SpecialCharTok{\textgreater{}=} \FunctionTok{mean}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_active}\SpecialCharTok{$}\NormalTok{b\_ddg\_pred)] }\OtherTok{\textless{}{-}} \ConstantTok{TRUE}
\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric[sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{FALSE}
\FunctionTok{table}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{allosteric)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## FALSE  TRUE 
##   703    53
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#FALSE  TRUE }
\CommentTok{\#  703    53 }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_out }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Fit a loess model using the filtered data}
\NormalTok{loess\_fit }\OtherTok{\textless{}{-}} \FunctionTok{loess}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f\_ddg\_pred, }\AttributeTok{data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_out, }\AttributeTok{span =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{family =} \StringTok{"symmetric"}\NormalTok{)}

\CommentTok{\# Predict fitted values for ALL data points using the loess model }
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_all)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1056
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{fitted }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(loess\_fit, }\AttributeTok{newdata =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_all)}

\CommentTok{\# Calculate residuals for ALL points}
\NormalTok{sh3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{residuals }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{ESM1v.x }\SpecialCharTok{{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{fitted}

\FunctionTok{range}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_all}\SpecialCharTok{$}\NormalTok{residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\CommentTok{\#{-}13.251857   5.372929}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -13.251857   5.372929
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_all }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_all }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mutation\_position =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(old\_id.x, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}

\NormalTok{median\_residuals }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_all }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(mutation\_position) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{median\_residuals =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}

\FunctionTok{min}\NormalTok{(median\_residuals}\SpecialCharTok{$}\NormalTok{median\_residuals) }\CommentTok{\#{-}8.978788}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -8.978788
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{max}\NormalTok{(median\_residuals}\SpecialCharTok{$}\NormalTok{median\_residuals) }\CommentTok{\#2.738424}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.738424
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdb }\OtherTok{\textless{}{-}} \FunctionTok{read.pdb}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/residual\_pdb/domains/2vwf.pdb"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    PDB has ALT records, taking A only, rm.alt=TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ median\_residuals}
\FunctionTok{head}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   mutation_position median_residuals
##               <dbl>            <dbl>
## 1                 1            0.649
## 2                 2           -2.35 
## 3                 3           -1.80 
## 4                 4           -3.22 
## 5                 5           -0.182
## 6                 6           -1.86
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a new B{-}factor vector initialized with the current B{-}factors from the PDB}
\NormalTok{new\_b\_factors }\OtherTok{\textless{}{-}}\NormalTok{ pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{b}

\CommentTok{\# Loop through each position in the correlation data and update the B{-}factors}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data)) \{}
\NormalTok{  position }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{mutation\_position[i]}
\NormalTok{  correlation\_value }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{median\_residuals[i]}
  
  \CommentTok{\# Find indices in the PDB that match the current position}
\NormalTok{  indices }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{resno }\SpecialCharTok{==}\NormalTok{ position)}
  
  \CommentTok{\# Print the indices and current B{-}factors before updating}
  \CommentTok{\#cat("Updating residue number:", position, "\textbackslash{}n")}
  \CommentTok{\#cat("Indices in PDB:", indices, "\textbackslash{}n")}
  \CommentTok{\#cat("Current B{-}factors:", new\_b\_factors[indices], "\textbackslash{}n")}
  
  \CommentTok{\# Update B{-}factors for all atoms in the current residue}
\NormalTok{  new\_b\_factors[indices] }\OtherTok{\textless{}{-}}\NormalTok{ correlation\_value}
  
  \CommentTok{\# Print the new B{-}factors after updating}
  \CommentTok{\#cat("Updated B{-}factors:", new\_b\_factors[indices], "\textbackslash{}n")}
  \CommentTok{\#cat("\textbackslash{}n")  \# Add an extra line for readability}
\NormalTok{\}}
\CommentTok{\# Replace non{-}matching B{-}factors with outlier value so we can filter it out in ChimeraX}
\NormalTok{non\_matching\_indices }\OtherTok{\textless{}{-}} \FunctionTok{setdiff}\NormalTok{(}\FunctionTok{seq\_along}\NormalTok{(new\_b\_factors), }\FunctionTok{which}\NormalTok{(pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{resno }\SpecialCharTok{\%in\%}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{mutation\_position))}
\NormalTok{new\_b\_factors[non\_matching\_indices] }\OtherTok{\textless{}{-}} \DecValTok{999}

\CommentTok{\# Assign the new B{-}factors back to the pdb structure}
\CommentTok{\# Write the modified PDB structure to a new file}
\NormalTok{pdb}\SpecialCharTok{$}\NormalTok{atom}\SpecialCharTok{$}\NormalTok{b }\OtherTok{\textless{}{-}}\NormalTok{ new\_b\_factors}
\FunctionTok{write.pdb}\NormalTok{(pdb, }\AttributeTok{file =} \StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/residual\_pdb/domains/2vwf\_median\_residual\_loess.pdb"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_out }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Fit a loess model using the filtered data}
\NormalTok{loess\_fit }\OtherTok{\textless{}{-}} \FunctionTok{loess}\NormalTok{(ESM1v }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f\_ddg\_pred, }\AttributeTok{data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_out, }\AttributeTok{span =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{family =} \StringTok{"symmetric"}\NormalTok{)}

\CommentTok{\# Predict fitted values for ALL data points using the loess model }
\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{fitted }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(loess\_fit, }\AttributeTok{newdata =}\NormalTok{ sh3\_final\_df\_ddg\_2plot)}

\CommentTok{\# Calculate residuals for ALL points}
\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{ESM1v }\SpecialCharTok{{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{fitted}

\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{fitted))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\CommentTok{\#{-}13.251857   5.372929}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -13.251857   5.372929
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{ESM1v) }\CommentTok{\#{-}17.80   2.73}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -17.80   2.73
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{range}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred) }\CommentTok{\#{-}0.8155064  3.0465777}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.8155064  3.0465777
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit\_line\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{f\_ddg\_pred =} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(}\DecValTok{0}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                   \FunctionTok{max}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_out}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                   \AttributeTok{length.out =} \DecValTok{200}\NormalTok{)}
\NormalTok{)}

\NormalTok{fit\_line\_df}\SpecialCharTok{$}\NormalTok{ESM1v }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(loess\_fit, }\AttributeTok{newdata =}\NormalTok{ fit\_line\_df)}
\FunctionTok{cor.test}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}{-}0.5766367 }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in cor.test.default(sh3_final_df_ddg_2plot$f_ddg_pred,
## sh3_final_df_ddg_2plot$ESM1v, : Cannot compute exact p-value with ties
\end{verbatim}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  sh3_final_df_ddg_2plot$f_ddg_pred and sh3_final_df_ddg_2plot$ESM1v
## S = 113538982, p-value < 2.2e-16
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.5766367
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 756
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(sh3\_final\_df\_ddg\_2plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"GRB2{-}SH3: All 756 Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.58"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{18}\NormalTok{, }\FloatTok{2.8}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.9}\NormalTok{, }\FloatTok{3.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                        \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{13.3}\NormalTok{, }\FloatTok{5.4}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{p1}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-25-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_int }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_int)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 171
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_int}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, sh3\_final\_df\_ddg\_2plot\_int}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}0.40}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in cor.test.default(sh3_final_df_ddg_2plot_int$f_ddg_pred,
## sh3_final_df_ddg_2plot_int$ESM1v, : Cannot compute exact p-value with ties
\end{verbatim}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  sh3_final_df_ddg_2plot_int$f_ddg_pred and sh3_final_df_ddg_2plot_int$ESM1v
## S = 1168634, p-value = 4.893e-08
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.4023498
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_int, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.6}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"171 Orthosteric Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.40"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{18}\NormalTok{, }\FloatTok{2.8}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.9}\NormalTok{, }\FloatTok{3.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                        \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{13.3}\NormalTok{, }\FloatTok{5.4}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{p2}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-25-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_allo }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(allosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_allo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 53
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_allo}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, sh3\_final\_df\_ddg\_2plot\_allo}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}0.55}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  sh3_final_df_ddg_2plot_allo$f_ddg_pred and sh3_final_df_ddg_2plot_allo$ESM1v
## S = 38442, p-value = 2.745e-05
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.5498307
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{unique}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_allo}\SpecialCharTok{$}\NormalTok{id\_ref)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "A163D" "A163V" "A197P" "D181L" "F177H" "F177S" "F182W" "F205C" "F205N"
## [10] "F205S" "G173A" "G173C" "G173L" "G173R" "G173V" "G173W" "G196L" "G196R"
## [19] "G203C" "G203D" "G203F" "G203H" "G203I" "G203L" "G203S" "G203T" "G203Y"
## [28] "H184P" "I183F" "I183M" "I183N" "I183S" "I183T" "L164P" "L175K" "L175P"
## [37] "L175Q" "L175R" "M186G" "N188M" "Q162M" "Q162P" "R178A" "R178P" "R207P"
## [46] "T211P" "V161D" "V185D" "V185E" "V185F" "V185G" "V210D" "W194R"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_allo, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.6}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_allo }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(residuals }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{),}
                  \FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ id\_ref), }\AttributeTok{size =} \DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"53 Allosteric Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.55"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{18}\NormalTok{, }\FloatTok{2.8}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.9}\NormalTok{, }\FloatTok{3.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{13.3}\NormalTok{, }\FloatTok{5.4}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}


\NormalTok{p3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 4 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-25-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_other }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(allosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_other)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 532
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_other}\SpecialCharTok{$}\NormalTok{f\_ddg\_pred, sh3\_final\_df\_ddg\_2plot\_other}\SpecialCharTok{$}\NormalTok{ESM1v, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{) }\CommentTok{\#{-}0.768915 }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in cor.test.default(sh3_final_df_ddg_2plot_other$f_ddg_pred,
## sh3_final_df_ddg_2plot_other$ESM1v, : Cannot compute exact p-value with ties
\end{verbatim}

\begin{verbatim}
## 
##  Spearman's rank correlation rho
## 
## data:  sh3_final_df_ddg_2plot_other$f_ddg_pred and sh3_final_df_ddg_2plot_other$ESM1v
## S = 44390403, p-value < 2.2e-16
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##       rho 
## -0.768915
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_other, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ fit\_line\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v),}
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.6}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"532 Other Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.77"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{18}\NormalTok{, }\FloatTok{2.8}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.9}\NormalTok{, }\FloatTok{3.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                         \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{13.3}\NormalTok{, }\FloatTok{5.4}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{p4}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-25-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{figS3A }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1,p2,p3, p4, }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_sh3\_scatter.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ figS3A, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{3}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 26 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{figS3A}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 26 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-25-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{figS3A }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_other, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ f\_ddg\_pred, }\AttributeTok{y =}\NormalTok{ ESM1v, }\AttributeTok{color =}\NormalTok{ residuals)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.35}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\#geom\_vline(xintercept = 0.71, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \CommentTok{\#geom\_hline(yintercept = {-}1.11, linetype = "dashed", linewidth = 0.5, color = "grey") +}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"532 Other Mutations"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Spearman\textquotesingle{}s rho = {-}0.77"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Measured ddGf"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Residuals"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{18}\NormalTok{, }\FloatTok{2.8}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.9}\NormalTok{, }\FloatTok{3.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey"}\NormalTok{, }\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{midpoint =} \DecValTok{0}\NormalTok{, }\AttributeTok{name =} \StringTok{"Residuals"}\NormalTok{,}
                         \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{13.3}\NormalTok{, }\FloatTok{5.4}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_sh3\_legend.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ figS3A, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{3}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\NormalTok{figS3A}
\end{Highlighting}
\end{Shaded}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-26-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pos\_eve =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}

\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{site\_class =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"orthosteric"}\NormalTok{,}
\NormalTok{    allosteric }\SpecialCharTok{==} \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"allosteric"}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"other"}
\NormalTok{  ))}

\NormalTok{label\_df }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(site\_class) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{median\_val =} \FunctionTok{median}\NormalTok{(residuals, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  )}

\NormalTok{sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{site\_class }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{site\_class, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"orthosteric"}\NormalTok{, }\StringTok{"allosteric"}\NormalTok{, }\StringTok{"other"}\NormalTok{))}

\NormalTok{fig3C }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(sh3\_final\_df\_ddg\_2plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =}\NormalTok{ residuals, }\AttributeTok{fill =}\NormalTok{ site\_class)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{trim =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{scale =} \StringTok{"width"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{color =} \ConstantTok{NA}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun =}\NormalTok{ median, }\AttributeTok{geom =} \StringTok{"crossbar"}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.4}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fatten =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun =}\NormalTok{ median, }\AttributeTok{geom =} \StringTok{"point"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{23}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{fill =} \StringTok{"black"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ label\_df,}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{residuals) }\SpecialCharTok{*} \FloatTok{1.1}\NormalTok{,}
        \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"n = "}\NormalTok{, n)),}
    \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{size =} \DecValTok{4}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ label\_df,}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =} \DecValTok{10}\NormalTok{,}
        \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"n = "}\NormalTok{, n)),}
    \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{size =} \DecValTok{4}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ label\_df,}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ site\_class, }\AttributeTok{y =}\NormalTok{ median\_val }\SpecialCharTok{+} \FloatTok{1.9}\NormalTok{, }\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.2f"}\NormalTok{, median\_val)),}
    \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{size =} \DecValTok{6}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_signif}\NormalTok{(}
    \AttributeTok{comparisons =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\StringTok{"orthosteric"}\NormalTok{, }\StringTok{"allosteric"}\NormalTok{),}
      \FunctionTok{c}\NormalTok{(}\StringTok{"orthosteric"}\NormalTok{, }\StringTok{"other"}\NormalTok{),}
      \FunctionTok{c}\NormalTok{(}\StringTok{"allosteric"}\NormalTok{, }\StringTok{"other"}\NormalTok{)}
\NormalTok{    ),}
    \AttributeTok{map\_signif\_level =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{test =} \StringTok{"wilcox.test"}\NormalTok{,}
    \AttributeTok{step\_increase =} \FloatTok{0.1}\NormalTok{,}
    \AttributeTok{tip\_length =} \FloatTok{0.01}
\NormalTok{  ) }\SpecialCharTok{+}
  
  \CommentTok{\# Labels and theme}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"GRB2{-}SH3"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{""}\NormalTok{,}
    \AttributeTok{x =} \StringTok{""}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"ESM1v {-} ddGf residual"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"orthosteric"} \OtherTok{=} \StringTok{"orange"}\NormalTok{,}
    \StringTok{"allosteric"} \OtherTok{=} \StringTok{"cyan3"}\NormalTok{,}
    \StringTok{"other"} \OtherTok{=} \StringTok{"darkgreen"}
\NormalTok{  )) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_sh3\_violin.pdf"}\NormalTok{, }
       \AttributeTok{plot =}\NormalTok{ fig3C, }\AttributeTok{width =} \DecValTok{3}\NormalTok{, }\AttributeTok{height =} \DecValTok{3}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_ydensity()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
## Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_signif()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 3 rows containing missing values or values outside the scale range
## (`geom_text()`).
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fig3C}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_ydensity()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
## Removed 1 row containing non-finite outside the scale range (`stat_summary()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 row containing non-finite outside the scale range
## (`stat_signif()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 3 rows containing missing values or values outside the scale range
## (`geom_text()`).
\end{verbatim}

\includegraphics{fig3_files/figure-latex/unnamed-chunk-27-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# MODEL 0: all mutations, ddGf + ddGa \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{11}\NormalTok{)}
\CommentTok{\# Usage example}
\NormalTok{m0\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m0"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.5349"
## [1] "Adjusted R-squared 95% CI: 0.4851 - 0.5825"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m1\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.3613"
## [1] "Adjusted R-squared 95% CI: 0.2873 - 0.4255"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m2\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddga}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.1271"
## [1] "Adjusted R-squared 95% CI: 0.0417 - 0.2097"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# MODEL 3: non{-}active mutations, ddGf + ddGa \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\FunctionTok{table}\NormalTok{(sh3\_final\_df\_ddg\_2plot}\SpecialCharTok{$}\NormalTok{orthosteric)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## FALSE  TRUE 
##   585   171
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot\_non\_active }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_non\_active) }\CommentTok{\#585}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 585
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m3\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.6672"
## [1] "Adjusted R-squared 95% CI: 0.6265 - 0.7046"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m4\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m4"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.6408"
## [1] "Adjusted R-squared 95% CI: 0.596 - 0.6816"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m5\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddga}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m5"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.0447"
## [1] "Adjusted R-squared 95% CI: -0.0596 - 0.1449"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# MODEL 6: active mutations, ddGf + ddGa \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{sh3\_final\_df\_ddg\_2plot\_active }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(orthosteric }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{nrow}\NormalTok{(sh3\_final\_df\_ddg\_2plot\_active) }\CommentTok{\#171}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 171
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m6\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m6"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.1814"
## [1] "Adjusted R-squared 95% CI: 0.0291 - 0.3055"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m7\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddga}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m7"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.1752"
## [1] "Adjusted R-squared 95% CI: -0.0103 - 0.3312"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m8\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m8"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Adjusted R-squared: 0.4067"
## [1] "Adjusted R-squared 95% CI: 0.2788 - 0.5141"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{wilcox.test}\NormalTok{(}\FunctionTok{abs}\NormalTok{(m6\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values), }\FunctionTok{abs}\NormalTok{(m7\_results}\SpecialCharTok{$}\NormalTok{adj\_r2\_values))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Wilcoxon rank sum test with continuity correction
## 
## data:  abs(m6_results$adj_r2_values) and abs(m7_results$adj_r2_values)
## W = 524635, p-value = 0.05643
## alternative hypothesis: true location shift is not equal to 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{wilcox.test}\NormalTok{(}
  \FunctionTok{subset}\NormalTok{(plot\_data, category }\SpecialCharTok{==} \StringTok{"orthosteric"} \SpecialCharTok{\&}\NormalTok{ type }\SpecialCharTok{==} \StringTok{"abundance"}\NormalTok{)}\SpecialCharTok{$}\NormalTok{adj\_r2\_values,}
  \FunctionTok{subset}\NormalTok{(plot\_data, category }\SpecialCharTok{==} \StringTok{"orthosteric"} \SpecialCharTok{\&}\NormalTok{ type }\SpecialCharTok{==} \StringTok{"activity"}\NormalTok{)}\SpecialCharTok{$}\NormalTok{adj\_r2\_values}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Wilcoxon rank sum test with continuity correction
## 
## data:  subset(plot_data, category == "orthosteric" & type == "abundance")$adj_r2_values and subset(plot_data, category == "orthosteric" & type == "activity")$adj_r2_values
## W = 523942, p-value = 0.06373
## alternative hypothesis: true location shift is not equal to 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anova}\NormalTok{(m0\_results}\SpecialCharTok{$}\NormalTok{fit, m1\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: ESM1v ~ f_ddg_pred + b_ddg_pred
## Model 2: ESM1v ~ f_ddg_pred
##   Res.Df    RSS Df Sum of Sq      F    Pr(>F)    
## 1    753 5794.6                                  
## 2    754 7967.9 -1   -2173.3 282.41 < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 1: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred}
\CommentTok{\# Model 2: ESM1v \textasciitilde{} f\_ddg\_pred}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1    753 5794.6                                  }
\CommentTok{\# 2    754 7967.9 {-}1   {-}2173.3 282.41 \textless{} 2.2e{-}16 ***}
\FunctionTok{anova}\NormalTok{(m4\_results}\SpecialCharTok{$}\NormalTok{fit, m3\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: ESM1v ~ f_ddg_pred
## Model 2: ESM1v ~ f_ddg_pred + b_ddg_pred
##   Res.Df    RSS Df Sum of Sq      F    Pr(>F)    
## 1    583 3265.3                                  
## 2    582 3019.8  1    245.48 47.311 1.568e-11 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 1: ESM1v \textasciitilde{} f\_ddg\_pred}
\CommentTok{\# Model 2: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1    583 3265.3                                  }
\CommentTok{\# 2    582 3019.8  1    245.48 47.311 1.568e{-}11 ***}
\FunctionTok{anova}\NormalTok{(m6\_results}\SpecialCharTok{$}\NormalTok{fit, m8\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: ESM1v ~ f_ddg_pred
## Model 2: ESM1v ~ f_ddg_pred + b_ddg_pred
##   Res.Df    RSS Df Sum of Sq      F    Pr(>F)    
## 1    169 1864.3                                  
## 2    168 1343.0  1    521.27 65.205 1.245e-13 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 1: ESM1v \textasciitilde{} f\_ddg\_pred}
\CommentTok{\# Model 2: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred}
\CommentTok{\#   Res.Df    RSS Df Sum of Sq      F    Pr(\textgreater{}F)    }
\CommentTok{\# 1    169 1864.3                                  }
\CommentTok{\# 2    168 1343.0  1    521.27 65.205 1.245e{-}13 ***}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sh3\_final\_df\_ddg\_2plot }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pos\_eve =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}

\NormalTok{m0\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m0"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.4035"
## [1] "Conditional R-squared: 0.7589"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#[1] "Marginal R{-}squared: 0.4035"}
\CommentTok{\#[1] "Conditional R{-}squared: 0.7589"}
\NormalTok{m1\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot, }\AttributeTok{model\_id =} \StringTok{"m1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.3404"
## [1] "Conditional R-squared: 0.7687"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Warning: Model failed to converge with max|grad| = 0.00504248 (tol = 0.002, component 1)[1] "Marginal R{-}squared: 0.3404"}
\CommentTok{\#[1] "Conditional R{-}squared: 0.7687"}
\NormalTok{sh3\_final\_df\_ddg\_2plot\_non\_active }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_non\_active }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pos\_eve =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}

\NormalTok{m3\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.6049"
## [1] "Conditional R-squared: 0.7721"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#[1] "Marginal R{-}squared: 0.6049"}
\CommentTok{\#[1] "Conditional R{-}squared: 0.7721"}
\NormalTok{m4\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_non\_active, }\AttributeTok{model\_id =} \StringTok{"m4"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.5667"
## [1] "Conditional R-squared: 0.7592"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#[1] "Marginal R{-}squared: 0.5667"}
\CommentTok{\#[1] "Conditional R{-}squared: 0.7592"}
\NormalTok{sh3\_final\_df\_ddg\_2plot\_active }\OtherTok{\textless{}{-}}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_active }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pos\_eve =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(id\_ref, }\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+)(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D)"}\NormalTok{)))}

\NormalTok{m6\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_both\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m6"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.1479"
## [1] "Conditional R-squared: 0.5509"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#[1] "Marginal R{-}squared: 0.1479"}
\CommentTok{\#[1] "Conditional R{-}squared: 0.5509"}
\NormalTok{m7\_results }\OtherTok{\textless{}{-}} \FunctionTok{fit\_model\_and\_diagnostics\_ddgf\_lmm}\NormalTok{(}\AttributeTok{input\_data =}\NormalTok{ sh3\_final\_df\_ddg\_2plot\_active, }\AttributeTok{model\_id =} \StringTok{"m7"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Marginal R-squared: 0.0958"
## [1] "Conditional R-squared: 0.594"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#[1] "Marginal R{-}squared: 0.0958"}
\CommentTok{\#[1] "Conditional R{-}squared: 0.594"}
\FunctionTok{anova}\NormalTok{(m1\_results}\SpecialCharTok{$}\NormalTok{fit, m0\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## refitting model(s) with ML (instead of REML)
\end{verbatim}

\begin{verbatim}
## Data: input_data
## Models:
## m1_results$fit: ESM1v ~ f_ddg_pred + (1 | pos_eve)
## m0_results$fit: ESM1v ~ f_ddg_pred + b_ddg_pred + (1 | pos_eve)
##                npar    AIC    BIC logLik -2*log(L)  Chisq Df Pr(>Chisq)    
## m1_results$fit    4 3339.9 3358.4  -1666    3331.9                         
## m0_results$fit    5 3304.1 3327.2  -1647    3294.1 37.858  1  7.609e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# m1\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\# m0\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\#                npar    AIC    BIC logLik {-}2*log(L)  Chisq Df Pr(\textgreater{}Chisq)    }
\CommentTok{\# m1\_results$fit    4 3339.9 3358.4  {-}1666    3331.9                         }
\CommentTok{\# m0\_results$fit    5 3304.1 3327.2  {-}1647    3294.1 37.858  1  7.609e{-}10 ***}

\FunctionTok{anova}\NormalTok{(m4\_results}\SpecialCharTok{$}\NormalTok{fit, m3\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## refitting model(s) with ML (instead of REML)
\end{verbatim}

\begin{verbatim}
## Data: input_data
## Models:
## m4_results$fit: ESM1v ~ f_ddg_pred + (1 | pos_eve)
## m3_results$fit: ESM1v ~ f_ddg_pred + b_ddg_pred + (1 | pos_eve)
##                npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(>Chisq)    
## m4_results$fit    4 2461.3 2478.8 -1226.7    2453.3                         
## m3_results$fit    5 2434.5 2456.4 -1212.3    2424.5 28.795  1  8.047e-08 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Models:}
\CommentTok{\# m4\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\# m3\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\#                npar    AIC    BIC  logLik {-}2*log(L)  Chisq Df Pr(\textgreater{}Chisq)    }
\CommentTok{\# m4\_results$fit    4 2461.3 2478.8 {-}1226.7    2453.3                         }
\CommentTok{\# m3\_results$fit    5 2434.5 2456.4 {-}1212.3    2424.5 28.795  1  8.047e{-}08 ***}

\FunctionTok{anova}\NormalTok{(m7\_results}\SpecialCharTok{$}\NormalTok{fit, m6\_results}\SpecialCharTok{$}\NormalTok{fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## refitting model(s) with ML (instead of REML)
\end{verbatim}

\begin{verbatim}
## Data: input_data
## Models:
## m7_results$fit: ESM1v ~ f_ddg_pred + (1 | pos_eve)
## m6_results$fit: ESM1v ~ f_ddg_pred + b_ddg_pred + (1 | pos_eve)
##                npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(>Chisq)  
## m7_results$fit    4 810.36 822.92 -401.18    802.36                       
## m6_results$fit    5 807.81 823.52 -398.91    797.81 4.5424  1    0.03307 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# m7\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\# m6\_results$fit: ESM1v \textasciitilde{} f\_ddg\_pred + b\_ddg\_pred + (1 | pos\_eve)}
\CommentTok{\#                npar    AIC    BIC  logLik {-}2*log(L)  Chisq Df Pr(\textgreater{}Chisq)  }
\CommentTok{\# m7\_results$fit    4 810.36 822.92 {-}401.18    802.36                       }
\CommentTok{\# m6\_results$fit    5 807.81 823.52 {-}398.91    797.81 4.5424  1    0.03307 *}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# \# Combine all adjusted\_r\_squared values into a single dataframe}
\CommentTok{\# \# Step 1: Build raw data (same as before)}
\CommentTok{\# plot\_data \textless{}{-} data.frame(}
\CommentTok{\#   category = rep(c("whole protein", "non{-}orthosteric", "orthosteric"), each = 3000),}
\CommentTok{\#   type = rep(c("abundance", "activity", "both"), times = 3, each = 1000),}
\CommentTok{\#   adj\_r2\_values = c(}
\CommentTok{\#     m1\_results$adj\_r2\_values, m2\_results$adj\_r2\_values, m0\_results$adj\_r2\_values,}
\CommentTok{\#     m4\_results$adj\_r2\_values, m5\_results$adj\_r2\_values, m3\_results$adj\_r2\_values,}
\CommentTok{\#     m6\_results$adj\_r2\_values, m7\_results$adj\_r2\_values, m8\_results$adj\_r2\_values}
\CommentTok{\#   )}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# \# Step 2: Build CI summary table}
\CommentTok{\# ci\_summary \textless{}{-} data.frame(}
\CommentTok{\#   category = rep(c("whole protein", "non{-}orthosteric", "orthosteric"), each = 3),}
\CommentTok{\#   type = rep(c("abundance", "activity", "both"), times = 3),}
\CommentTok{\#   mean\_adj\_r2 = c(}
\CommentTok{\#     mean(m1\_results$adj\_r2\_values), mean(m2\_results$adj\_r2\_values), m0\_results$adjusted\_r\_squared,}
\CommentTok{\#     mean(m4\_results$adj\_r2\_values), mean(m5\_results$adj\_r2\_values), mean(m3\_results$adj\_r2\_values),}
\CommentTok{\#     mean(m6\_results$adj\_r2\_values), mean(m7\_results$adj\_r2\_values), mean(m8\_results$adj\_r2\_values)}
\CommentTok{\#   ),}
\CommentTok{\#   ci\_lower = c(}
\CommentTok{\#     quantile(m1\_results$adj\_r2\_values, 0.025), quantile(m2\_results$adj\_r2\_values, 0.025), }
\CommentTok{\#     quantile(m0\_results$adj\_r2\_values, 0.025),}
\CommentTok{\#     quantile(m4\_results$adj\_r2\_values, 0.025), quantile(m5\_results$adj\_r2\_values, 0.025), quantile(m3\_results$adj\_r2\_values, 0.025),}
\CommentTok{\#     quantile(m6\_results$adj\_r2\_values, 0.025), quantile(m7\_results$adj\_r2\_values, 0.025), quantile(m8\_results$adj\_r2\_values, 0.025)}
\CommentTok{\#   ),}
\CommentTok{\#   ci\_upper = c(}
\CommentTok{\#     quantile(m1\_results$adj\_r2\_values, 0.975), quantile(m2\_results$adj\_r2\_values, 0.975), }
\CommentTok{\#     quantile(m0\_results$adj\_r2\_values, 0.975),}
\CommentTok{\#     quantile(m4\_results$adj\_r2\_values, 0.975), quantile(m5\_results$adj\_r2\_values, 0.975), quantile(m3\_results$adj\_r2\_values, 0.975),}
\CommentTok{\#     quantile(m6\_results$adj\_r2\_values, 0.975), quantile(m7\_results$adj\_r2\_values, 0.975), quantile(m8\_results$adj\_r2\_values, 0.975)}
\CommentTok{\#   )}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# \# Factor levels for consistency}
\CommentTok{\# plot\_data$category \textless{}{-} factor(plot\_data$category, levels = c("whole protein", "non{-}orthosteric", "orthosteric"))}
\CommentTok{\# plot\_data$type \textless{}{-} factor(plot\_data$type, levels = c("abundance", "activity", "both"))}
\CommentTok{\# ci\_summary$category \textless{}{-} factor(ci\_summary$category, levels = levels(plot\_data$category))}
\CommentTok{\# ci\_summary$type \textless{}{-} factor(ci\_summary$type, levels = levels(plot\_data$type))}
\CommentTok{\# }
\CommentTok{\# \# Step 3: Plot using CI summary for bars}
\CommentTok{\# fig3E \textless{}{-} ggplot(ci\_summary, aes(x = type, y = mean\_adj\_r2, fill = type)) +}
\CommentTok{\#   geom\_col(width = 0.6, alpha = 0.85) +}
\CommentTok{\#   geom\_errorbar(aes(ymin = ci\_lower, ymax = ci\_upper), width = 0.2, color = "black") +}
\CommentTok{\#   geom\_text(aes(label = sprintf("\%.3f", mean\_adj\_r2)), vjust = {-}1.5, size = 5, color = "black") +}
\CommentTok{\#   facet\_wrap(\textasciitilde{}category) +}
\CommentTok{\#   scale\_fill\_brewer(palette = "Set2") +}
\CommentTok{\#   theme\_classic() +}
\CommentTok{\#   theme(}
\CommentTok{\#     legend.position = "none",}
\CommentTok{\#     axis.line = element\_line(linewidth = 0.6),}
\CommentTok{\#     strip.text = element\_text(size = 16, face = "bold"),}
\CommentTok{\#     axis.text.x = element\_text(size = 16, face = "bold", angle = 45, hjust = 1),}
\CommentTok{\#     axis.text.y = element\_text(size = 12),}
\CommentTok{\#     axis.title.y = element\_text(size = 18),}
\CommentTok{\#     plot.title = element\_text(size = 18, face = "bold"),}
\CommentTok{\#     plot.subtitle = element\_text(size = 16, face = "italic")}
\CommentTok{\#   ) +}
\CommentTok{\#   labs(}
\CommentTok{\#     title = "GRB2{-}SH3", }
\CommentTok{\#     subtitle = "Linear regression against ESM1v", }
\CommentTok{\#     x = "", }
\CommentTok{\#     y = "Adjusted R"}
\CommentTok{\#   ) +}
\CommentTok{\#   \# Significance comparisons using full plot\_data}
\CommentTok{\# geom\_signif(}
\CommentTok{\#     data = subset(plot\_data, category == "whole protein"),}
\CommentTok{\#     aes(x = type, y = adj\_r2\_values),}
\CommentTok{\#     comparisons = list(c("abundance", "both")),}
\CommentTok{\#     annotations = c("p \textless{} 2.2e{-}16"),}
\CommentTok{\#     y\_position = c(0.85),}
\CommentTok{\#     tip\_length = 0.02,}
\CommentTok{\#     step\_increase = 0.05,}
\CommentTok{\#     test = "wilcox.test",}
\CommentTok{\#     textsize = 5}
\CommentTok{\#   ) +}
\CommentTok{\#   geom\_signif(}
\CommentTok{\#     data = subset(plot\_data, category == "non{-}orthosteric"),}
\CommentTok{\#     aes(x = type, y = adj\_r2\_values),}
\CommentTok{\#     comparisons = list(c("abundance", "both")),}
\CommentTok{\#     annotations = c("p = 1.568e{-}11"),}
\CommentTok{\#     y\_position = c(0.85),}
\CommentTok{\#     tip\_length = 0.02,}
\CommentTok{\#     step\_increase = 0.05,}
\CommentTok{\#     test = "wilcox.test",}
\CommentTok{\#     textsize = 5}
\CommentTok{\#   ) +}
\CommentTok{\#   geom\_signif(}
\CommentTok{\#     data = subset(plot\_data, category == "orthosteric"),}
\CommentTok{\#     aes(x = type, y = adj\_r2\_values),}
\CommentTok{\#     comparisons = list(c("abundance", "both")),}
\CommentTok{\#     annotations = c("p = 1.245e{-}13"),}
\CommentTok{\#     y\_position = c(0.85),}
\CommentTok{\#     tip\_length = 0.02,}
\CommentTok{\#     step\_increase = 0.05,}
\CommentTok{\#     test = "wilcox.test",}
\CommentTok{\#     textsize = 5}
\CommentTok{\#   ) +}
\CommentTok{\#   ylim({-}0.1, 1)}
\CommentTok{\# }
\CommentTok{\# ggsave("/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_sh3\_barplot.pdf", }
\CommentTok{\#        plot = fig3E, width = 8, height = 4, dpi = 300)}
\CommentTok{\# fig3E}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sh3\_out \textless{}{-} doubledeepms\_\_minimum\_interchain\_distances\_from\_PDB\_perres(}
\CommentTok{\#   input\_file = "/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/data/residual\_pdb/domains/2vwf.pdb",}
\CommentTok{\#   chain\_query = "A",}
\CommentTok{\#   chain\_target = "B"}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# sh3\_out}
\CommentTok{\# head(sh3\_final\_df\_ddg\_2plot\_all)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# merged\_df \textless{}{-} merge(sh3\_final\_df\_ddg\_2plot\_all, sh3\_out, by.x="old\_Pos.x", by.y = "Pos")}
\CommentTok{\# nrow(merged\_df) \#1056}
\CommentTok{\# }
\CommentTok{\# merged\_df\_pos \textless{}{-} merged\_df \%\textgreater{}\% filter(b\_ddg\_pred \textgreater{}= 0)}
\CommentTok{\# nrow(merged\_df\_pos)}
\CommentTok{\# }
\CommentTok{\# merged\_df\_residue \textless{}{-} merged\_df\_pos \%\textgreater{}\%}
\CommentTok{\#   group\_by(old\_Pos.x) \%\textgreater{}\%}
\CommentTok{\#   reframe(}
\CommentTok{\#     median\_ddgb = median(b\_ddg\_pred, na.rm = TRUE),}
\CommentTok{\#     median\_residual = median(residuals, na.rm = TRUE),}
\CommentTok{\#     scHAmin\_ligand = first(scHAmin\_ligand),}
\CommentTok{\#     orthosteric = first(orthosteric),}
\CommentTok{\#     Pos = first(old\_Pos.x))}
\CommentTok{\# }
\CommentTok{\# nrow(merged\_df\_residue) \#55}
\CommentTok{\# }
\CommentTok{\# \# Fit exponential decay: y = a * exp({-}b * x) + c}
\CommentTok{\# exp\_model\_sh3\_ddgb \textless{}{-} nls(abs(median\_ddgb) \textasciitilde{} a * exp({-}b * scHAmin\_ligand),}
\CommentTok{\#                  data = merged\_df\_residue,}
\CommentTok{\#                  start = list(a = 1, b = 0.1))}
\CommentTok{\# exp\_model\_sh3\_ddgb}
\CommentTok{\# \# Nonlinear regression model}
\CommentTok{\# \#   model: abs(median\_ddgb) \textasciitilde{} a * exp({-}b * scHAmin\_ligand)}
\CommentTok{\# \#    data: merged\_df\_residue}
\CommentTok{\# \#      a      b }
\CommentTok{\# \# 1.5129 0.1333 }
\CommentTok{\# \#  residual sum{-}of{-}squares: 8.253}
\CommentTok{\# \# }
\CommentTok{\# \# Number of iterations to convergence: 6 }
\CommentTok{\# \# Achieved convergence tolerance: 5.017e{-}06}
\CommentTok{\# }
\CommentTok{\# a \textless{}{-} 1.5129}
\CommentTok{\# b \textless{}{-}  0.1333 }
\CommentTok{\# half\_d \textless{}{-} log(2) / b  \#  5.199904}
\CommentTok{\# half\_d}
\CommentTok{\# }
\CommentTok{\# y\_cutoff \textless{}{-} mean(merged\_df \%\textgreater{}\% filter(orthosteric == TRUE) \%\textgreater{}\% pull(b\_ddg\_pred), na.rm=TRUE)}
\CommentTok{\# }
\CommentTok{\# merged\_df\_residue$site\_type \textless{}{-} "Non{-}orthosteric site"}
\CommentTok{\# merged\_df\_residue$site\_type[abs(merged\_df\_residue$median\_ddgb) \textless{}= y\_cutoff] \textless{}{-} "Null"}
\CommentTok{\# merged\_df\_residue$site\_type[merged\_df\_residue$orthosteric == TRUE] \textless{}{-} "Binding site"}
\CommentTok{\# }
\CommentTok{\# }
\CommentTok{\# x\_vals \textless{}{-} seq(min(merged\_df\_residue$scHAmin\_ligand, na.rm = TRUE),}
\CommentTok{\#               max(merged\_df\_residue$scHAmin\_ligand, na.rm = TRUE), length.out = 200)}
\CommentTok{\# }
\CommentTok{\# \# {-}{-}{-} Bootstrapping for confidence intervals {-}{-}{-}}
\CommentTok{\# set.seed(11)}
\CommentTok{\# boot\_params \textless{}{-} replicate(1000, \{}
\CommentTok{\#   samp \textless{}{-} merged\_df\_residue[sample(nrow(merged\_df\_residue), replace = TRUE), ]}
\CommentTok{\#   fit \textless{}{-} try(nlsLM(abs(median\_ddgb) \textasciitilde{} a * exp({-}b * scHAmin\_ligand),}
\CommentTok{\#                    data = samp, start = list(a = 1, b = 0.1)), silent = TRUE)}
\CommentTok{\#   if (inherits(fit, "try{-}error")) c(NA, NA) else coef(fit)}
\CommentTok{\# \})}
\CommentTok{\# boot\_params \textless{}{-} t(boot\_params)[complete.cases(t(boot\_params)), ]}
\CommentTok{\# }
\CommentTok{\# boot\_preds \textless{}{-} apply(boot\_params, 1, function(p) p[1] * exp({-}p[2] * x\_vals))}
\CommentTok{\# }
\CommentTok{\# fit\_df\_residue \textless{}{-} data.frame(}
\CommentTok{\#   scHAmin\_ligand = x\_vals,}
\CommentTok{\#   median\_ddgb = predict(exp\_model\_sh3\_ddgb, newdata = data.frame(scHAmin\_ligand = x\_vals)),}
\CommentTok{\#   lower = apply(boot\_preds, 1, quantile, probs = 0.025),}
\CommentTok{\#   upper = apply(boot\_preds, 1, quantile, probs = 0.975)}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# \# Plot}
\CommentTok{\# p1 \textless{}{-} ggplot(merged\_df\_residue, aes(x = scHAmin\_ligand, y = abs(median\_ddgb))) +}
\CommentTok{\#   \# Base layer: all points}
\CommentTok{\#   geom\_point(aes(color = site\_type, alpha = 0.4), size = 2) +}
\CommentTok{\#    \# Fit line with confidence ribbon}
\CommentTok{\#   geom\_ribbon(data = fit\_df\_residue,}
\CommentTok{\#             aes(x = scHAmin\_ligand, ymin = lower, ymax = upper),}
\CommentTok{\#             fill = "grey70", alpha = 0.3, inherit.aes = FALSE) +}
\CommentTok{\#   geom\_line(data = fit\_df\_residue, aes(x = scHAmin\_ligand, y = abs(median\_ddgb)),}
\CommentTok{\#           inherit.aes = FALSE, color = "black", size = 1) +}
\CommentTok{\#   geom\_text\_repel(data = merged\_df\_residue \%\textgreater{}\% filter(site\_type != "Null"), aes(label=Pos))+}
\CommentTok{\#   }
\CommentTok{\#   \# Manual color palette for site type}
\CommentTok{\#   scale\_color\_manual(values = c(}
\CommentTok{\#     "Null" = "darkgreen",}
\CommentTok{\#     "Non{-}orthosteric site" = "darkgreen",}
\CommentTok{\#     "Binding site" = "orange"}
\CommentTok{\#   )) +}
\CommentTok{\#   \# Reference lines}
\CommentTok{\#   geom\_vline(xintercept = 5, linetype = "dashed", color = "slategrey") +}
\CommentTok{\#   theme\_classic() +}
\CommentTok{\#   labs(}
\CommentTok{\#     title = "GRB2{-}SH3: allosteric decay",}
\CommentTok{\#     subtitle = "370 mutations with ddGb \textgreater{}=0",}
\CommentTok{\#     x = "Minimal distance to ligand",}
\CommentTok{\#     y = "Median ddGb",}
\CommentTok{\#     color = ""}
\CommentTok{\#   )  + theme(legend.position = "bottom") +}
\CommentTok{\#     annotate("text",  x = Inf, y = Inf,}
\CommentTok{\#              hjust = 1, vjust = 1,}
\CommentTok{\#            label = "y = a * exp (b * x)\textbackslash{}na = 1.5129  \textbackslash{}nb = {-}0.1333",}
\CommentTok{\#            size = 4, color = "black", hjust = 0) + theme(legend.position = "none")}
\CommentTok{\# }
\CommentTok{\# p1 \textless{}{-} ggMarginal(}
\CommentTok{\#   p1,}
\CommentTok{\#   type = "density",}
\CommentTok{\#   margins = "both",}
\CommentTok{\#   groupColour = FALSE,}
\CommentTok{\#   groupFill = FALSE,}
\CommentTok{\#   size = 10,}
\CommentTok{\#   colour = "grey",}
\CommentTok{\#   fill = "lightgrey"}
\CommentTok{\# )}
\CommentTok{\# ggsave("/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_sh3\_ddgb\_decay.pdf", }
\CommentTok{\#        plot = p1, width = 4, height = 4, dpi = 300)}
\CommentTok{\# p1}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# lm\_model \textless{}{-} lm(log(abs(median\_ddgb)) \textasciitilde{} scHAmin\_ligand, data = merged\_df\_residue)}
\CommentTok{\# summary(lm\_model)}
\CommentTok{\# Call:}
\CommentTok{\# lm(formula = log(abs(median\_ddgb)) \textasciitilde{} scHAmin\_ligand, data = merged\_df\_residue)}
\CommentTok{\# }
\CommentTok{\# Residuals:}
\CommentTok{\#      Min       1Q   Median       3Q      Max }
\CommentTok{\# {-}2.06277 {-}0.49682  0.05624  0.75934  1.81772 }
\CommentTok{\# }
\CommentTok{\# Coefficients:}
\CommentTok{\#                Estimate Std. Error t value Pr(\textgreater{}|t|)    }
\CommentTok{\# (Intercept)    {-}0.03660    0.27318  {-}0.134    0.894    }
\CommentTok{\# scHAmin\_ligand {-}0.11262    0.02514  {-}4.480 4.02e{-}05 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1}
\CommentTok{\# }
\CommentTok{\# Residual standard error: 0.8877 on 53 degrees of freedom}
\CommentTok{\# Multiple R{-}squared:  0.2746,  Adjusted R{-}squared:  0.261 }
\CommentTok{\# F{-}statistic: 20.07 on 1 and 53 DF,  p{-}value: 4.018e{-}05}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# merged\_df \textless{}{-} merge(sh3\_final\_df\_ddg\_2plot\_all, sh3\_out, by.x="old\_Pos.x", by.y = "Pos")}
\CommentTok{\# nrow(merged\_df) \#1056}
\CommentTok{\# }
\CommentTok{\# merged\_df\_neg \textless{}{-} merged\_df \%\textgreater{}\% filter(residuals \textless{}= 0)}
\CommentTok{\# nrow(merged\_df\_neg) \#681}
\CommentTok{\# }
\CommentTok{\# merged\_df\_residue \textless{}{-} merged\_df\_neg \%\textgreater{}\%}
\CommentTok{\#   group\_by(Pos\_ref.x) \%\textgreater{}\%}
\CommentTok{\#   reframe(}
\CommentTok{\#     median\_ddgb = median(b\_ddg\_pred, na.rm = TRUE),}
\CommentTok{\#     median\_residual = median(residuals, na.rm = TRUE),}
\CommentTok{\#     scHAmin\_ligand = first(scHAmin\_ligand),}
\CommentTok{\#     orthosteric = first(orthosteric),}
\CommentTok{\#     Pos = first(old\_Pos.x))}
\CommentTok{\# }
\CommentTok{\# nrow(merged\_df\_residue) \#}
\CommentTok{\# }
\CommentTok{\# \# Fit exponential decay: y = a * exp({-}b * x) + c}
\CommentTok{\# exp\_model\_sh3\_res \textless{}{-} nls(abs(median\_residual) \textasciitilde{} a * exp({-}b * scHAmin\_ligand),}
\CommentTok{\#                  data = merged\_df\_residue,}
\CommentTok{\#                  start = list(a = 1, b = 0.1))}
\CommentTok{\# exp\_model\_sh3\_res}
\CommentTok{\# \# Nonlinear regression model}
\CommentTok{\# \#   model: abs(median\_residual) \textasciitilde{} a * exp({-}b * scHAmin\_ligand)}
\CommentTok{\# \#    data: merged\_df\_residue}
\CommentTok{\# \#      a      b }
\CommentTok{\# \# 8.8472 0.1564 }
\CommentTok{\# \#  residual sum{-}of{-}squares: 131.2}
\CommentTok{\# \# }
\CommentTok{\# \# Number of iterations to convergence: 10 }
\CommentTok{\# \# Achieved convergence tolerance: 3.291e{-}06}
\CommentTok{\# }
\CommentTok{\# a \textless{}{-} 8.8472}
\CommentTok{\# b \textless{}{-}  0.1564}
\CommentTok{\# half\_d \textless{}{-} log(2) / b  \#  4.431887}
\CommentTok{\# half\_d}
\CommentTok{\# }
\CommentTok{\# y\_cutoff \textless{}{-} mean(merged\_df \%\textgreater{}\% filter(orthosteric == TRUE) \%\textgreater{}\% pull(residuals), na.rm = TRUE)}
\CommentTok{\# }
\CommentTok{\# merged\_df\_residue$site\_type \textless{}{-} "Non{-}orthosteric site"}
\CommentTok{\# merged\_df\_residue$site\_type[abs(merged\_df\_residue$median\_residual) \textless{}= abs(y\_cutoff)] \textless{}{-} "Null"}
\CommentTok{\# merged\_df\_residue$site\_type[merged\_df\_residue$orthosteric == TRUE] \textless{}{-} "Binding site"}
\CommentTok{\# table(merged\_df\_residue$site\_type)}
\CommentTok{\# }
\CommentTok{\# x\_vals \textless{}{-} seq(min(merged\_df\_residue$scHAmin\_ligand, na.rm = TRUE),}
\CommentTok{\#               max(merged\_df\_residue$scHAmin\_ligand, na.rm = TRUE), length.out = 200)}
\CommentTok{\# }
\CommentTok{\# \# {-}{-}{-} Bootstrapping for confidence intervals {-}{-}{-}}
\CommentTok{\# set.seed(11)}
\CommentTok{\# boot\_params \textless{}{-} replicate(1000, \{}
\CommentTok{\#   samp \textless{}{-} merged\_df\_residue[sample(nrow(merged\_df\_residue), replace = TRUE), ]}
\CommentTok{\#   fit \textless{}{-} try(nlsLM(abs(median\_residual) \textasciitilde{} a * exp({-}b * scHAmin\_ligand),}
\CommentTok{\#                    data = samp, start = list(a = 1, b = 0.1)), silent = TRUE)}
\CommentTok{\#   if (inherits(fit, "try{-}error")) c(NA, NA) else coef(fit)}
\CommentTok{\# \})}
\CommentTok{\# boot\_params \textless{}{-} t(boot\_params)[complete.cases(t(boot\_params)), ]}
\CommentTok{\# }
\CommentTok{\# boot\_preds \textless{}{-} apply(boot\_params, 1, function(p) p[1] * exp({-}p[2] * x\_vals))}
\CommentTok{\# }
\CommentTok{\# fit\_df\_residue \textless{}{-} data.frame(}
\CommentTok{\#   scHAmin\_ligand = x\_vals,}
\CommentTok{\#   median\_ddgb = predict(exp\_model\_sh3\_res, newdata = data.frame(scHAmin\_ligand = x\_vals)),}
\CommentTok{\#   lower = apply(boot\_preds, 1, quantile, probs = 0.025),}
\CommentTok{\#   upper = apply(boot\_preds, 1, quantile, probs = 0.975)}
\CommentTok{\# )}
\CommentTok{\# \# Plot}
\CommentTok{\# p2 \textless{}{-} ggplot(merged\_df\_residue, aes(x = scHAmin\_ligand, y = abs(median\_residual))) +}
\CommentTok{\#   \# Base layer: all points}
\CommentTok{\#   geom\_point(aes(color = site\_type, alpha = 0.4), size = 2) +}
\CommentTok{\#   geom\_ribbon(data = fit\_df\_residue,}
\CommentTok{\#             aes(x = scHAmin\_ligand, ymin = lower, ymax = upper),}
\CommentTok{\#             fill = "grey70", alpha = 0.3, inherit.aes = FALSE) +}
\CommentTok{\#   geom\_line(data = fit\_df\_residue, aes(x = scHAmin\_ligand, y = abs(median\_ddgb)),}
\CommentTok{\#           inherit.aes = FALSE, color = "black", size = 1) +}
\CommentTok{\#   geom\_text\_repel(data = merged\_df\_residue \%\textgreater{}\% filter(abs(median\_residual) \textgreater{} 2), aes(label=Pos))+}
\CommentTok{\#   }
\CommentTok{\#   \# Manual color palette for site type}
\CommentTok{\#   scale\_color\_manual(values = c(}
\CommentTok{\#     "Null" = "darkgreen",}
\CommentTok{\#     "Non{-}orthosteric site" = "darkgreen",}
\CommentTok{\#     "Binding site" = "orange"}
\CommentTok{\#   )) +}
\CommentTok{\#   \# Reference lines}
\CommentTok{\#   geom\_vline(xintercept = 5, linetype = "dashed", color = "slategrey") +}
\CommentTok{\#   theme\_classic() +}
\CommentTok{\#   labs(}
\CommentTok{\#     title = "GRB2{-}SH3: allosteric decay",}
\CommentTok{\#     subtitle = "681 mutations with residuals \textless{}= 0",}
\CommentTok{\#     x = "Minimal distance to ligand",}
\CommentTok{\#     y = "|Median ESM1v{-}ddGf residual|",}
\CommentTok{\#     color = ""}
\CommentTok{\#   )  + theme(legend.position = "bottom") +}
\CommentTok{\#     annotate("text",  x = Inf, y = Inf,}
\CommentTok{\#              hjust = 1, vjust = 1,}
\CommentTok{\#            label = "y = a * exp (b * x)\textbackslash{}na = 8.8472  \textbackslash{}nb = {-}0.1564",}
\CommentTok{\#            size = 4, color = "black", hjust = 0) + theme(legend.position = "none")}
\CommentTok{\# }
\CommentTok{\# p2 \textless{}{-} ggMarginal(}
\CommentTok{\#   p2,}
\CommentTok{\#   type = "density",}
\CommentTok{\#   margins = "both",}
\CommentTok{\#   groupColour = FALSE,}
\CommentTok{\#   groupFill = FALSE,}
\CommentTok{\#   size = 10,}
\CommentTok{\#   colour = "grey",}
\CommentTok{\#   fill = "lightgrey"}
\CommentTok{\# )}
\CommentTok{\# ggsave("/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_sh3\_residual\_decay.pdf", }
\CommentTok{\#        plot = p2, width = 4, height = 4, dpi = 300)}
\CommentTok{\# p2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# lm\_model \textless{}{-} lm(log(abs(median\_residual)) \textasciitilde{} scHAmin\_ligand, data = merged\_df\_residue)}
\CommentTok{\# summary(lm\_model)}
\CommentTok{\# Call:}
\CommentTok{\# lm(formula = log(abs(median\_residual)) \textasciitilde{} scHAmin\_ligand, data = merged\_df\_residue)}
\CommentTok{\# }
\CommentTok{\# Residuals:}
\CommentTok{\#      Min       1Q   Median       3Q      Max }
\CommentTok{\# {-}1.52127 {-}0.44230 {-}0.00484  0.58176  1.09505 }
\CommentTok{\# }
\CommentTok{\# Coefficients:}
\CommentTok{\#                Estimate Std. Error t value Pr(\textgreater{}|t|)    }
\CommentTok{\# (Intercept)     1.55124    0.20309   7.638 5.37e{-}10 ***}
\CommentTok{\# scHAmin\_ligand {-}0.09112    0.01942  {-}4.692 2.06e{-}05 ***}
\CommentTok{\# {-}{-}{-}}
\CommentTok{\# Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1}
\CommentTok{\# }
\CommentTok{\# Residual standard error: 0.6651 on 51 degrees of freedom}
\CommentTok{\# Multiple R{-}squared:  0.3015,  Adjusted R{-}squared:  0.2878 }
\CommentTok{\# F{-}statistic: 22.02 on 1 and 51 DF,  p{-}value: 2.064e{-}05}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# nrow(merged\_df) \#1056}
\CommentTok{\# }
\CommentTok{\# merged\_df\_residue \textless{}{-} merged\_df \%\textgreater{}\%}
\CommentTok{\#   group\_by(Pos\_ref.x) \%\textgreater{}\%}
\CommentTok{\#   reframe(}
\CommentTok{\#     median\_ddgb = median(b\_ddg\_pred, na.rm = TRUE),}
\CommentTok{\#     median\_residual = median(residuals, na.rm = TRUE),}
\CommentTok{\#     scHAmin\_ligand = first(scHAmin\_ligand),}
\CommentTok{\#     orthosteric = first(orthosteric),}
\CommentTok{\#     Pos = first(Pos\_ref.x))}
\CommentTok{\# }
\CommentTok{\# nrow(merged\_df\_residue) \#56}
\CommentTok{\# cor.test(merged\_df\_residue$median\_residual, merged\_df\_residue$median\_ddgb, method = "spearman")}
\CommentTok{\# \#     Spearman\textquotesingle{}s rank correlation rho}
\CommentTok{\# \# }
\CommentTok{\# \# data:  merged\_df\_residue$median\_residual and merged\_df\_residue$median\_ddgb}
\CommentTok{\# \# S = 49534, p{-}value = 9.813e{-}09}
\CommentTok{\# \# alternative hypothesis: true rho is not equal to 0}
\CommentTok{\# \# sample estimates:}
\CommentTok{\# \#        rho }
\CommentTok{\# \# {-}0.6928913 }
\CommentTok{\# }
\CommentTok{\# merged\_df\_residue$site\_type \textless{}{-} "Non{-}orthosteric site"}
\CommentTok{\# merged\_df\_residue$site\_type[merged\_df\_residue$orthosteric == TRUE] \textless{}{-} "Binding site"}
\CommentTok{\# }
\CommentTok{\# figS3E \textless{}{-} ggplot(merged\_df\_residue, aes(x = median\_ddgb, y =  median\_residual, color = site\_type)) +}
\CommentTok{\#   geom\_point(size = 2, alpha = 0.5) +}
\CommentTok{\#   labs(}
\CommentTok{\#     title = "GRB2{-}SH3: 56 residues (all 1056 mutations)",}
\CommentTok{\#     subtitle = "Spearman\textquotesingle{}s rho = {-}0.70",}
\CommentTok{\#     x = "Median ddGb",}
\CommentTok{\#     y = "Median ESM1v{-}ddGf residual",}
\CommentTok{\#     color = "") +}
\CommentTok{\#   theme\_classic() +}
\CommentTok{\#     scale\_color\_manual(values = c(}
\CommentTok{\#     "Non{-}orthosteric site" = "darkgreen",}
\CommentTok{\#     "Binding site" = "orange"}
\CommentTok{\#   )) + theme(legend.position = "bottom") +}
\CommentTok{\#   geom\_vline(xintercept = 0, linetype = "dashed", linewidth = 0.5, color = "grey") +}
\CommentTok{\#   geom\_hline(yintercept = 0, linetype = "dashed", linewidth = 0.5, color = "grey") }
\CommentTok{\#   \#xlim({-}3,2) + ylim({-}5,5)}
\CommentTok{\# }
\CommentTok{\# ggsave("/Users/xl7/Documents/0.Projects/01.protein{-}seq{-}evo{-}v1/figs/panels/fig3\_sh3\_corr.pdf", }
\CommentTok{\#        plot = figS3E, width = 4, height = 5, dpi = 300)}
\CommentTok{\# figS3E}
\end{Highlighting}
\end{Shaded}


\end{document}
